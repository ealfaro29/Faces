(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const Cl=n=>{if(!n)return"";const e=n.toUpperCase();return String.fromCodePoint(...e.split("").map(t=>127397+t.charCodeAt()))},Kr=(n,e="420x420",t="Png")=>!n||isNaN(n)?"photos/app/logo.svg":`https://www.roblox.com/asset-thumbnail/image?assetId=${n}&width=420&height=420&format=png`,$d=()=>{};var Qa={};const Pl=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},jd=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],a=n[t++],c=n[t++],u=((s&7)<<18|(i&63)<<12|(a&63)<<6|c&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{const i=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},kl={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],a=s+1<n.length,c=a?n[s+1]:0,u=s+2<n.length,d=u?n[s+2]:0,f=i>>2,m=(i&3)<<4|c>>4;let _=(c&15)<<2|d>>6,b=d&63;u||(b=64,a||(_=64)),r.push(t[f],t[m],t[_],t[b])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Pl(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):jd(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],c=s<n.length?t[n.charAt(s)]:0;++s;const d=s<n.length?t[n.charAt(s)]:64;++s;const m=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||c==null||d==null||m==null)throw new zd;const _=i<<2|c>>4;if(r.push(_),d!==64){const b=c<<4&240|d>>2;if(r.push(b),m!==64){const S=d<<6&192|m;r.push(S)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class zd extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const qd=function(n){const e=Pl(n);return kl.encodeByteArray(e,!0)},is=function(n){return qd(n).replace(/\./g,"")},Nl=function(n){try{return kl.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Hd(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Gd=()=>Hd().__FIREBASE_DEFAULTS__,Wd=()=>{if(typeof process>"u"||typeof Qa>"u")return;const n=Qa.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Kd=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Nl(n[1]);return e&&JSON.parse(e)},Ss=()=>{try{return $d()||Gd()||Wd()||Kd()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Dl=n=>Ss()?.emulatorHosts?.[n],Vl=n=>{const e=Dl(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},xl=()=>Ss()?.config,Ll=n=>Ss()?.[`_${n}`];class Qd{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function Ht(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function to(n){return(await fetch(n,{credentials:"include"})).ok}function Ol(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n};return[is(JSON.stringify(t)),is(JSON.stringify(a)),""].join(".")}const Qn={};function Jd(){const n={prod:[],emulator:[]};for(const e of Object.keys(Qn))Qn[e]?n.emulator.push(e):n.prod.push(e);return n}function Yd(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Ja=!1;function no(n,e){if(typeof window>"u"||typeof document>"u"||!Ht(window.location.host)||Qn[n]===e||Qn[n]||Ja)return;Qn[n]=e;function t(_){return`__firebase__banner__${_}`}const r="__firebase__banner",i=Jd().prod.length>0;function a(){const _=document.getElementById(r);_&&_.remove()}function c(_){_.style.display="flex",_.style.background="#7faaf0",_.style.position="fixed",_.style.bottom="5px",_.style.left="5px",_.style.padding=".5em",_.style.borderRadius="5px",_.style.alignItems="center"}function u(_,b){_.setAttribute("width","24"),_.setAttribute("id",b),_.setAttribute("height","24"),_.setAttribute("viewBox","0 0 24 24"),_.setAttribute("fill","none"),_.style.marginLeft="-6px"}function d(){const _=document.createElement("span");return _.style.cursor="pointer",_.style.marginLeft="16px",_.style.fontSize="24px",_.innerHTML=" &times;",_.onclick=()=>{Ja=!0,a()},_}function f(_,b){_.setAttribute("id",b),_.innerText="Learn more",_.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",_.setAttribute("target","__blank"),_.style.paddingLeft="5px",_.style.textDecoration="underline"}function m(){const _=Yd(r),b=t("text"),S=document.getElementById(b)||document.createElement("span"),k=t("learnmore"),C=document.getElementById(k)||document.createElement("a"),D=t("preprendIcon"),F=document.getElementById(D)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(_.created){const L=_.element;c(L),f(C,k);const q=d();u(F,D),L.append(F,S,C,q),document.body.appendChild(L)}i?(S.innerText="Preview backend disconnected.",F.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(F.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,S.innerText="Preview backend running in this workspace."),S.setAttribute("id",b)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",m):m()}function Ee(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Xd(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ee())}function Zd(){const n=Ss()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function ef(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function tf(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function nf(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function rf(){const n=Ee();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function sf(){return!Zd()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function of(){try{return typeof indexedDB=="object"}catch{return!1}}function af(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(t){e(t)}})}const cf="FirebaseError";class Ke extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=cf,Object.setPrototypeOf(this,Ke.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,hr.prototype.create)}}class hr{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?lf(i,r):"Error",c=`${this.serviceName}: ${a} (${s}).`;return new Ke(s,c,r)}}function lf(n,e){return n.replace(uf,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const uf=/\{\$([^}]+)}/g;function hf(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ut(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],a=e[s];if(Ya(i)&&Ya(a)){if(!Ut(i,a))return!1}else if(i!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Ya(n){return n!==null&&typeof n=="object"}function dr(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function jn(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function zn(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function df(n,e){const t=new ff(n,e);return t.subscribe.bind(t)}class ff{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");pf(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=gi),s.error===void 0&&(s.error=gi),s.complete===void 0&&(s.complete=gi);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function pf(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function gi(){}function we(n){return n&&n._delegate?n._delegate:n}class Tt{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Ot="[DEFAULT]";class mf{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Qd;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(_f(e))try{this.getOrInitializeService({instanceIdentifier:Ot})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Ot){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ot){return this.instances.has(e)}getOptions(e=Ot){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,a]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(i);r===c&&a.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:gf(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Ot){return this.component?this.component.multipleInstances?e:Ot:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function gf(n){return n===Ot?void 0:n}function _f(n){return n.instantiationMode==="EAGER"}class yf{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new mf(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var H;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(H||(H={}));const vf={debug:H.DEBUG,verbose:H.VERBOSE,info:H.INFO,warn:H.WARN,error:H.ERROR,silent:H.SILENT},Ef=H.INFO,Tf={[H.DEBUG]:"log",[H.VERBOSE]:"log",[H.INFO]:"info",[H.WARN]:"warn",[H.ERROR]:"error"},If=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=Tf[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class ro{constructor(e){this.name=e,this._logLevel=Ef,this._logHandler=If,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in H))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?vf[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,H.DEBUG,...e),this._logHandler(this,H.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,H.VERBOSE,...e),this._logHandler(this,H.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,H.INFO,...e),this._logHandler(this,H.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,H.WARN,...e),this._logHandler(this,H.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,H.ERROR,...e),this._logHandler(this,H.ERROR,...e)}}const wf=(n,e)=>e.some(t=>n instanceof t);let Xa,Za;function Af(){return Xa||(Xa=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function bf(){return Za||(Za=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Ml=new WeakMap,ki=new WeakMap,Fl=new WeakMap,_i=new WeakMap,so=new WeakMap;function Rf(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",a)},i=()=>{t(gt(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Ml.set(t,n)}).catch(()=>{}),so.set(e,n),e}function Sf(n){if(ki.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",a),n.removeEventListener("abort",a)},i=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",a),n.addEventListener("abort",a)});ki.set(n,e)}let Ni={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return ki.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Fl.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return gt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Cf(n){Ni=n(Ni)}function Pf(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(yi(this),e,...t);return Fl.set(r,e.sort?e.sort():[e]),gt(r)}:bf().includes(n)?function(...e){return n.apply(yi(this),e),gt(Ml.get(this))}:function(...e){return gt(n.apply(yi(this),e))}}function kf(n){return typeof n=="function"?Pf(n):(n instanceof IDBTransaction&&Sf(n),wf(n,Af())?new Proxy(n,Ni):n)}function gt(n){if(n instanceof IDBRequest)return Rf(n);if(_i.has(n))return _i.get(n);const e=kf(n);return e!==n&&(_i.set(n,e),so.set(e,n)),e}const yi=n=>so.get(n);function Nf(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(n,e),c=gt(a);return r&&a.addEventListener("upgradeneeded",u=>{r(gt(a.result),u.oldVersion,u.newVersion,gt(a.transaction),u)}),t&&a.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),c.then(u=>{i&&u.addEventListener("close",()=>i()),s&&u.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}const Df=["get","getKey","getAll","getAllKeys","count"],Vf=["put","add","delete","clear"],vi=new Map;function ec(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(vi.get(e))return vi.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=Vf.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||Df.includes(t)))return;const i=async function(a,...c){const u=this.transaction(a,s?"readwrite":"readonly");let d=u.store;return r&&(d=d.index(c.shift())),(await Promise.all([d[t](...c),s&&u.done]))[0]};return vi.set(e,i),i}Cf(n=>({...n,get:(e,t,r)=>ec(e,t)||n.get(e,t,r),has:(e,t)=>!!ec(e,t)||n.has(e,t)}));class xf{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Lf(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function Lf(n){return n.getComponent()?.type==="VERSION"}const Di="@firebase/app",tc="0.14.7";const et=new ro("@firebase/app"),Of="@firebase/app-compat",Mf="@firebase/analytics-compat",Ff="@firebase/analytics",Uf="@firebase/app-check-compat",Bf="@firebase/app-check",$f="@firebase/auth",jf="@firebase/auth-compat",zf="@firebase/database",qf="@firebase/data-connect",Hf="@firebase/database-compat",Gf="@firebase/functions",Wf="@firebase/functions-compat",Kf="@firebase/installations",Qf="@firebase/installations-compat",Jf="@firebase/messaging",Yf="@firebase/messaging-compat",Xf="@firebase/performance",Zf="@firebase/performance-compat",ep="@firebase/remote-config",tp="@firebase/remote-config-compat",np="@firebase/storage",rp="@firebase/storage-compat",sp="@firebase/firestore",ip="@firebase/ai",op="@firebase/firestore-compat",ap="firebase",cp="12.8.0";const Vi="[DEFAULT]",lp={[Di]:"fire-core",[Of]:"fire-core-compat",[Ff]:"fire-analytics",[Mf]:"fire-analytics-compat",[Bf]:"fire-app-check",[Uf]:"fire-app-check-compat",[$f]:"fire-auth",[jf]:"fire-auth-compat",[zf]:"fire-rtdb",[qf]:"fire-data-connect",[Hf]:"fire-rtdb-compat",[Gf]:"fire-fn",[Wf]:"fire-fn-compat",[Kf]:"fire-iid",[Qf]:"fire-iid-compat",[Jf]:"fire-fcm",[Yf]:"fire-fcm-compat",[Xf]:"fire-perf",[Zf]:"fire-perf-compat",[ep]:"fire-rc",[tp]:"fire-rc-compat",[np]:"fire-gcs",[rp]:"fire-gcs-compat",[sp]:"fire-fst",[op]:"fire-fst-compat",[ip]:"fire-vertex","fire-js":"fire-js",[ap]:"fire-js-all"};const os=new Map,up=new Map,xi=new Map;function nc(n,e){try{n.container.addComponent(e)}catch(t){et.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Bt(n){const e=n.name;if(xi.has(e))return et.debug(`There were multiple attempts to register component ${e}.`),!1;xi.set(e,n);for(const t of os.values())nc(t,n);for(const t of up.values())nc(t,n);return!0}function Cs(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Se(n){return n==null?!1:n.settings!==void 0}const hp={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},_t=new hr("app","Firebase",hp);class dp{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Tt("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw _t.create("app-deleted",{appName:this._name})}}const Gt=cp;function Ul(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:Vi,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw _t.create("bad-app-name",{appName:String(s)});if(t||(t=xl()),!t)throw _t.create("no-options");const i=os.get(s);if(i){if(Ut(t,i.options)&&Ut(r,i.config))return i;throw _t.create("duplicate-app",{appName:s})}const a=new yf(s);for(const u of xi.values())a.addComponent(u);const c=new dp(t,r,a);return os.set(s,c),c}function io(n=Vi){const e=os.get(n);if(!e&&n===Vi&&xl())return Ul();if(!e)throw _t.create("no-app",{appName:n});return e}function Ue(n,e,t){let r=lp[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&a.push("and"),i&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),et.warn(a.join(" "));return}Bt(new Tt(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const fp="firebase-heartbeat-database",pp=1,tr="firebase-heartbeat-store";let Ei=null;function Bl(){return Ei||(Ei=Nf(fp,pp,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(tr)}catch(t){console.warn(t)}}}}).catch(n=>{throw _t.create("idb-open",{originalErrorMessage:n.message})})),Ei}async function mp(n){try{const t=(await Bl()).transaction(tr),r=await t.objectStore(tr).get($l(n));return await t.done,r}catch(e){if(e instanceof Ke)et.warn(e.message);else{const t=_t.create("idb-get",{originalErrorMessage:e?.message});et.warn(t.message)}}}async function rc(n,e){try{const r=(await Bl()).transaction(tr,"readwrite");await r.objectStore(tr).put(e,$l(n)),await r.done}catch(t){if(t instanceof Ke)et.warn(t.message);else{const r=_t.create("idb-set",{originalErrorMessage:t?.message});et.warn(r.message)}}}function $l(n){return`${n.name}!${n.options.appId}`}const gp=1024,_p=30;class yp{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Ep(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=sc();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>_p){const s=Tp(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){et.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=sc(),{heartbeatsToSend:t,unsentEntries:r}=vp(this._heartbeatsCache.heartbeats),s=is(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return et.warn(e),""}}}function sc(){return new Date().toISOString().substring(0,10)}function vp(n,e=gp){const t=[];let r=n.slice();for(const s of n){const i=t.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),ic(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),ic(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Ep{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return of()?af().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await mp(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return rc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return rc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function ic(n){return is(JSON.stringify({version:2,heartbeats:n})).length}function Tp(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function Ip(n){Bt(new Tt("platform-logger",e=>new xf(e),"PRIVATE")),Bt(new Tt("heartbeat",e=>new yp(e),"PRIVATE")),Ue(Di,tc,n),Ue(Di,tc,"esm2020"),Ue("fire-js","")}Ip("");var wp="firebase",Ap="12.8.0";Ue(wp,Ap,"app");var oc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var yt,jl;(function(){var n;function e(E,g){function v(){}v.prototype=g.prototype,E.F=g.prototype,E.prototype=new v,E.prototype.constructor=E,E.D=function(I,T,A){for(var y=Array(arguments.length-2),Ae=2;Ae<arguments.length;Ae++)y[Ae-2]=arguments[Ae];return g.prototype[T].apply(I,y)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(E,g,v){v||(v=0);const I=Array(16);if(typeof g=="string")for(var T=0;T<16;++T)I[T]=g.charCodeAt(v++)|g.charCodeAt(v++)<<8|g.charCodeAt(v++)<<16|g.charCodeAt(v++)<<24;else for(T=0;T<16;++T)I[T]=g[v++]|g[v++]<<8|g[v++]<<16|g[v++]<<24;g=E.g[0],v=E.g[1],T=E.g[2];let A=E.g[3],y;y=g+(A^v&(T^A))+I[0]+3614090360&4294967295,g=v+(y<<7&4294967295|y>>>25),y=A+(T^g&(v^T))+I[1]+3905402710&4294967295,A=g+(y<<12&4294967295|y>>>20),y=T+(v^A&(g^v))+I[2]+606105819&4294967295,T=A+(y<<17&4294967295|y>>>15),y=v+(g^T&(A^g))+I[3]+3250441966&4294967295,v=T+(y<<22&4294967295|y>>>10),y=g+(A^v&(T^A))+I[4]+4118548399&4294967295,g=v+(y<<7&4294967295|y>>>25),y=A+(T^g&(v^T))+I[5]+1200080426&4294967295,A=g+(y<<12&4294967295|y>>>20),y=T+(v^A&(g^v))+I[6]+2821735955&4294967295,T=A+(y<<17&4294967295|y>>>15),y=v+(g^T&(A^g))+I[7]+4249261313&4294967295,v=T+(y<<22&4294967295|y>>>10),y=g+(A^v&(T^A))+I[8]+1770035416&4294967295,g=v+(y<<7&4294967295|y>>>25),y=A+(T^g&(v^T))+I[9]+2336552879&4294967295,A=g+(y<<12&4294967295|y>>>20),y=T+(v^A&(g^v))+I[10]+4294925233&4294967295,T=A+(y<<17&4294967295|y>>>15),y=v+(g^T&(A^g))+I[11]+2304563134&4294967295,v=T+(y<<22&4294967295|y>>>10),y=g+(A^v&(T^A))+I[12]+1804603682&4294967295,g=v+(y<<7&4294967295|y>>>25),y=A+(T^g&(v^T))+I[13]+4254626195&4294967295,A=g+(y<<12&4294967295|y>>>20),y=T+(v^A&(g^v))+I[14]+2792965006&4294967295,T=A+(y<<17&4294967295|y>>>15),y=v+(g^T&(A^g))+I[15]+1236535329&4294967295,v=T+(y<<22&4294967295|y>>>10),y=g+(T^A&(v^T))+I[1]+4129170786&4294967295,g=v+(y<<5&4294967295|y>>>27),y=A+(v^T&(g^v))+I[6]+3225465664&4294967295,A=g+(y<<9&4294967295|y>>>23),y=T+(g^v&(A^g))+I[11]+643717713&4294967295,T=A+(y<<14&4294967295|y>>>18),y=v+(A^g&(T^A))+I[0]+3921069994&4294967295,v=T+(y<<20&4294967295|y>>>12),y=g+(T^A&(v^T))+I[5]+3593408605&4294967295,g=v+(y<<5&4294967295|y>>>27),y=A+(v^T&(g^v))+I[10]+38016083&4294967295,A=g+(y<<9&4294967295|y>>>23),y=T+(g^v&(A^g))+I[15]+3634488961&4294967295,T=A+(y<<14&4294967295|y>>>18),y=v+(A^g&(T^A))+I[4]+3889429448&4294967295,v=T+(y<<20&4294967295|y>>>12),y=g+(T^A&(v^T))+I[9]+568446438&4294967295,g=v+(y<<5&4294967295|y>>>27),y=A+(v^T&(g^v))+I[14]+3275163606&4294967295,A=g+(y<<9&4294967295|y>>>23),y=T+(g^v&(A^g))+I[3]+4107603335&4294967295,T=A+(y<<14&4294967295|y>>>18),y=v+(A^g&(T^A))+I[8]+1163531501&4294967295,v=T+(y<<20&4294967295|y>>>12),y=g+(T^A&(v^T))+I[13]+2850285829&4294967295,g=v+(y<<5&4294967295|y>>>27),y=A+(v^T&(g^v))+I[2]+4243563512&4294967295,A=g+(y<<9&4294967295|y>>>23),y=T+(g^v&(A^g))+I[7]+1735328473&4294967295,T=A+(y<<14&4294967295|y>>>18),y=v+(A^g&(T^A))+I[12]+2368359562&4294967295,v=T+(y<<20&4294967295|y>>>12),y=g+(v^T^A)+I[5]+4294588738&4294967295,g=v+(y<<4&4294967295|y>>>28),y=A+(g^v^T)+I[8]+2272392833&4294967295,A=g+(y<<11&4294967295|y>>>21),y=T+(A^g^v)+I[11]+1839030562&4294967295,T=A+(y<<16&4294967295|y>>>16),y=v+(T^A^g)+I[14]+4259657740&4294967295,v=T+(y<<23&4294967295|y>>>9),y=g+(v^T^A)+I[1]+2763975236&4294967295,g=v+(y<<4&4294967295|y>>>28),y=A+(g^v^T)+I[4]+1272893353&4294967295,A=g+(y<<11&4294967295|y>>>21),y=T+(A^g^v)+I[7]+4139469664&4294967295,T=A+(y<<16&4294967295|y>>>16),y=v+(T^A^g)+I[10]+3200236656&4294967295,v=T+(y<<23&4294967295|y>>>9),y=g+(v^T^A)+I[13]+681279174&4294967295,g=v+(y<<4&4294967295|y>>>28),y=A+(g^v^T)+I[0]+3936430074&4294967295,A=g+(y<<11&4294967295|y>>>21),y=T+(A^g^v)+I[3]+3572445317&4294967295,T=A+(y<<16&4294967295|y>>>16),y=v+(T^A^g)+I[6]+76029189&4294967295,v=T+(y<<23&4294967295|y>>>9),y=g+(v^T^A)+I[9]+3654602809&4294967295,g=v+(y<<4&4294967295|y>>>28),y=A+(g^v^T)+I[12]+3873151461&4294967295,A=g+(y<<11&4294967295|y>>>21),y=T+(A^g^v)+I[15]+530742520&4294967295,T=A+(y<<16&4294967295|y>>>16),y=v+(T^A^g)+I[2]+3299628645&4294967295,v=T+(y<<23&4294967295|y>>>9),y=g+(T^(v|~A))+I[0]+4096336452&4294967295,g=v+(y<<6&4294967295|y>>>26),y=A+(v^(g|~T))+I[7]+1126891415&4294967295,A=g+(y<<10&4294967295|y>>>22),y=T+(g^(A|~v))+I[14]+2878612391&4294967295,T=A+(y<<15&4294967295|y>>>17),y=v+(A^(T|~g))+I[5]+4237533241&4294967295,v=T+(y<<21&4294967295|y>>>11),y=g+(T^(v|~A))+I[12]+1700485571&4294967295,g=v+(y<<6&4294967295|y>>>26),y=A+(v^(g|~T))+I[3]+2399980690&4294967295,A=g+(y<<10&4294967295|y>>>22),y=T+(g^(A|~v))+I[10]+4293915773&4294967295,T=A+(y<<15&4294967295|y>>>17),y=v+(A^(T|~g))+I[1]+2240044497&4294967295,v=T+(y<<21&4294967295|y>>>11),y=g+(T^(v|~A))+I[8]+1873313359&4294967295,g=v+(y<<6&4294967295|y>>>26),y=A+(v^(g|~T))+I[15]+4264355552&4294967295,A=g+(y<<10&4294967295|y>>>22),y=T+(g^(A|~v))+I[6]+2734768916&4294967295,T=A+(y<<15&4294967295|y>>>17),y=v+(A^(T|~g))+I[13]+1309151649&4294967295,v=T+(y<<21&4294967295|y>>>11),y=g+(T^(v|~A))+I[4]+4149444226&4294967295,g=v+(y<<6&4294967295|y>>>26),y=A+(v^(g|~T))+I[11]+3174756917&4294967295,A=g+(y<<10&4294967295|y>>>22),y=T+(g^(A|~v))+I[2]+718787259&4294967295,T=A+(y<<15&4294967295|y>>>17),y=v+(A^(T|~g))+I[9]+3951481745&4294967295,E.g[0]=E.g[0]+g&4294967295,E.g[1]=E.g[1]+(T+(y<<21&4294967295|y>>>11))&4294967295,E.g[2]=E.g[2]+T&4294967295,E.g[3]=E.g[3]+A&4294967295}r.prototype.v=function(E,g){g===void 0&&(g=E.length);const v=g-this.blockSize,I=this.C;let T=this.h,A=0;for(;A<g;){if(T==0)for(;A<=v;)s(this,E,A),A+=this.blockSize;if(typeof E=="string"){for(;A<g;)if(I[T++]=E.charCodeAt(A++),T==this.blockSize){s(this,I),T=0;break}}else for(;A<g;)if(I[T++]=E[A++],T==this.blockSize){s(this,I),T=0;break}}this.h=T,this.o+=g},r.prototype.A=function(){var E=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);E[0]=128;for(var g=1;g<E.length-8;++g)E[g]=0;g=this.o*8;for(var v=E.length-8;v<E.length;++v)E[v]=g&255,g/=256;for(this.v(E),E=Array(16),g=0,v=0;v<4;++v)for(let I=0;I<32;I+=8)E[g++]=this.g[v]>>>I&255;return E};function i(E,g){var v=c;return Object.prototype.hasOwnProperty.call(v,E)?v[E]:v[E]=g(E)}function a(E,g){this.h=g;const v=[];let I=!0;for(let T=E.length-1;T>=0;T--){const A=E[T]|0;I&&A==g||(v[T]=A,I=!1)}this.g=v}var c={};function u(E){return-128<=E&&E<128?i(E,function(g){return new a([g|0],g<0?-1:0)}):new a([E|0],E<0?-1:0)}function d(E){if(isNaN(E)||!isFinite(E))return m;if(E<0)return C(d(-E));const g=[];let v=1;for(let I=0;E>=v;I++)g[I]=E/v|0,v*=4294967296;return new a(g,0)}function f(E,g){if(E.length==0)throw Error("number format error: empty string");if(g=g||10,g<2||36<g)throw Error("radix out of range: "+g);if(E.charAt(0)=="-")return C(f(E.substring(1),g));if(E.indexOf("-")>=0)throw Error('number format error: interior "-" character');const v=d(Math.pow(g,8));let I=m;for(let A=0;A<E.length;A+=8){var T=Math.min(8,E.length-A);const y=parseInt(E.substring(A,A+T),g);T<8?(T=d(Math.pow(g,T)),I=I.j(T).add(d(y))):(I=I.j(v),I=I.add(d(y)))}return I}var m=u(0),_=u(1),b=u(16777216);n=a.prototype,n.m=function(){if(k(this))return-C(this).m();let E=0,g=1;for(let v=0;v<this.g.length;v++){const I=this.i(v);E+=(I>=0?I:4294967296+I)*g,g*=4294967296}return E},n.toString=function(E){if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(S(this))return"0";if(k(this))return"-"+C(this).toString(E);const g=d(Math.pow(E,6));var v=this;let I="";for(;;){const T=q(v,g).g;v=D(v,T.j(g));let A=((v.g.length>0?v.g[0]:v.h)>>>0).toString(E);if(v=T,S(v))return A+I;for(;A.length<6;)A="0"+A;I=A+I}},n.i=function(E){return E<0?0:E<this.g.length?this.g[E]:this.h};function S(E){if(E.h!=0)return!1;for(let g=0;g<E.g.length;g++)if(E.g[g]!=0)return!1;return!0}function k(E){return E.h==-1}n.l=function(E){return E=D(this,E),k(E)?-1:S(E)?0:1};function C(E){const g=E.g.length,v=[];for(let I=0;I<g;I++)v[I]=~E.g[I];return new a(v,~E.h).add(_)}n.abs=function(){return k(this)?C(this):this},n.add=function(E){const g=Math.max(this.g.length,E.g.length),v=[];let I=0;for(let T=0;T<=g;T++){let A=I+(this.i(T)&65535)+(E.i(T)&65535),y=(A>>>16)+(this.i(T)>>>16)+(E.i(T)>>>16);I=y>>>16,A&=65535,y&=65535,v[T]=y<<16|A}return new a(v,v[v.length-1]&-2147483648?-1:0)};function D(E,g){return E.add(C(g))}n.j=function(E){if(S(this)||S(E))return m;if(k(this))return k(E)?C(this).j(C(E)):C(C(this).j(E));if(k(E))return C(this.j(C(E)));if(this.l(b)<0&&E.l(b)<0)return d(this.m()*E.m());const g=this.g.length+E.g.length,v=[];for(var I=0;I<2*g;I++)v[I]=0;for(I=0;I<this.g.length;I++)for(let T=0;T<E.g.length;T++){const A=this.i(I)>>>16,y=this.i(I)&65535,Ae=E.i(T)>>>16,kt=E.i(T)&65535;v[2*I+2*T]+=y*kt,F(v,2*I+2*T),v[2*I+2*T+1]+=A*kt,F(v,2*I+2*T+1),v[2*I+2*T+1]+=y*Ae,F(v,2*I+2*T+1),v[2*I+2*T+2]+=A*Ae,F(v,2*I+2*T+2)}for(E=0;E<g;E++)v[E]=v[2*E+1]<<16|v[2*E];for(E=g;E<2*g;E++)v[E]=0;return new a(v,0)};function F(E,g){for(;(E[g]&65535)!=E[g];)E[g+1]+=E[g]>>>16,E[g]&=65535,g++}function L(E,g){this.g=E,this.h=g}function q(E,g){if(S(g))throw Error("division by zero");if(S(E))return new L(m,m);if(k(E))return g=q(C(E),g),new L(C(g.g),C(g.h));if(k(g))return g=q(E,C(g)),new L(C(g.g),g.h);if(E.g.length>30){if(k(E)||k(g))throw Error("slowDivide_ only works with positive integers.");for(var v=_,I=g;I.l(E)<=0;)v=ne(v),I=ne(I);var T=J(v,1),A=J(I,1);for(I=J(I,2),v=J(v,2);!S(I);){var y=A.add(I);y.l(E)<=0&&(T=T.add(v),A=y),I=J(I,1),v=J(v,1)}return g=D(E,T.j(g)),new L(T,g)}for(T=m;E.l(g)>=0;){for(v=Math.max(1,Math.floor(E.m()/g.m())),I=Math.ceil(Math.log(v)/Math.LN2),I=I<=48?1:Math.pow(2,I-48),A=d(v),y=A.j(g);k(y)||y.l(E)>0;)v-=I,A=d(v),y=A.j(g);S(A)&&(A=_),T=T.add(A),E=D(E,y)}return new L(T,E)}n.B=function(E){return q(this,E).h},n.and=function(E){const g=Math.max(this.g.length,E.g.length),v=[];for(let I=0;I<g;I++)v[I]=this.i(I)&E.i(I);return new a(v,this.h&E.h)},n.or=function(E){const g=Math.max(this.g.length,E.g.length),v=[];for(let I=0;I<g;I++)v[I]=this.i(I)|E.i(I);return new a(v,this.h|E.h)},n.xor=function(E){const g=Math.max(this.g.length,E.g.length),v=[];for(let I=0;I<g;I++)v[I]=this.i(I)^E.i(I);return new a(v,this.h^E.h)};function ne(E){const g=E.g.length+1,v=[];for(let I=0;I<g;I++)v[I]=E.i(I)<<1|E.i(I-1)>>>31;return new a(v,E.h)}function J(E,g){const v=g>>5;g%=32;const I=E.g.length-v,T=[];for(let A=0;A<I;A++)T[A]=g>0?E.i(A+v)>>>g|E.i(A+v+1)<<32-g:E.i(A+v);return new a(T,E.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,jl=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,yt=a}).apply(typeof oc<"u"?oc:typeof self<"u"?self:typeof window<"u"?window:{});var Fr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var zl,qn,ql,Qr,Li,Hl,Gl,Wl;(function(){var n,e=Object.defineProperty;function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof Fr=="object"&&Fr];for(var l=0;l<o.length;++l){var h=o[l];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var r=t(this);function s(o,l){if(l)e:{var h=r;o=o.split(".");for(var p=0;p<o.length-1;p++){var w=o[p];if(!(w in h))break e;h=h[w]}o=o[o.length-1],p=h[o],l=l(p),l!=p&&l!=null&&e(h,o,{configurable:!0,writable:!0,value:l})}}s("Symbol.dispose",function(o){return o||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(o){return o||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(o){return o||function(l){var h=[],p;for(p in l)Object.prototype.hasOwnProperty.call(l,p)&&h.push([p,l[p]]);return h}});var i=i||{},a=this||self;function c(o){var l=typeof o;return l=="object"&&o!=null||l=="function"}function u(o,l,h){return o.call.apply(o.bind,arguments)}function d(o,l,h){return d=u,d.apply(null,arguments)}function f(o,l){var h=Array.prototype.slice.call(arguments,1);return function(){var p=h.slice();return p.push.apply(p,arguments),o.apply(this,p)}}function m(o,l){function h(){}h.prototype=l.prototype,o.Z=l.prototype,o.prototype=new h,o.prototype.constructor=o,o.Ob=function(p,w,R){for(var V=Array(arguments.length-2),z=2;z<arguments.length;z++)V[z-2]=arguments[z];return l.prototype[w].apply(p,V)}}var _=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?o=>o&&AsyncContext.Snapshot.wrap(o):o=>o;function b(o){const l=o.length;if(l>0){const h=Array(l);for(let p=0;p<l;p++)h[p]=o[p];return h}return[]}function S(o,l){for(let p=1;p<arguments.length;p++){const w=arguments[p];var h=typeof w;if(h=h!="object"?h:w?Array.isArray(w)?"array":h:"null",h=="array"||h=="object"&&typeof w.length=="number"){h=o.length||0;const R=w.length||0;o.length=h+R;for(let V=0;V<R;V++)o[h+V]=w[V]}else o.push(w)}}class k{constructor(l,h){this.i=l,this.j=h,this.h=0,this.g=null}get(){let l;return this.h>0?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function C(o){a.setTimeout(()=>{throw o},0)}function D(){var o=E;let l=null;return o.g&&(l=o.g,o.g=o.g.next,o.g||(o.h=null),l.next=null),l}class F{constructor(){this.h=this.g=null}add(l,h){const p=L.get();p.set(l,h),this.h?this.h.next=p:this.g=p,this.h=p}}var L=new k(()=>new q,o=>o.reset());class q{constructor(){this.next=this.g=this.h=null}set(l,h){this.h=l,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let ne,J=!1,E=new F,g=()=>{const o=Promise.resolve(void 0);ne=()=>{o.then(v)}};function v(){for(var o;o=D();){try{o.h.call(o.g)}catch(h){C(h)}var l=L;l.j(o),l.h<100&&(l.h++,o.next=l.g,l.g=o)}J=!1}function I(){this.u=this.u,this.C=this.C}I.prototype.u=!1,I.prototype.dispose=function(){this.u||(this.u=!0,this.N())},I.prototype[Symbol.dispose]=function(){this.dispose()},I.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function T(o,l){this.type=o,this.g=this.target=l,this.defaultPrevented=!1}T.prototype.h=function(){this.defaultPrevented=!0};var A=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var o=!1,l=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const h=()=>{};a.addEventListener("test",h,l),a.removeEventListener("test",h,l)}catch{}return o})();function y(o){return/^[\s\xa0]*$/.test(o)}function Ae(o,l){T.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o&&this.init(o,l)}m(Ae,T),Ae.prototype.init=function(o,l){const h=this.type=o.type,p=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;this.target=o.target||o.srcElement,this.g=l,l=o.relatedTarget,l||(h=="mouseover"?l=o.fromElement:h=="mouseout"&&(l=o.toElement)),this.relatedTarget=l,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=o.pointerType,this.state=o.state,this.i=o,o.defaultPrevented&&Ae.Z.h.call(this)},Ae.prototype.h=function(){Ae.Z.h.call(this);const o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var kt="closure_listenable_"+(Math.random()*1e6|0),ld=0;function ud(o,l,h,p,w){this.listener=o,this.proxy=null,this.src=l,this.type=h,this.capture=!!p,this.ha=w,this.key=++ld,this.da=this.fa=!1}function wr(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function Ar(o,l,h){for(const p in o)l.call(h,o[p],p,o)}function hd(o,l){for(const h in o)l.call(void 0,o[h],h,o)}function Ko(o){const l={};for(const h in o)l[h]=o[h];return l}const Qo="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Jo(o,l){let h,p;for(let w=1;w<arguments.length;w++){p=arguments[w];for(h in p)o[h]=p[h];for(let R=0;R<Qo.length;R++)h=Qo[R],Object.prototype.hasOwnProperty.call(p,h)&&(o[h]=p[h])}}function br(o){this.src=o,this.g={},this.h=0}br.prototype.add=function(o,l,h,p,w){const R=o.toString();o=this.g[R],o||(o=this.g[R]=[],this.h++);const V=Ws(o,l,p,w);return V>-1?(l=o[V],h||(l.fa=!1)):(l=new ud(l,this.src,R,!!p,w),l.fa=h,o.push(l)),l};function Gs(o,l){const h=l.type;if(h in o.g){var p=o.g[h],w=Array.prototype.indexOf.call(p,l,void 0),R;(R=w>=0)&&Array.prototype.splice.call(p,w,1),R&&(wr(l),o.g[h].length==0&&(delete o.g[h],o.h--))}}function Ws(o,l,h,p){for(let w=0;w<o.length;++w){const R=o[w];if(!R.da&&R.listener==l&&R.capture==!!h&&R.ha==p)return w}return-1}var Ks="closure_lm_"+(Math.random()*1e6|0),Qs={};function Yo(o,l,h,p,w){if(Array.isArray(l)){for(let R=0;R<l.length;R++)Yo(o,l[R],h,p,w);return null}return h=ea(h),o&&o[kt]?o.J(l,h,c(p)?!!p.capture:!1,w):dd(o,l,h,!1,p,w)}function dd(o,l,h,p,w,R){if(!l)throw Error("Invalid event type");const V=c(w)?!!w.capture:!!w;let z=Ys(o);if(z||(o[Ks]=z=new br(o)),h=z.add(l,h,p,V,R),h.proxy)return h;if(p=fd(),h.proxy=p,p.src=o,p.listener=h,o.addEventListener)A||(w=V),w===void 0&&(w=!1),o.addEventListener(l.toString(),p,w);else if(o.attachEvent)o.attachEvent(Zo(l.toString()),p);else if(o.addListener&&o.removeListener)o.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return h}function fd(){function o(h){return l.call(o.src,o.listener,h)}const l=pd;return o}function Xo(o,l,h,p,w){if(Array.isArray(l))for(var R=0;R<l.length;R++)Xo(o,l[R],h,p,w);else p=c(p)?!!p.capture:!!p,h=ea(h),o&&o[kt]?(o=o.i,R=String(l).toString(),R in o.g&&(l=o.g[R],h=Ws(l,h,p,w),h>-1&&(wr(l[h]),Array.prototype.splice.call(l,h,1),l.length==0&&(delete o.g[R],o.h--)))):o&&(o=Ys(o))&&(l=o.g[l.toString()],o=-1,l&&(o=Ws(l,h,p,w)),(h=o>-1?l[o]:null)&&Js(h))}function Js(o){if(typeof o!="number"&&o&&!o.da){var l=o.src;if(l&&l[kt])Gs(l.i,o);else{var h=o.type,p=o.proxy;l.removeEventListener?l.removeEventListener(h,p,o.capture):l.detachEvent?l.detachEvent(Zo(h),p):l.addListener&&l.removeListener&&l.removeListener(p),(h=Ys(l))?(Gs(h,o),h.h==0&&(h.src=null,l[Ks]=null)):wr(o)}}}function Zo(o){return o in Qs?Qs[o]:Qs[o]="on"+o}function pd(o,l){if(o.da)o=!0;else{l=new Ae(l,this);const h=o.listener,p=o.ha||o.src;o.fa&&Js(o),o=h.call(p,l)}return o}function Ys(o){return o=o[Ks],o instanceof br?o:null}var Xs="__closure_events_fn_"+(Math.random()*1e9>>>0);function ea(o){return typeof o=="function"?o:(o[Xs]||(o[Xs]=function(l){return o.handleEvent(l)}),o[Xs])}function ge(){I.call(this),this.i=new br(this),this.M=this,this.G=null}m(ge,I),ge.prototype[kt]=!0,ge.prototype.removeEventListener=function(o,l,h,p){Xo(this,o,l,h,p)};function Te(o,l){var h,p=o.G;if(p)for(h=[];p;p=p.G)h.push(p);if(o=o.M,p=l.type||l,typeof l=="string")l=new T(l,o);else if(l instanceof T)l.target=l.target||o;else{var w=l;l=new T(p,o),Jo(l,w)}w=!0;let R,V;if(h)for(V=h.length-1;V>=0;V--)R=l.g=h[V],w=Rr(R,p,!0,l)&&w;if(R=l.g=o,w=Rr(R,p,!0,l)&&w,w=Rr(R,p,!1,l)&&w,h)for(V=0;V<h.length;V++)R=l.g=h[V],w=Rr(R,p,!1,l)&&w}ge.prototype.N=function(){if(ge.Z.N.call(this),this.i){var o=this.i;for(const l in o.g){const h=o.g[l];for(let p=0;p<h.length;p++)wr(h[p]);delete o.g[l],o.h--}}this.G=null},ge.prototype.J=function(o,l,h,p){return this.i.add(String(o),l,!1,h,p)},ge.prototype.K=function(o,l,h,p){return this.i.add(String(o),l,!0,h,p)};function Rr(o,l,h,p){if(l=o.i.g[String(l)],!l)return!0;l=l.concat();let w=!0;for(let R=0;R<l.length;++R){const V=l[R];if(V&&!V.da&&V.capture==h){const z=V.listener,ae=V.ha||V.src;V.fa&&Gs(o.i,V),w=z.call(ae,p)!==!1&&w}}return w&&!p.defaultPrevented}function md(o,l){if(typeof o!="function")if(o&&typeof o.handleEvent=="function")o=d(o.handleEvent,o);else throw Error("Invalid listener argument");return Number(l)>2147483647?-1:a.setTimeout(o,l||0)}function ta(o){o.g=md(()=>{o.g=null,o.i&&(o.i=!1,ta(o))},o.l);const l=o.h;o.h=null,o.m.apply(null,l)}class gd extends I{constructor(l,h){super(),this.m=l,this.l=h,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:ta(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function bn(o){I.call(this),this.h=o,this.g={}}m(bn,I);var na=[];function ra(o){Ar(o.g,function(l,h){this.g.hasOwnProperty(h)&&Js(l)},o),o.g={}}bn.prototype.N=function(){bn.Z.N.call(this),ra(this)},bn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Zs=a.JSON.stringify,_d=a.JSON.parse,yd=class{stringify(o){return a.JSON.stringify(o,void 0)}parse(o){return a.JSON.parse(o,void 0)}};function sa(){}function ia(){}var Rn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ei(){T.call(this,"d")}m(ei,T);function ti(){T.call(this,"c")}m(ti,T);var Nt={},oa=null;function Sr(){return oa=oa||new ge}Nt.Ia="serverreachability";function aa(o){T.call(this,Nt.Ia,o)}m(aa,T);function Sn(o){const l=Sr();Te(l,new aa(l))}Nt.STAT_EVENT="statevent";function ca(o,l){T.call(this,Nt.STAT_EVENT,o),this.stat=l}m(ca,T);function Ie(o){const l=Sr();Te(l,new ca(l,o))}Nt.Ja="timingevent";function la(o,l){T.call(this,Nt.Ja,o),this.size=l}m(la,T);function Cn(o,l){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){o()},l)}function Pn(){this.g=!0}Pn.prototype.ua=function(){this.g=!1};function vd(o,l,h,p,w,R){o.info(function(){if(o.g)if(R){var V="",z=R.split("&");for(let Y=0;Y<z.length;Y++){var ae=z[Y].split("=");if(ae.length>1){const ue=ae[0];ae=ae[1];const Me=ue.split("_");V=Me.length>=2&&Me[1]=="type"?V+(ue+"="+ae+"&"):V+(ue+"=redacted&")}}}else V=null;else V=R;return"XMLHTTP REQ ("+p+") [attempt "+w+"]: "+l+`
`+h+`
`+V})}function Ed(o,l,h,p,w,R,V){o.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+w+"]: "+l+`
`+h+`
`+R+" "+V})}function Xt(o,l,h,p){o.info(function(){return"XMLHTTP TEXT ("+l+"): "+Id(o,h)+(p?" "+p:"")})}function Td(o,l){o.info(function(){return"TIMEOUT: "+l})}Pn.prototype.info=function(){};function Id(o,l){if(!o.g)return l;if(!l)return null;try{const R=JSON.parse(l);if(R){for(o=0;o<R.length;o++)if(Array.isArray(R[o])){var h=R[o];if(!(h.length<2)){var p=h[1];if(Array.isArray(p)&&!(p.length<1)){var w=p[0];if(w!="noop"&&w!="stop"&&w!="close")for(let V=1;V<p.length;V++)p[V]=""}}}}return Zs(R)}catch{return l}}var Cr={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},ua={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},ha;function ni(){}m(ni,sa),ni.prototype.g=function(){return new XMLHttpRequest},ha=new ni;function kn(o){return encodeURIComponent(String(o))}function wd(o){var l=1;o=o.split(":");const h=[];for(;l>0&&o.length;)h.push(o.shift()),l--;return o.length&&h.push(o.join(":")),h}function st(o,l,h,p){this.j=o,this.i=l,this.l=h,this.S=p||1,this.V=new bn(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new da}function da(){this.i=null,this.g="",this.h=!1}var fa={},ri={};function si(o,l,h){o.M=1,o.A=kr(Oe(l)),o.u=h,o.R=!0,pa(o,null)}function pa(o,l){o.F=Date.now(),Pr(o),o.B=Oe(o.A);var h=o.B,p=o.S;Array.isArray(p)||(p=[String(p)]),Sa(h.i,"t",p),o.C=0,h=o.j.L,o.h=new da,o.g=Ha(o.j,h?l:null,!o.u),o.P>0&&(o.O=new gd(d(o.Y,o,o.g),o.P)),l=o.V,h=o.g,p=o.ba;var w="readystatechange";Array.isArray(w)||(w&&(na[0]=w.toString()),w=na);for(let R=0;R<w.length;R++){const V=Yo(h,w[R],p||l.handleEvent,!1,l.h||l);if(!V)break;l.g[V.key]=V}l=o.J?Ko(o.J):{},o.u?(o.v||(o.v="POST"),l["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.B,o.v,o.u,l)):(o.v="GET",o.g.ea(o.B,o.v,null,l)),Sn(),vd(o.i,o.v,o.B,o.l,o.S,o.u)}st.prototype.ba=function(o){o=o.target;const l=this.O;l&&at(o)==3?l.j():this.Y(o)},st.prototype.Y=function(o){try{if(o==this.g)e:{const z=at(this.g),ae=this.g.ya(),Y=this.g.ca();if(!(z<3)&&(z!=3||this.g&&(this.h.h||this.g.la()||xa(this.g)))){this.K||z!=4||ae==7||(ae==8||Y<=0?Sn(3):Sn(2)),ii(this);var l=this.g.ca();this.X=l;var h=Ad(this);if(this.o=l==200,Ed(this.i,this.v,this.B,this.l,this.S,z,l),this.o){if(this.U&&!this.L){t:{if(this.g){var p,w=this.g;if((p=w.g?w.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!y(p)){var R=p;break t}}R=null}if(o=R)Xt(this.i,this.l,o,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,oi(this,o);else{this.o=!1,this.m=3,Ie(12),Dt(this),Nn(this);break e}}if(this.R){o=!0;let ue;for(;!this.K&&this.C<h.length;)if(ue=bd(this,h),ue==ri){z==4&&(this.m=4,Ie(14),o=!1),Xt(this.i,this.l,null,"[Incomplete Response]");break}else if(ue==fa){this.m=4,Ie(15),Xt(this.i,this.l,h,"[Invalid Chunk]"),o=!1;break}else Xt(this.i,this.l,ue,null),oi(this,ue);if(ma(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),z!=4||h.length!=0||this.h.h||(this.m=1,Ie(16),o=!1),this.o=this.o&&o,!o)Xt(this.i,this.l,h,"[Invalid Chunked Response]"),Dt(this),Nn(this);else if(h.length>0&&!this.W){this.W=!0;var V=this.j;V.g==this&&V.aa&&!V.P&&(V.j.info("Great, no buffering proxy detected. Bytes received: "+h.length),pi(V),V.P=!0,Ie(11))}}else Xt(this.i,this.l,h,null),oi(this,h);z==4&&Dt(this),this.o&&!this.K&&(z==4?$a(this.j,this):(this.o=!1,Pr(this)))}else Ud(this.g),l==400&&h.indexOf("Unknown SID")>0?(this.m=3,Ie(12)):(this.m=0,Ie(13)),Dt(this),Nn(this)}}}catch{}};function Ad(o){if(!ma(o))return o.g.la();const l=xa(o.g);if(l==="")return"";let h="";const p=l.length,w=at(o.g)==4;if(!o.h.i){if(typeof TextDecoder>"u")return Dt(o),Nn(o),"";o.h.i=new a.TextDecoder}for(let R=0;R<p;R++)o.h.h=!0,h+=o.h.i.decode(l[R],{stream:!(w&&R==p-1)});return l.length=0,o.h.g+=h,o.C=0,o.h.g}function ma(o){return o.g?o.v=="GET"&&o.M!=2&&o.j.Aa:!1}function bd(o,l){var h=o.C,p=l.indexOf(`
`,h);return p==-1?ri:(h=Number(l.substring(h,p)),isNaN(h)?fa:(p+=1,p+h>l.length?ri:(l=l.slice(p,p+h),o.C=p+h,l)))}st.prototype.cancel=function(){this.K=!0,Dt(this)};function Pr(o){o.T=Date.now()+o.H,ga(o,o.H)}function ga(o,l){if(o.D!=null)throw Error("WatchDog timer not null");o.D=Cn(d(o.aa,o),l)}function ii(o){o.D&&(a.clearTimeout(o.D),o.D=null)}st.prototype.aa=function(){this.D=null;const o=Date.now();o-this.T>=0?(Td(this.i,this.B),this.M!=2&&(Sn(),Ie(17)),Dt(this),this.m=2,Nn(this)):ga(this,this.T-o)};function Nn(o){o.j.I==0||o.K||$a(o.j,o)}function Dt(o){ii(o);var l=o.O;l&&typeof l.dispose=="function"&&l.dispose(),o.O=null,ra(o.V),o.g&&(l=o.g,o.g=null,l.abort(),l.dispose())}function oi(o,l){try{var h=o.j;if(h.I!=0&&(h.g==o||ai(h.h,o))){if(!o.L&&ai(h.h,o)&&h.I==3){try{var p=h.Ba.g.parse(l)}catch{p=null}if(Array.isArray(p)&&p.length==3){var w=p;if(w[0]==0){e:if(!h.v){if(h.g)if(h.g.F+3e3<o.F)Lr(h),Vr(h);else break e;fi(h),Ie(18)}}else h.xa=w[1],0<h.xa-h.K&&w[2]<37500&&h.F&&h.A==0&&!h.C&&(h.C=Cn(d(h.Va,h),6e3));va(h.h)<=1&&h.ta&&(h.ta=void 0)}else xt(h,11)}else if((o.L||h.g==o)&&Lr(h),!y(l))for(w=h.Ba.g.parse(l),l=0;l<w.length;l++){let Y=w[l];const ue=Y[0];if(!(ue<=h.K))if(h.K=ue,Y=Y[1],h.I==2)if(Y[0]=="c"){h.M=Y[1],h.ba=Y[2];const Me=Y[3];Me!=null&&(h.ka=Me,h.j.info("VER="+h.ka));const Lt=Y[4];Lt!=null&&(h.za=Lt,h.j.info("SVER="+h.za));const ct=Y[5];ct!=null&&typeof ct=="number"&&ct>0&&(p=1.5*ct,h.O=p,h.j.info("backChannelRequestTimeoutMs_="+p)),p=h;const lt=o.g;if(lt){const Mr=lt.g?lt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Mr){var R=p.h;R.g||Mr.indexOf("spdy")==-1&&Mr.indexOf("quic")==-1&&Mr.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&(ci(R,R.h),R.h=null))}if(p.G){const mi=lt.g?lt.g.getResponseHeader("X-HTTP-Session-Id"):null;mi&&(p.wa=mi,X(p.J,p.G,mi))}}h.I=3,h.l&&h.l.ra(),h.aa&&(h.T=Date.now()-o.F,h.j.info("Handshake RTT: "+h.T+"ms")),p=h;var V=o;if(p.na=qa(p,p.L?p.ba:null,p.W),V.L){Ea(p.h,V);var z=V,ae=p.O;ae&&(z.H=ae),z.D&&(ii(z),Pr(z)),p.g=V}else Ua(p);h.i.length>0&&xr(h)}else Y[0]!="stop"&&Y[0]!="close"||xt(h,7);else h.I==3&&(Y[0]=="stop"||Y[0]=="close"?Y[0]=="stop"?xt(h,7):di(h):Y[0]!="noop"&&h.l&&h.l.qa(Y),h.A=0)}}Sn(4)}catch{}}var Rd=class{constructor(o,l){this.g=o,this.map=l}};function _a(o){this.l=o||10,a.PerformanceNavigationTiming?(o=a.performance.getEntriesByType("navigation"),o=o.length>0&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function ya(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function va(o){return o.h?1:o.g?o.g.size:0}function ai(o,l){return o.h?o.h==l:o.g?o.g.has(l):!1}function ci(o,l){o.g?o.g.add(l):o.h=l}function Ea(o,l){o.h&&o.h==l?o.h=null:o.g&&o.g.has(l)&&o.g.delete(l)}_a.prototype.cancel=function(){if(this.i=Ta(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const o of this.g.values())o.cancel();this.g.clear()}};function Ta(o){if(o.h!=null)return o.i.concat(o.h.G);if(o.g!=null&&o.g.size!==0){let l=o.i;for(const h of o.g.values())l=l.concat(h.G);return l}return b(o.i)}var Ia=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Sd(o,l){if(o){o=o.split("&");for(let h=0;h<o.length;h++){const p=o[h].indexOf("=");let w,R=null;p>=0?(w=o[h].substring(0,p),R=o[h].substring(p+1)):w=o[h],l(w,R?decodeURIComponent(R.replace(/\+/g," ")):"")}}}function it(o){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let l;o instanceof it?(this.l=o.l,Dn(this,o.j),this.o=o.o,this.g=o.g,Vn(this,o.u),this.h=o.h,li(this,Ca(o.i)),this.m=o.m):o&&(l=String(o).match(Ia))?(this.l=!1,Dn(this,l[1]||"",!0),this.o=xn(l[2]||""),this.g=xn(l[3]||"",!0),Vn(this,l[4]),this.h=xn(l[5]||"",!0),li(this,l[6]||"",!0),this.m=xn(l[7]||"")):(this.l=!1,this.i=new On(null,this.l))}it.prototype.toString=function(){const o=[];var l=this.j;l&&o.push(Ln(l,wa,!0),":");var h=this.g;return(h||l=="file")&&(o.push("//"),(l=this.o)&&o.push(Ln(l,wa,!0),"@"),o.push(kn(h).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.u,h!=null&&o.push(":",String(h))),(h=this.h)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(Ln(h,h.charAt(0)=="/"?kd:Pd,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",Ln(h,Dd)),o.join("")},it.prototype.resolve=function(o){const l=Oe(this);let h=!!o.j;h?Dn(l,o.j):h=!!o.o,h?l.o=o.o:h=!!o.g,h?l.g=o.g:h=o.u!=null;var p=o.h;if(h)Vn(l,o.u);else if(h=!!o.h){if(p.charAt(0)!="/")if(this.g&&!this.h)p="/"+p;else{var w=l.h.lastIndexOf("/");w!=-1&&(p=l.h.slice(0,w+1)+p)}if(w=p,w==".."||w==".")p="";else if(w.indexOf("./")!=-1||w.indexOf("/.")!=-1){p=w.lastIndexOf("/",0)==0,w=w.split("/");const R=[];for(let V=0;V<w.length;){const z=w[V++];z=="."?p&&V==w.length&&R.push(""):z==".."?((R.length>1||R.length==1&&R[0]!="")&&R.pop(),p&&V==w.length&&R.push("")):(R.push(z),p=!0)}p=R.join("/")}else p=w}return h?l.h=p:h=o.i.toString()!=="",h?li(l,Ca(o.i)):h=!!o.m,h&&(l.m=o.m),l};function Oe(o){return new it(o)}function Dn(o,l,h){o.j=h?xn(l,!0):l,o.j&&(o.j=o.j.replace(/:$/,""))}function Vn(o,l){if(l){if(l=Number(l),isNaN(l)||l<0)throw Error("Bad port number "+l);o.u=l}else o.u=null}function li(o,l,h){l instanceof On?(o.i=l,Vd(o.i,o.l)):(h||(l=Ln(l,Nd)),o.i=new On(l,o.l))}function X(o,l,h){o.i.set(l,h)}function kr(o){return X(o,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),o}function xn(o,l){return o?l?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Ln(o,l,h){return typeof o=="string"?(o=encodeURI(o).replace(l,Cd),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Cd(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var wa=/[#\/\?@]/g,Pd=/[#\?:]/g,kd=/[#\?]/g,Nd=/[#\?@]/g,Dd=/#/g;function On(o,l){this.h=this.g=null,this.i=o||null,this.j=!!l}function Vt(o){o.g||(o.g=new Map,o.h=0,o.i&&Sd(o.i,function(l,h){o.add(decodeURIComponent(l.replace(/\+/g," ")),h)}))}n=On.prototype,n.add=function(o,l){Vt(this),this.i=null,o=Zt(this,o);let h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(l),this.h+=1,this};function Aa(o,l){Vt(o),l=Zt(o,l),o.g.has(l)&&(o.i=null,o.h-=o.g.get(l).length,o.g.delete(l))}function ba(o,l){return Vt(o),l=Zt(o,l),o.g.has(l)}n.forEach=function(o,l){Vt(this),this.g.forEach(function(h,p){h.forEach(function(w){o.call(l,w,p,this)},this)},this)};function Ra(o,l){Vt(o);let h=[];if(typeof l=="string")ba(o,l)&&(h=h.concat(o.g.get(Zt(o,l))));else for(o=Array.from(o.g.values()),l=0;l<o.length;l++)h=h.concat(o[l]);return h}n.set=function(o,l){return Vt(this),this.i=null,o=Zt(this,o),ba(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[l]),this.h+=1,this},n.get=function(o,l){return o?(o=Ra(this,o),o.length>0?String(o[0]):l):l};function Sa(o,l,h){Aa(o,l),h.length>0&&(o.i=null,o.g.set(Zt(o,l),b(h)),o.h+=h.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],l=Array.from(this.g.keys());for(let p=0;p<l.length;p++){var h=l[p];const w=kn(h);h=Ra(this,h);for(let R=0;R<h.length;R++){let V=w;h[R]!==""&&(V+="="+kn(h[R])),o.push(V)}}return this.i=o.join("&")};function Ca(o){const l=new On;return l.i=o.i,o.g&&(l.g=new Map(o.g),l.h=o.h),l}function Zt(o,l){return l=String(l),o.j&&(l=l.toLowerCase()),l}function Vd(o,l){l&&!o.j&&(Vt(o),o.i=null,o.g.forEach(function(h,p){const w=p.toLowerCase();p!=w&&(Aa(this,p),Sa(this,w,h))},o)),o.j=l}function xd(o,l){const h=new Pn;if(a.Image){const p=new Image;p.onload=f(ot,h,"TestLoadImage: loaded",!0,l,p),p.onerror=f(ot,h,"TestLoadImage: error",!1,l,p),p.onabort=f(ot,h,"TestLoadImage: abort",!1,l,p),p.ontimeout=f(ot,h,"TestLoadImage: timeout",!1,l,p),a.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=o}else l(!1)}function Ld(o,l){const h=new Pn,p=new AbortController,w=setTimeout(()=>{p.abort(),ot(h,"TestPingServer: timeout",!1,l)},1e4);fetch(o,{signal:p.signal}).then(R=>{clearTimeout(w),R.ok?ot(h,"TestPingServer: ok",!0,l):ot(h,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(w),ot(h,"TestPingServer: error",!1,l)})}function ot(o,l,h,p,w){try{w&&(w.onload=null,w.onerror=null,w.onabort=null,w.ontimeout=null),p(h)}catch{}}function Od(){this.g=new yd}function ui(o){this.i=o.Sb||null,this.h=o.ab||!1}m(ui,sa),ui.prototype.g=function(){return new Nr(this.i,this.h)};function Nr(o,l){ge.call(this),this.H=o,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}m(Nr,ge),n=Nr.prototype,n.open=function(o,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=o,this.D=l,this.readyState=1,Fn(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const l={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};o&&(l.body=o),(this.H||a).fetch(new Request(this.D,l)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Mn(this)),this.readyState=0},n.Pa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Fn(this)),this.g&&(this.readyState=3,Fn(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Pa(this)}else o.text().then(this.Oa.bind(this),this.ga.bind(this))};function Pa(o){o.j.read().then(o.Ma.bind(o)).catch(o.ga.bind(o))}n.Ma=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var l=o.value?o.value:new Uint8Array(0);(l=this.B.decode(l,{stream:!o.done}))&&(this.response=this.responseText+=l)}o.done?Mn(this):Fn(this),this.readyState==3&&Pa(this)}},n.Oa=function(o){this.g&&(this.response=this.responseText=o,Mn(this))},n.Na=function(o){this.g&&(this.response=o,Mn(this))},n.ga=function(){this.g&&Mn(this)};function Mn(o){o.readyState=4,o.l=null,o.j=null,o.B=null,Fn(o)}n.setRequestHeader=function(o,l){this.A.append(o,l)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],l=this.h.entries();for(var h=l.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=l.next();return o.join(`\r
`)};function Fn(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Nr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function ka(o){let l="";return Ar(o,function(h,p){l+=p,l+=":",l+=h,l+=`\r
`}),l}function hi(o,l,h){e:{for(p in h){var p=!1;break e}p=!0}p||(h=ka(h),typeof o=="string"?h!=null&&kn(h):X(o,l,h))}function re(o){ge.call(this),this.headers=new Map,this.L=o||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}m(re,ge);var Md=/^https?$/i,Fd=["POST","PUT"];n=re.prototype,n.Fa=function(o){this.H=o},n.ea=function(o,l,h,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);l=l?l.toUpperCase():"GET",this.D=o,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():ha.g(),this.g.onreadystatechange=_(d(this.Ca,this));try{this.B=!0,this.g.open(l,String(o),!0),this.B=!1}catch(R){Na(this,R);return}if(o=h||"",h=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var w in p)h.set(w,p[w]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(const R of p.keys())h.set(R,p.get(R));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(h.keys()).find(R=>R.toLowerCase()=="content-type"),w=a.FormData&&o instanceof a.FormData,!(Array.prototype.indexOf.call(Fd,l,void 0)>=0)||p||w||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[R,V]of h)this.g.setRequestHeader(R,V);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(o),this.v=!1}catch(R){Na(this,R)}};function Na(o,l){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=l,o.o=5,Da(o),Dr(o)}function Da(o){o.A||(o.A=!0,Te(o,"complete"),Te(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=o||7,Te(this,"complete"),Te(this,"abort"),Dr(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Dr(this,!0)),re.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Va(this):this.Xa())},n.Xa=function(){Va(this)};function Va(o){if(o.h&&typeof i<"u"){if(o.v&&at(o)==4)setTimeout(o.Ca.bind(o),0);else if(Te(o,"readystatechange"),at(o)==4){o.h=!1;try{const R=o.ca();e:switch(R){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var h;if(!(h=l)){var p;if(p=R===0){let V=String(o.D).match(Ia)[1]||null;!V&&a.self&&a.self.location&&(V=a.self.location.protocol.slice(0,-1)),p=!Md.test(V?V.toLowerCase():"")}h=p}if(h)Te(o,"complete"),Te(o,"success");else{o.o=6;try{var w=at(o)>2?o.g.statusText:""}catch{w=""}o.l=w+" ["+o.ca()+"]",Da(o)}}finally{Dr(o)}}}}function Dr(o,l){if(o.g){o.m&&(clearTimeout(o.m),o.m=null);const h=o.g;o.g=null,l||Te(o,"ready");try{h.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function at(o){return o.g?o.g.readyState:0}n.ca=function(){try{return at(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(o){if(this.g){var l=this.g.responseText;return o&&l.indexOf(o)==0&&(l=l.substring(o.length)),_d(l)}};function xa(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.F){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function Ud(o){const l={};o=(o.g&&at(o)>=2&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<o.length;p++){if(y(o[p]))continue;var h=wd(o[p]);const w=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();const R=l[w]||[];l[w]=R,R.push(h)}hd(l,function(p){return p.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Un(o,l,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||l}function La(o){this.za=0,this.i=[],this.j=new Pn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Un("failFast",!1,o),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Un("baseRetryDelayMs",5e3,o),this.Za=Un("retryDelaySeedMs",1e4,o),this.Ta=Un("forwardChannelMaxRetries",2,o),this.va=Un("forwardChannelRequestTimeoutMs",2e4,o),this.ma=o&&o.xmlHttpFactory||void 0,this.Ua=o&&o.Rb||void 0,this.Aa=o&&o.useFetchStreams||!1,this.O=void 0,this.L=o&&o.supportsCrossDomainXhr||!1,this.M="",this.h=new _a(o&&o.concurrentRequestLimit),this.Ba=new Od,this.S=o&&o.fastHandshake||!1,this.R=o&&o.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=o&&o.Pb||!1,o&&o.ua&&this.j.ua(),o&&o.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&o&&o.detectBufferingProxy||!1,this.ia=void 0,o&&o.longPollingTimeout&&o.longPollingTimeout>0&&(this.ia=o.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=La.prototype,n.ka=8,n.I=1,n.connect=function(o,l,h,p){Ie(0),this.W=o,this.H=l||{},h&&p!==void 0&&(this.H.OSID=h,this.H.OAID=p),this.F=this.X,this.J=qa(this,null,this.W),xr(this)};function di(o){if(Oa(o),o.I==3){var l=o.V++,h=Oe(o.J);if(X(h,"SID",o.M),X(h,"RID",l),X(h,"TYPE","terminate"),Bn(o,h),l=new st(o,o.j,l),l.M=2,l.A=kr(Oe(h)),h=!1,a.navigator&&a.navigator.sendBeacon)try{h=a.navigator.sendBeacon(l.A.toString(),"")}catch{}!h&&a.Image&&(new Image().src=l.A,h=!0),h||(l.g=Ha(l.j,null),l.g.ea(l.A)),l.F=Date.now(),Pr(l)}za(o)}function Vr(o){o.g&&(pi(o),o.g.cancel(),o.g=null)}function Oa(o){Vr(o),o.v&&(a.clearTimeout(o.v),o.v=null),Lr(o),o.h.cancel(),o.m&&(typeof o.m=="number"&&a.clearTimeout(o.m),o.m=null)}function xr(o){if(!ya(o.h)&&!o.m){o.m=!0;var l=o.Ea;ne||g(),J||(ne(),J=!0),E.add(l,o),o.D=0}}function Bd(o,l){return va(o.h)>=o.h.j-(o.m?1:0)?!1:o.m?(o.i=l.G.concat(o.i),!0):o.I==1||o.I==2||o.D>=(o.Sa?0:o.Ta)?!1:(o.m=Cn(d(o.Ea,o,l),ja(o,o.D)),o.D++,!0)}n.Ea=function(o){if(this.m)if(this.m=null,this.I==1){if(!o){this.V=Math.floor(Math.random()*1e5),o=this.V++;const w=new st(this,this.j,o);let R=this.o;if(this.U&&(R?(R=Ko(R),Jo(R,this.U)):R=this.U),this.u!==null||this.R||(w.J=R,R=null),this.S)e:{for(var l=0,h=0;h<this.i.length;h++){t:{var p=this.i[h];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(l+=p,l>4096){l=h;break e}if(l===4096||h===this.i.length-1){l=h+1;break e}}l=1e3}else l=1e3;l=Fa(this,w,l),h=Oe(this.J),X(h,"RID",o),X(h,"CVER",22),this.G&&X(h,"X-HTTP-Session-Id",this.G),Bn(this,h),R&&(this.R?l="headers="+kn(ka(R))+"&"+l:this.u&&hi(h,this.u,R)),ci(this.h,w),this.Ra&&X(h,"TYPE","init"),this.S?(X(h,"$req",l),X(h,"SID","null"),w.U=!0,si(w,h,null)):si(w,h,l),this.I=2}}else this.I==3&&(o?Ma(this,o):this.i.length==0||ya(this.h)||Ma(this))};function Ma(o,l){var h;l?h=l.l:h=o.V++;const p=Oe(o.J);X(p,"SID",o.M),X(p,"RID",h),X(p,"AID",o.K),Bn(o,p),o.u&&o.o&&hi(p,o.u,o.o),h=new st(o,o.j,h,o.D+1),o.u===null&&(h.J=o.o),l&&(o.i=l.G.concat(o.i)),l=Fa(o,h,1e3),h.H=Math.round(o.va*.5)+Math.round(o.va*.5*Math.random()),ci(o.h,h),si(h,p,l)}function Bn(o,l){o.H&&Ar(o.H,function(h,p){X(l,p,h)}),o.l&&Ar({},function(h,p){X(l,p,h)})}function Fa(o,l,h){h=Math.min(o.i.length,h);const p=o.l?d(o.l.Ka,o.l,o):null;e:{var w=o.i;let z=-1;for(;;){const ae=["count="+h];z==-1?h>0?(z=w[0].g,ae.push("ofs="+z)):z=0:ae.push("ofs="+z);let Y=!0;for(let ue=0;ue<h;ue++){var R=w[ue].g;const Me=w[ue].map;if(R-=z,R<0)z=Math.max(0,w[ue].g-100),Y=!1;else try{R="req"+R+"_"||"";try{var V=Me instanceof Map?Me:Object.entries(Me);for(const[Lt,ct]of V){let lt=ct;c(ct)&&(lt=Zs(ct)),ae.push(R+Lt+"="+encodeURIComponent(lt))}}catch(Lt){throw ae.push(R+"type="+encodeURIComponent("_badmap")),Lt}}catch{p&&p(Me)}}if(Y){V=ae.join("&");break e}}V=void 0}return o=o.i.splice(0,h),l.G=o,V}function Ua(o){if(!o.g&&!o.v){o.Y=1;var l=o.Da;ne||g(),J||(ne(),J=!0),E.add(l,o),o.A=0}}function fi(o){return o.g||o.v||o.A>=3?!1:(o.Y++,o.v=Cn(d(o.Da,o),ja(o,o.A)),o.A++,!0)}n.Da=function(){if(this.v=null,Ba(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var o=4*this.T;this.j.info("BP detection timer enabled: "+o),this.B=Cn(d(this.Wa,this),o)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ie(10),Vr(this),Ba(this))};function pi(o){o.B!=null&&(a.clearTimeout(o.B),o.B=null)}function Ba(o){o.g=new st(o,o.j,"rpc",o.Y),o.u===null&&(o.g.J=o.o),o.g.P=0;var l=Oe(o.na);X(l,"RID","rpc"),X(l,"SID",o.M),X(l,"AID",o.K),X(l,"CI",o.F?"0":"1"),!o.F&&o.ia&&X(l,"TO",o.ia),X(l,"TYPE","xmlhttp"),Bn(o,l),o.u&&o.o&&hi(l,o.u,o.o),o.O&&(o.g.H=o.O);var h=o.g;o=o.ba,h.M=1,h.A=kr(Oe(l)),h.u=null,h.R=!0,pa(h,o)}n.Va=function(){this.C!=null&&(this.C=null,Vr(this),fi(this),Ie(19))};function Lr(o){o.C!=null&&(a.clearTimeout(o.C),o.C=null)}function $a(o,l){var h=null;if(o.g==l){Lr(o),pi(o),o.g=null;var p=2}else if(ai(o.h,l))h=l.G,Ea(o.h,l),p=1;else return;if(o.I!=0){if(l.o)if(p==1){h=l.u?l.u.length:0,l=Date.now()-l.F;var w=o.D;p=Sr(),Te(p,new la(p,h)),xr(o)}else Ua(o);else if(w=l.m,w==3||w==0&&l.X>0||!(p==1&&Bd(o,l)||p==2&&fi(o)))switch(h&&h.length>0&&(l=o.h,l.i=l.i.concat(h)),w){case 1:xt(o,5);break;case 4:xt(o,10);break;case 3:xt(o,6);break;default:xt(o,2)}}}function ja(o,l){let h=o.Qa+Math.floor(Math.random()*o.Za);return o.isActive()||(h*=2),h*l}function xt(o,l){if(o.j.info("Error code "+l),l==2){var h=d(o.bb,o),p=o.Ua;const w=!p;p=new it(p||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Dn(p,"https"),kr(p),w?xd(p.toString(),h):Ld(p.toString(),h)}else Ie(2);o.I=0,o.l&&o.l.pa(l),za(o),Oa(o)}n.bb=function(o){o?(this.j.info("Successfully pinged google.com"),Ie(2)):(this.j.info("Failed to ping google.com"),Ie(1))};function za(o){if(o.I=0,o.ja=[],o.l){const l=Ta(o.h);(l.length!=0||o.i.length!=0)&&(S(o.ja,l),S(o.ja,o.i),o.h.i.length=0,b(o.i),o.i.length=0),o.l.oa()}}function qa(o,l,h){var p=h instanceof it?Oe(h):new it(h);if(p.g!="")l&&(p.g=l+"."+p.g),Vn(p,p.u);else{var w=a.location;p=w.protocol,l=l?l+"."+w.hostname:w.hostname,w=+w.port;const R=new it(null);p&&Dn(R,p),l&&(R.g=l),w&&Vn(R,w),h&&(R.h=h),p=R}return h=o.G,l=o.wa,h&&l&&X(p,h,l),X(p,"VER",o.ka),Bn(o,p),p}function Ha(o,l,h){if(l&&!o.L)throw Error("Can't create secondary domain capable XhrIo object.");return l=o.Aa&&!o.ma?new re(new ui({ab:h})):new re(o.ma),l.Fa(o.L),l}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ga(){}n=Ga.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Or(){}Or.prototype.g=function(o,l){return new Re(o,l)};function Re(o,l){ge.call(this),this.g=new La(l),this.l=o,this.h=l&&l.messageUrlParams||null,o=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(o?o["X-WebChannel-Content-Type"]=l.messageContentType:o={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.sa&&(o?o["X-WebChannel-Client-Profile"]=l.sa:o={"X-WebChannel-Client-Profile":l.sa}),this.g.U=o,(o=l&&l.Qb)&&!y(o)&&(this.g.u=o),this.A=l&&l.supportsCrossDomainXhr||!1,this.v=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!y(l)&&(this.g.G=l,o=this.h,o!==null&&l in o&&(o=this.h,l in o&&delete o[l])),this.j=new en(this)}m(Re,ge),Re.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Re.prototype.close=function(){di(this.g)},Re.prototype.o=function(o){var l=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.v&&(h={},h.__data__=Zs(o),o=h);l.i.push(new Rd(l.Ya++,o)),l.I==3&&xr(l)},Re.prototype.N=function(){this.g.l=null,delete this.j,di(this.g),delete this.g,Re.Z.N.call(this)};function Wa(o){ei.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var l=o.__sm__;if(l){e:{for(const h in l){o=h;break e}o=void 0}(this.i=o)&&(o=this.i,l=l!==null&&o in l?l[o]:void 0),this.data=l}else this.data=o}m(Wa,ei);function Ka(){ti.call(this),this.status=1}m(Ka,ti);function en(o){this.g=o}m(en,Ga),en.prototype.ra=function(){Te(this.g,"a")},en.prototype.qa=function(o){Te(this.g,new Wa(o))},en.prototype.pa=function(o){Te(this.g,new Ka)},en.prototype.oa=function(){Te(this.g,"b")},Or.prototype.createWebChannel=Or.prototype.g,Re.prototype.send=Re.prototype.o,Re.prototype.open=Re.prototype.m,Re.prototype.close=Re.prototype.close,Wl=function(){return new Or},Gl=function(){return Sr()},Hl=Nt,Li={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Cr.NO_ERROR=0,Cr.TIMEOUT=8,Cr.HTTP_ERROR=6,Qr=Cr,ua.COMPLETE="complete",ql=ua,ia.EventType=Rn,Rn.OPEN="a",Rn.CLOSE="b",Rn.ERROR="c",Rn.MESSAGE="d",ge.prototype.listen=ge.prototype.J,qn=ia,re.prototype.listenOnce=re.prototype.K,re.prototype.getLastError=re.prototype.Ha,re.prototype.getLastErrorCode=re.prototype.ya,re.prototype.getStatus=re.prototype.ca,re.prototype.getResponseJson=re.prototype.La,re.prototype.getResponseText=re.prototype.la,re.prototype.send=re.prototype.ea,re.prototype.setWithCredentials=re.prototype.Fa,zl=re}).apply(typeof Fr<"u"?Fr:typeof self<"u"?self:typeof window<"u"?window:{});class ye{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ye.UNAUTHENTICATED=new ye(null),ye.GOOGLE_CREDENTIALS=new ye("google-credentials-uid"),ye.FIRST_PARTY=new ye("first-party-uid"),ye.MOCK_USER=new ye("mock-user");let En="12.8.0";function bp(n){En=n}const $t=new ro("@firebase/firestore");function tn(){return $t.logLevel}function x(n,...e){if($t.logLevel<=H.DEBUG){const t=e.map(oo);$t.debug(`Firestore (${En}): ${n}`,...t)}}function tt(n,...e){if($t.logLevel<=H.ERROR){const t=e.map(oo);$t.error(`Firestore (${En}): ${n}`,...t)}}function pn(n,...e){if($t.logLevel<=H.WARN){const t=e.map(oo);$t.warn(`Firestore (${En}): ${n}`,...t)}}function oo(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function B(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,Kl(n,r,t)}function Kl(n,e,t){let r=`FIRESTORE (${En}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw tt(r),new Error(r)}function Q(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||Kl(e,s,r)}function j(n,e){return n}const N={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class O extends Ke{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class vt{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Ql{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Rp{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(ye.UNAUTHENTICATED)))}shutdown(){}}class Sp{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Cp{constructor(e){this.t=e,this.currentUser=ye.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Q(this.o===void 0,42304);let r=this.i;const s=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve();let i=new vt;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new vt,e.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const u=i;e.enqueueRetryable((async()=>{await u.promise,await s(this.currentUser)}))},c=u=>{x("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((u=>c(u))),setTimeout((()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?c(u):(x("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new vt)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(x("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Q(typeof r.accessToken=="string",31837,{l:r}),new Ql(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Q(e===null||typeof e=="string",2055,{h:e}),new ye(e)}}class Pp{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=ye.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class kp{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new Pp(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(ye.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class ac{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Np{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Se(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Q(this.o===void 0,3512);const r=i=>{i.error!=null&&x("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.m;return this.m=i.token,x("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable((()=>r(i)))};const s=i=>{x("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((i=>s(i))),setTimeout((()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):x("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new ac(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(Q(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new ac(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Dp(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class ao{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=Dp(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function G(n,e){return n<e?-1:n>e?1:0}function Oi(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),i=e.charAt(r);if(s!==i)return Ti(s)===Ti(i)?G(s,i):Ti(s)?1:-1}return G(n.length,e.length)}const Vp=55296,xp=57343;function Ti(n){const e=n.charCodeAt(0);return e>=Vp&&e<=xp}function mn(n,e,t){return n.length===e.length&&n.every(((r,s)=>t(r,e[s])))}const cc="__name__";class Fe{constructor(e,t,r){t===void 0?t=0:t>e.length&&B(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&B(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Fe.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Fe?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=Fe.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return G(e.length,t.length)}static compareSegments(e,t){const r=Fe.isNumericId(e),s=Fe.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?Fe.extractNumericId(e).compare(Fe.extractNumericId(t)):Oi(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return yt.fromString(e.substring(4,e.length-2))}}class Z extends Fe{construct(e,t,r){return new Z(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new O(N.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((s=>s.length>0)))}return new Z(t)}static emptyPath(){return new Z([])}}const Lp=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class fe extends Fe{construct(e,t,r){return new fe(e,t,r)}static isValidIdentifier(e){return Lp.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),fe.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===cc}static keyField(){return new fe([cc])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new O(N.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const c=e[s];if(c==="\\"){if(s+1===e.length)throw new O(N.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new O(N.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else c==="`"?(a=!a,s++):c!=="."||a?(r+=c,s++):(i(),s++)}if(i(),a)throw new O(N.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new fe(t)}static emptyPath(){return new fe([])}}class M{constructor(e){this.path=e}static fromPath(e){return new M(Z.fromString(e))}static fromName(e){return new M(Z.fromString(e).popFirst(5))}static empty(){return new M(Z.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Z.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Z.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new M(new Z(e.slice()))}}function Jl(n,e,t){if(!t)throw new O(N.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Op(n,e,t,r){if(e===!0&&r===!0)throw new O(N.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function lc(n){if(!M.isDocumentKey(n))throw new O(N.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function uc(n){if(M.isDocumentKey(n))throw new O(N.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Yl(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function co(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":B(12329,{type:typeof n})}function as(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new O(N.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=co(n);throw new O(N.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function oe(n,e){const t={typeString:n};return e&&(t.value=e),t}function fr(n,e){if(!Yl(n))throw new O(N.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&a!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new O(N.INVALID_ARGUMENT,t);return!0}const hc=-62135596800,dc=1e6;class ee{static now(){return ee.fromMillis(Date.now())}static fromDate(e){return ee.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*dc);return new ee(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new O(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new O(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<hc)throw new O(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new O(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/dc}_compareTo(e){return this.seconds===e.seconds?G(this.nanoseconds,e.nanoseconds):G(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ee._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(fr(e,ee._jsonSchema))return new ee(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-hc;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ee._jsonSchemaVersion="firestore/timestamp/1.0",ee._jsonSchema={type:oe("string",ee._jsonSchemaVersion),seconds:oe("number"),nanoseconds:oe("number")};class ${static fromTimestamp(e){return new $(e)}static min(){return new $(new ee(0,0))}static max(){return new $(new ee(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const nr=-1;function Mp(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=$.fromTimestamp(r===1e9?new ee(t+1,0):new ee(t,r));return new It(s,M.empty(),e)}function Fp(n){return new It(n.readTime,n.key,nr)}class It{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new It($.min(),M.empty(),nr)}static max(){return new It($.max(),M.empty(),nr)}}function Up(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=M.comparator(n.documentKey,e.documentKey),t!==0?t:G(n.largestBatchId,e.largestBatchId))}const Bp="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class $p{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Tn(n){if(n.code!==N.FAILED_PRECONDITION||n.message!==Bp)throw n;x("LocalStore","Unexpectedly lost primary lease")}class P{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&B(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new P(((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof P?t:P.resolve(t)}catch(t){return P.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):P.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):P.reject(t)}static resolve(e){return new P(((t,r)=>{t(e)}))}static reject(e){return new P(((t,r)=>{r(e)}))}static waitFor(e){return new P(((t,r)=>{let s=0,i=0,a=!1;e.forEach((c=>{++s,c.next((()=>{++i,a&&i===s&&t()}),(u=>r(u)))})),a=!0,i===s&&t()}))}static or(e){let t=P.resolve(!1);for(const r of e)t=t.next((s=>s?P.resolve(s):r()));return t}static forEach(e,t){const r=[];return e.forEach(((s,i)=>{r.push(t.call(this,s,i))})),this.waitFor(r)}static mapArray(e,t){return new P(((r,s)=>{const i=e.length,a=new Array(i);let c=0;for(let u=0;u<i;u++){const d=u;t(e[d]).next((f=>{a[d]=f,++c,c===i&&r(a)}),(f=>s(f)))}}))}static doWhile(e,t){return new P(((r,s)=>{const i=()=>{e()===!0?t().next((()=>{i()}),s):r()};i()}))}}function jp(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function In(n){return n.name==="IndexedDbTransactionError"}class Ps{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Ps.ce=-1;const lo=-1;function ks(n){return n==null}function cs(n){return n===0&&1/n==-1/0}function zp(n){return typeof n=="number"&&Number.isInteger(n)&&!cs(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const Xl="";function qp(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=fc(e)),e=Hp(n.get(t),e);return fc(e)}function Hp(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case Xl:t+="";break;default:t+=i}}return t}function fc(n){return n+Xl+""}function pc(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Wt(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Zl(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class te{constructor(e,t){this.comparator=e,this.root=t||de.EMPTY}insert(e,t){return new te(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,de.BLACK,null,null))}remove(e){return new te(this.comparator,this.root.remove(e,this.comparator).copy(null,null,de.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ur(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ur(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ur(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ur(this.root,e,this.comparator,!0)}}class Ur{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class de{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??de.RED,this.left=s??de.EMPTY,this.right=i??de.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new de(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return de.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return de.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,de.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,de.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw B(43730,{key:this.key,value:this.value});if(this.right.isRed())throw B(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw B(27949);return e+(this.isRed()?0:1)}}de.EMPTY=null,de.RED=!0,de.BLACK=!1;de.EMPTY=new class{constructor(){this.size=0}get key(){throw B(57766)}get value(){throw B(16141)}get color(){throw B(16727)}get left(){throw B(29726)}get right(){throw B(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new de(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class le{constructor(e){this.comparator=e,this.data=new te(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new mc(this.data.getIterator())}getIteratorFrom(e){return new mc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof le)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new le(this.comparator);return t.data=e,t}}class mc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class ke{constructor(e){this.fields=e,e.sort(fe.comparator)}static empty(){return new ke([])}unionWith(e){let t=new le(fe.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new ke(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return mn(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class eu extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class me{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new eu("Invalid base64 string: "+i):i}})(e);return new me(t)}static fromUint8Array(e){const t=(function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i})(e);return new me(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return G(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}me.EMPTY_BYTE_STRING=new me("");const Gp=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function wt(n){if(Q(!!n,39018),typeof n=="string"){let e=0;const t=Gp.exec(n);if(Q(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:se(n.seconds),nanos:se(n.nanos)}}function se(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function At(n){return typeof n=="string"?me.fromBase64String(n):me.fromUint8Array(n)}const tu="server_timestamp",nu="__type__",ru="__previous_value__",su="__local_write_time__";function uo(n){return(n?.mapValue?.fields||{})[nu]?.stringValue===tu}function Ns(n){const e=n.mapValue.fields[ru];return uo(e)?Ns(e):e}function rr(n){const e=wt(n.mapValue.fields[su].timestampValue);return new ee(e.seconds,e.nanos)}class Wp{constructor(e,t,r,s,i,a,c,u,d,f,m){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=c,this.longPollingOptions=u,this.useFetchStreams=d,this.isUsingEmulator=f,this.apiKey=m}}const ls="(default)";class sr{constructor(e,t){this.projectId=e,this.database=t||ls}static empty(){return new sr("","")}get isDefaultDatabase(){return this.database===ls}isEqual(e){return e instanceof sr&&e.projectId===this.projectId&&e.database===this.database}}function Kp(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new O(N.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new sr(n.options.projectId,e)}const iu="__type__",Qp="__max__",Br={mapValue:{}},ou="__vector__",us="value";function bt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?uo(n)?4:Yp(n)?9007199254740991:Jp(n)?10:11:B(28295,{value:n})}function He(n,e){if(n===e)return!0;const t=bt(n);if(t!==bt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return rr(n).isEqual(rr(e));case 3:return(function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=wt(s.timestampValue),c=wt(i.timestampValue);return a.seconds===c.seconds&&a.nanos===c.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,i){return At(s.bytesValue).isEqual(At(i.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,i){return se(s.geoPointValue.latitude)===se(i.geoPointValue.latitude)&&se(s.geoPointValue.longitude)===se(i.geoPointValue.longitude)})(n,e);case 2:return(function(s,i){if("integerValue"in s&&"integerValue"in i)return se(s.integerValue)===se(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=se(s.doubleValue),c=se(i.doubleValue);return a===c?cs(a)===cs(c):isNaN(a)&&isNaN(c)}return!1})(n,e);case 9:return mn(n.arrayValue.values||[],e.arrayValue.values||[],He);case 10:case 11:return(function(s,i){const a=s.mapValue.fields||{},c=i.mapValue.fields||{};if(pc(a)!==pc(c))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(c[u]===void 0||!He(a[u],c[u])))return!1;return!0})(n,e);default:return B(52216,{left:n})}}function ir(n,e){return(n.values||[]).find((t=>He(t,e)))!==void 0}function gn(n,e){if(n===e)return 0;const t=bt(n),r=bt(e);if(t!==r)return G(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return G(n.booleanValue,e.booleanValue);case 2:return(function(i,a){const c=se(i.integerValue||i.doubleValue),u=se(a.integerValue||a.doubleValue);return c<u?-1:c>u?1:c===u?0:isNaN(c)?isNaN(u)?0:-1:1})(n,e);case 3:return gc(n.timestampValue,e.timestampValue);case 4:return gc(rr(n),rr(e));case 5:return Oi(n.stringValue,e.stringValue);case 6:return(function(i,a){const c=At(i),u=At(a);return c.compareTo(u)})(n.bytesValue,e.bytesValue);case 7:return(function(i,a){const c=i.split("/"),u=a.split("/");for(let d=0;d<c.length&&d<u.length;d++){const f=G(c[d],u[d]);if(f!==0)return f}return G(c.length,u.length)})(n.referenceValue,e.referenceValue);case 8:return(function(i,a){const c=G(se(i.latitude),se(a.latitude));return c!==0?c:G(se(i.longitude),se(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return _c(n.arrayValue,e.arrayValue);case 10:return(function(i,a){const c=i.fields||{},u=a.fields||{},d=c[us]?.arrayValue,f=u[us]?.arrayValue,m=G(d?.values?.length||0,f?.values?.length||0);return m!==0?m:_c(d,f)})(n.mapValue,e.mapValue);case 11:return(function(i,a){if(i===Br.mapValue&&a===Br.mapValue)return 0;if(i===Br.mapValue)return 1;if(a===Br.mapValue)return-1;const c=i.fields||{},u=Object.keys(c),d=a.fields||{},f=Object.keys(d);u.sort(),f.sort();for(let m=0;m<u.length&&m<f.length;++m){const _=Oi(u[m],f[m]);if(_!==0)return _;const b=gn(c[u[m]],d[f[m]]);if(b!==0)return b}return G(u.length,f.length)})(n.mapValue,e.mapValue);default:throw B(23264,{he:t})}}function gc(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return G(n,e);const t=wt(n),r=wt(e),s=G(t.seconds,r.seconds);return s!==0?s:G(t.nanos,r.nanos)}function _c(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=gn(t[s],r[s]);if(i)return i}return G(t.length,r.length)}function _n(n){return Mi(n)}function Mi(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=wt(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return At(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return M.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=Mi(i);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const a of r)i?i=!1:s+=",",s+=`${a}:${Mi(t.fields[a])}`;return s+"}"})(n.mapValue):B(61005,{value:n})}function Jr(n){switch(bt(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Ns(n);return e?16+Jr(e):16;case 5:return 2*n.stringValue.length;case 6:return At(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,i)=>s+Jr(i)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return Wt(r.fields,((i,a)=>{s+=i.length+Jr(a)})),s})(n.mapValue);default:throw B(13486,{value:n})}}function Fi(n){return!!n&&"integerValue"in n}function ho(n){return!!n&&"arrayValue"in n}function yc(n){return!!n&&"nullValue"in n}function vc(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Yr(n){return!!n&&"mapValue"in n}function Jp(n){return(n?.mapValue?.fields||{})[iu]?.stringValue===ou}function Jn(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Wt(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=Jn(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Jn(n.arrayValue.values[t]);return e}return{...n}}function Yp(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Qp}class Ce{constructor(e){this.value=e}static empty(){return new Ce({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Yr(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Jn(t)}setAll(e){let t=fe.emptyPath(),r={},s=[];e.forEach(((a,c)=>{if(!t.isImmediateParentOf(c)){const u=this.getFieldsMap(t);this.applyChanges(u,r,s),r={},s=[],t=c.popLast()}a?r[c.lastSegment()]=Jn(a):s.push(c.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Yr(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return He(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Yr(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Wt(t,((s,i)=>e[s]=i));for(const s of r)delete e[s]}clone(){return new Ce(Jn(this.value))}}function au(n){const e=[];return Wt(n.fields,((t,r)=>{const s=new fe([t]);if(Yr(r)){const i=au(r.mapValue).fields;if(i.length===0)e.push(s);else for(const a of i)e.push(s.child(a))}else e.push(s)})),new ke(e)}class ve{constructor(e,t,r,s,i,a,c){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=c}static newInvalidDocument(e){return new ve(e,0,$.min(),$.min(),$.min(),Ce.empty(),0)}static newFoundDocument(e,t,r,s){return new ve(e,1,t,$.min(),r,s,0)}static newNoDocument(e,t){return new ve(e,2,t,$.min(),$.min(),Ce.empty(),0)}static newUnknownDocument(e,t){return new ve(e,3,t,$.min(),$.min(),Ce.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual($.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ce.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ce.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=$.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ve&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ve(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class hs{constructor(e,t){this.position=e,this.inclusive=t}}function Ec(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],a=n.position[s];if(i.field.isKeyField()?r=M.comparator(M.fromName(a.referenceValue),t.key):r=gn(a,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function Tc(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!He(n.position[t],e.position[t]))return!1;return!0}class ds{constructor(e,t="asc"){this.field=e,this.dir=t}}function Xp(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class cu{}class ce extends cu{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new em(e,t,r):t==="array-contains"?new rm(e,r):t==="in"?new sm(e,r):t==="not-in"?new im(e,r):t==="array-contains-any"?new om(e,r):new ce(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new tm(e,r):new nm(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(gn(t,this.value)):t!==null&&bt(this.value)===bt(t)&&this.matchesComparison(gn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return B(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ge extends cu{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Ge(e,t)}matches(e){return lu(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function lu(n){return n.op==="and"}function uu(n){return Zp(n)&&lu(n)}function Zp(n){for(const e of n.filters)if(e instanceof Ge)return!1;return!0}function Ui(n){if(n instanceof ce)return n.field.canonicalString()+n.op.toString()+_n(n.value);if(uu(n))return n.filters.map((e=>Ui(e))).join(",");{const e=n.filters.map((t=>Ui(t))).join(",");return`${n.op}(${e})`}}function hu(n,e){return n instanceof ce?(function(r,s){return s instanceof ce&&r.op===s.op&&r.field.isEqual(s.field)&&He(r.value,s.value)})(n,e):n instanceof Ge?(function(r,s){return s instanceof Ge&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((i,a,c)=>i&&hu(a,s.filters[c])),!0):!1})(n,e):void B(19439)}function du(n){return n instanceof ce?(function(t){return`${t.field.canonicalString()} ${t.op} ${_n(t.value)}`})(n):n instanceof Ge?(function(t){return t.op.toString()+" {"+t.getFilters().map(du).join(" ,")+"}"})(n):"Filter"}class em extends ce{constructor(e,t,r){super(e,t,r),this.key=M.fromName(r.referenceValue)}matches(e){const t=M.comparator(e.key,this.key);return this.matchesComparison(t)}}class tm extends ce{constructor(e,t){super(e,"in",t),this.keys=fu("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class nm extends ce{constructor(e,t){super(e,"not-in",t),this.keys=fu("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function fu(n,e){return(e.arrayValue?.values||[]).map((t=>M.fromName(t.referenceValue)))}class rm extends ce{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ho(t)&&ir(t.arrayValue,this.value)}}class sm extends ce{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&ir(this.value.arrayValue,t)}}class im extends ce{constructor(e,t){super(e,"not-in",t)}matches(e){if(ir(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!ir(this.value.arrayValue,t)}}class om extends ce{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ho(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>ir(this.value.arrayValue,r)))}}class am{constructor(e,t=null,r=[],s=[],i=null,a=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=c,this.Te=null}}function Ic(n,e=null,t=[],r=[],s=null,i=null,a=null){return new am(n,e,t,r,s,i,a)}function fo(n){const e=j(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>Ui(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(i){return i.field.canonicalString()+i.dir})(r))).join(","),ks(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>_n(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>_n(r))).join(",")),e.Te=t}return e.Te}function po(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Xp(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!hu(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Tc(n.startAt,e.startAt)&&Tc(n.endAt,e.endAt)}function Bi(n){return M.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class Ds{constructor(e,t=null,r=[],s=[],i=null,a="F",c=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=c,this.endAt=u,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function cm(n,e,t,r,s,i,a,c){return new Ds(n,e,t,r,s,i,a,c)}function pu(n){return new Ds(n)}function wc(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function lm(n){return M.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function um(n){return n.collectionGroup!==null}function Yn(n){const e=j(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let c=new le(fe.comparator);return a.filters.forEach((u=>{u.getFlattenedFilters().forEach((d=>{d.isInequality()&&(c=c.add(d.field))}))})),c})(e).forEach((i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new ds(i,r))})),t.has(fe.keyField().canonicalString())||e.Ie.push(new ds(fe.keyField(),r))}return e.Ie}function Be(n){const e=j(n);return e.Ee||(e.Ee=hm(e,Yn(n))),e.Ee}function hm(n,e){if(n.limitType==="F")return Ic(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const i=s.dir==="desc"?"asc":"desc";return new ds(s.field,i)}));const t=n.endAt?new hs(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new hs(n.startAt.position,n.startAt.inclusive):null;return Ic(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function $i(n,e,t){return new Ds(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Vs(n,e){return po(Be(n),Be(e))&&n.limitType===e.limitType}function mu(n){return`${fo(Be(n))}|lt:${n.limitType}`}function nn(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((s=>du(s))).join(", ")}]`),ks(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((s=>_n(s))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((s=>_n(s))).join(",")),`Target(${r})`})(Be(n))}; limitType=${n.limitType})`}function xs(n,e){return e.isFoundDocument()&&(function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):M.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)})(n,e)&&(function(r,s){for(const i of Yn(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0})(n,e)&&(function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0})(n,e)&&(function(r,s){return!(r.startAt&&!(function(a,c,u){const d=Ec(a,c,u);return a.inclusive?d<=0:d<0})(r.startAt,Yn(r),s)||r.endAt&&!(function(a,c,u){const d=Ec(a,c,u);return a.inclusive?d>=0:d>0})(r.endAt,Yn(r),s))})(n,e)}function dm(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function gu(n){return(e,t)=>{let r=!1;for(const s of Yn(n)){const i=fm(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function fm(n,e,t){const r=n.field.isKeyField()?M.comparator(e.key,t.key):(function(i,a,c){const u=a.data.field(i),d=c.data.field(i);return u!==null&&d!==null?gn(u,d):B(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return B(19790,{direction:n.dir})}}class Kt{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Wt(this.inner,((t,r)=>{for(const[s,i]of r)e(s,i)}))}isEmpty(){return Zl(this.inner)}size(){return this.innerSize}}const pm=new te(M.comparator);function nt(){return pm}const _u=new te(M.comparator);function Hn(...n){let e=_u;for(const t of n)e=e.insert(t.key,t);return e}function yu(n){let e=_u;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function Ft(){return Xn()}function vu(){return Xn()}function Xn(){return new Kt((n=>n.toString()),((n,e)=>n.isEqual(e)))}const mm=new te(M.comparator),gm=new le(M.comparator);function W(...n){let e=gm;for(const t of n)e=e.add(t);return e}const _m=new le(G);function ym(){return _m}function mo(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:cs(e)?"-0":e}}function Eu(n){return{integerValue:""+n}}function vm(n,e){return zp(e)?Eu(e):mo(n,e)}class Ls{constructor(){this._=void 0}}function Em(n,e,t){return n instanceof or?(function(s,i){const a={fields:{[nu]:{stringValue:tu},[su]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&uo(i)&&(i=Ns(i)),i&&(a.fields[ru]=i),{mapValue:a}})(t,e):n instanceof ar?Iu(n,e):n instanceof cr?wu(n,e):(function(s,i){const a=Tu(s,i),c=Ac(a)+Ac(s.Ae);return Fi(a)&&Fi(s.Ae)?Eu(c):mo(s.serializer,c)})(n,e)}function Tm(n,e,t){return n instanceof ar?Iu(n,e):n instanceof cr?wu(n,e):t}function Tu(n,e){return n instanceof fs?(function(r){return Fi(r)||(function(i){return!!i&&"doubleValue"in i})(r)})(e)?e:{integerValue:0}:null}class or extends Ls{}class ar extends Ls{constructor(e){super(),this.elements=e}}function Iu(n,e){const t=Au(e);for(const r of n.elements)t.some((s=>He(s,r)))||t.push(r);return{arrayValue:{values:t}}}class cr extends Ls{constructor(e){super(),this.elements=e}}function wu(n,e){let t=Au(e);for(const r of n.elements)t=t.filter((s=>!He(s,r)));return{arrayValue:{values:t}}}class fs extends Ls{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Ac(n){return se(n.integerValue||n.doubleValue)}function Au(n){return ho(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Im{constructor(e,t){this.field=e,this.transform=t}}function wm(n,e){return n.field.isEqual(e.field)&&(function(r,s){return r instanceof ar&&s instanceof ar||r instanceof cr&&s instanceof cr?mn(r.elements,s.elements,He):r instanceof fs&&s instanceof fs?He(r.Ae,s.Ae):r instanceof or&&s instanceof or})(n.transform,e.transform)}class Am{constructor(e,t){this.version=e,this.transformResults=t}}class Xe{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Xe}static exists(e){return new Xe(void 0,e)}static updateTime(e){return new Xe(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Xr(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Os{}function bu(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Su(n.key,Xe.none()):new pr(n.key,n.data,Xe.none());{const t=n.data,r=Ce.empty();let s=new le(fe.comparator);for(let i of e.fields)if(!s.has(i)){let a=t.field(i);a===null&&i.length>1&&(i=i.popLast(),a=t.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new Qt(n.key,r,new ke(s.toArray()),Xe.none())}}function bm(n,e,t){n instanceof pr?(function(s,i,a){const c=s.value.clone(),u=Rc(s.fieldTransforms,i,a.transformResults);c.setAll(u),i.convertToFoundDocument(a.version,c).setHasCommittedMutations()})(n,e,t):n instanceof Qt?(function(s,i,a){if(!Xr(s.precondition,i))return void i.convertToUnknownDocument(a.version);const c=Rc(s.fieldTransforms,i,a.transformResults),u=i.data;u.setAll(Ru(s)),u.setAll(c),i.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,e,t):(function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function Zn(n,e,t,r){return n instanceof pr?(function(i,a,c,u){if(!Xr(i.precondition,a))return c;const d=i.value.clone(),f=Sc(i.fieldTransforms,u,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,e,t,r):n instanceof Qt?(function(i,a,c,u){if(!Xr(i.precondition,a))return c;const d=Sc(i.fieldTransforms,u,a),f=a.data;return f.setAll(Ru(i)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),c===null?null:c.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map((m=>m.field)))})(n,e,t,r):(function(i,a,c){return Xr(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):c})(n,e,t)}function Rm(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Tu(r.transform,s||null);i!=null&&(t===null&&(t=Ce.empty()),t.set(r.field,i))}return t||null}function bc(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&mn(r,s,((i,a)=>wm(i,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class pr extends Os{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Qt extends Os{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Ru(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function Rc(n,e,t){const r=new Map;Q(n.length===t.length,32656,{Ve:t.length,de:n.length});for(let s=0;s<t.length;s++){const i=n[s],a=i.transform,c=e.data.field(i.field);r.set(i.field,Tm(a,c,t[s]))}return r}function Sc(n,e,t){const r=new Map;for(const s of n){const i=s.transform,a=t.data.field(s.field);r.set(s.field,Em(i,a,e))}return r}class Su extends Os{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Sm extends Os{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Cm{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&bm(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Zn(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Zn(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=vu();return this.mutations.forEach((s=>{const i=e.get(s.key),a=i.overlayedDocument;let c=this.applyToLocalView(a,i.mutatedFields);c=t.has(s.key)?null:c;const u=bu(a,c);u!==null&&r.set(s.key,u),a.isValidDocument()||a.convertToNoDocument($.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),W())}isEqual(e){return this.batchId===e.batchId&&mn(this.mutations,e.mutations,((t,r)=>bc(t,r)))&&mn(this.baseMutations,e.baseMutations,((t,r)=>bc(t,r)))}}class go{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Q(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=(function(){return mm})();const i=e.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,r[a].version);return new go(e,t,r,s)}}class Pm{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class km{constructor(e,t){this.count=e,this.unchangedNames=t}}var ie,K;function Nm(n){switch(n){case N.OK:return B(64938);case N.CANCELLED:case N.UNKNOWN:case N.DEADLINE_EXCEEDED:case N.RESOURCE_EXHAUSTED:case N.INTERNAL:case N.UNAVAILABLE:case N.UNAUTHENTICATED:return!1;case N.INVALID_ARGUMENT:case N.NOT_FOUND:case N.ALREADY_EXISTS:case N.PERMISSION_DENIED:case N.FAILED_PRECONDITION:case N.ABORTED:case N.OUT_OF_RANGE:case N.UNIMPLEMENTED:case N.DATA_LOSS:return!0;default:return B(15467,{code:n})}}function Cu(n){if(n===void 0)return tt("GRPC error has no .code"),N.UNKNOWN;switch(n){case ie.OK:return N.OK;case ie.CANCELLED:return N.CANCELLED;case ie.UNKNOWN:return N.UNKNOWN;case ie.DEADLINE_EXCEEDED:return N.DEADLINE_EXCEEDED;case ie.RESOURCE_EXHAUSTED:return N.RESOURCE_EXHAUSTED;case ie.INTERNAL:return N.INTERNAL;case ie.UNAVAILABLE:return N.UNAVAILABLE;case ie.UNAUTHENTICATED:return N.UNAUTHENTICATED;case ie.INVALID_ARGUMENT:return N.INVALID_ARGUMENT;case ie.NOT_FOUND:return N.NOT_FOUND;case ie.ALREADY_EXISTS:return N.ALREADY_EXISTS;case ie.PERMISSION_DENIED:return N.PERMISSION_DENIED;case ie.FAILED_PRECONDITION:return N.FAILED_PRECONDITION;case ie.ABORTED:return N.ABORTED;case ie.OUT_OF_RANGE:return N.OUT_OF_RANGE;case ie.UNIMPLEMENTED:return N.UNIMPLEMENTED;case ie.DATA_LOSS:return N.DATA_LOSS;default:return B(39323,{code:n})}}(K=ie||(ie={}))[K.OK=0]="OK",K[K.CANCELLED=1]="CANCELLED",K[K.UNKNOWN=2]="UNKNOWN",K[K.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",K[K.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",K[K.NOT_FOUND=5]="NOT_FOUND",K[K.ALREADY_EXISTS=6]="ALREADY_EXISTS",K[K.PERMISSION_DENIED=7]="PERMISSION_DENIED",K[K.UNAUTHENTICATED=16]="UNAUTHENTICATED",K[K.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",K[K.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",K[K.ABORTED=10]="ABORTED",K[K.OUT_OF_RANGE=11]="OUT_OF_RANGE",K[K.UNIMPLEMENTED=12]="UNIMPLEMENTED",K[K.INTERNAL=13]="INTERNAL",K[K.UNAVAILABLE=14]="UNAVAILABLE",K[K.DATA_LOSS=15]="DATA_LOSS";function Dm(){return new TextEncoder}const Vm=new yt([4294967295,4294967295],0);function Cc(n){const e=Dm().encode(n),t=new jl;return t.update(e),new Uint8Array(t.digest())}function Pc(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new yt([t,r],0),new yt([s,i],0)]}class _o{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Gn(`Invalid padding: ${t}`);if(r<0)throw new Gn(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Gn(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Gn(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=yt.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(yt.fromNumber(r)));return s.compare(Vm)===1&&(s=new yt([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=Cc(e),[r,s]=Pc(t);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);if(!this.we(a))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new _o(i,s,t);return r.forEach((c=>a.insert(c))),a}insert(e){if(this.ge===0)return;const t=Cc(e),[r,s]=Pc(t);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);this.be(a)}}be(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Gn extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Ms{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,mr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Ms($.min(),s,new te(G),nt(),W())}}class mr{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new mr(r,t,W(),W(),W())}}class Zr{constructor(e,t,r,s){this.Se=e,this.removedTargetIds=t,this.key=r,this.De=s}}class Pu{constructor(e,t){this.targetId=e,this.Ce=t}}class ku{constructor(e,t,r=me.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class kc{constructor(){this.ve=0,this.Fe=Nc(),this.Me=me.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=W(),t=W(),r=W();return this.Fe.forEach(((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:B(38017,{changeType:i})}})),new mr(this.Me,this.xe,e,t,r)}Ke(){this.Oe=!1,this.Fe=Nc()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,Q(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class xm{constructor(e){this.Ge=e,this.ze=new Map,this.je=nt(),this.He=$r(),this.Je=$r(),this.Ze=new te(G)}Xe(e){for(const t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.We(),r.Ne||r.Ke(),r.Le(e.resumeToken);break;case 2:r.We(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.Qe(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:B(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,s)=>{this.rt(s)&&t(s)}))}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(Bi(i))if(r===0){const a=new M(i.path);this.et(t,a,ve.newNoDocument(a,$.min()))}else Q(r===1,20013,{expectedCount:r});else{const a=this._t(t);if(a!==r){const c=this.ut(e),u=c?this.ct(c,e,a):1;if(u!==0){this.it(t);const d=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,d)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let a,c;try{a=At(r).toUint8Array()}catch(u){if(u instanceof eu)return pn("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{c=new _o(a,s,i)}catch(u){return pn(u instanceof Gn?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return c.ge===0?null:c}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach((i=>{const a=this.Ge.ht(),c=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(c)||(this.et(t,i,null),s++)})),s}Tt(e){const t=new Map;this.ze.forEach(((i,a)=>{const c=this.ot(a);if(c){if(i.current&&Bi(c.target)){const u=new M(c.target.path);this.It(u).has(a)||this.Et(a,u)||this.et(a,u,ve.newNoDocument(u,e))}i.Be&&(t.set(a,i.ke()),i.Ke())}}));let r=W();this.Je.forEach(((i,a)=>{let c=!0;a.forEachWhile((u=>{const d=this.ot(u);return!d||d.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)})),c&&(r=r.add(i))})),this.je.forEach(((i,a)=>a.setReadTime(e)));const s=new Ms(e,t,this.Ze,this.je,r);return this.je=nt(),this.He=$r(),this.Je=$r(),this.Ze=new te(G),s}Ye(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,r),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.qe(t,1):s.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new kc,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new le(G),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new le(G),this.He=this.He.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||x("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new kc),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function $r(){return new te(M.comparator)}function Nc(){return new te(M.comparator)}const Lm={asc:"ASCENDING",desc:"DESCENDING"},Om={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Mm={and:"AND",or:"OR"};class Fm{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ji(n,e){return n.useProto3Json||ks(e)?e:{value:e}}function ps(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Nu(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Um(n,e){return ps(n,e.toTimestamp())}function $e(n){return Q(!!n,49232),$.fromTimestamp((function(t){const r=wt(t);return new ee(r.seconds,r.nanos)})(n))}function yo(n,e){return zi(n,e).canonicalString()}function zi(n,e){const t=(function(s){return new Z(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function Du(n){const e=Z.fromString(n);return Q(Mu(e),10190,{key:e.toString()}),e}function qi(n,e){return yo(n.databaseId,e.path)}function Ii(n,e){const t=Du(e);if(t.get(1)!==n.databaseId.projectId)throw new O(N.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new O(N.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new M(xu(t))}function Vu(n,e){return yo(n.databaseId,e)}function Bm(n){const e=Du(n);return e.length===4?Z.emptyPath():xu(e)}function Hi(n){return new Z(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function xu(n){return Q(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Dc(n,e,t){return{name:qi(n,e),fields:t.value.mapValue.fields}}function $m(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:B(39313,{state:d})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=(function(d,f){return d.useProto3Json?(Q(f===void 0||typeof f=="string",58123),me.fromBase64String(f||"")):(Q(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),me.fromUint8Array(f||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,c=a&&(function(d){const f=d.code===void 0?N.UNKNOWN:Cu(d.code);return new O(f,d.message||"")})(a);t=new ku(r,s,i,c||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Ii(n,r.document.name),i=$e(r.document.updateTime),a=r.document.createTime?$e(r.document.createTime):$.min(),c=new Ce({mapValue:{fields:r.document.fields}}),u=ve.newFoundDocument(s,i,a,c),d=r.targetIds||[],f=r.removedTargetIds||[];t=new Zr(d,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Ii(n,r.document),i=r.readTime?$e(r.readTime):$.min(),a=ve.newNoDocument(s,i),c=r.removedTargetIds||[];t=new Zr([],c,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Ii(n,r.document),i=r.removedTargetIds||[];t=new Zr([],i,s,null)}else{if(!("filter"in e))return B(11601,{Vt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,a=new km(s,i),c=r.targetId;t=new Pu(c,a)}}return t}function jm(n,e){let t;if(e instanceof pr)t={update:Dc(n,e.key,e.value)};else if(e instanceof Su)t={delete:qi(n,e.key)};else if(e instanceof Qt)t={update:Dc(n,e.key,e.data),updateMask:Ym(e.fieldMask)};else{if(!(e instanceof Sm))return B(16599,{dt:e.type});t={verify:qi(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(i,a){const c=a.transform;if(c instanceof or)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof ar)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof cr)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof fs)return{fieldPath:a.field.canonicalString(),increment:c.Ae};throw B(20930,{transform:a.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(s,i){return i.updateTime!==void 0?{updateTime:Um(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:B(27497)})(n,e.precondition)),t}function zm(n,e){return n&&n.length>0?(Q(e!==void 0,14353),n.map((t=>(function(s,i){let a=s.updateTime?$e(s.updateTime):$e(i);return a.isEqual($.min())&&(a=$e(i)),new Am(a,s.transformResults||[])})(t,e)))):[]}function qm(n,e){return{documents:[Vu(n,e.path)]}}function Hm(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Vu(n,s);const i=(function(d){if(d.length!==0)return Ou(Ge.create(d,"and"))})(e.filters);i&&(t.structuredQuery.where=i);const a=(function(d){if(d.length!==0)return d.map((f=>(function(_){return{field:rn(_.field),direction:Km(_.dir)}})(f)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const c=ji(n,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(e.endAt)),{ft:t,parent:s}}function Gm(n){let e=Bm(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Q(r===1,65062);const f=t.from[0];f.allDescendants?s=f.collectionId:e=e.child(f.collectionId)}let i=[];t.where&&(i=(function(m){const _=Lu(m);return _ instanceof Ge&&uu(_)?_.getFilters():[_]})(t.where));let a=[];t.orderBy&&(a=(function(m){return m.map((_=>(function(S){return new ds(sn(S.field),(function(C){switch(C){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(S.direction))})(_)))})(t.orderBy));let c=null;t.limit&&(c=(function(m){let _;return _=typeof m=="object"?m.value:m,ks(_)?null:_})(t.limit));let u=null;t.startAt&&(u=(function(m){const _=!!m.before,b=m.values||[];return new hs(b,_)})(t.startAt));let d=null;return t.endAt&&(d=(function(m){const _=!m.before,b=m.values||[];return new hs(b,_)})(t.endAt)),cm(e,s,a,i,c,"F",u,d)}function Wm(n,e){const t=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return B(28987,{purpose:s})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Lu(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=sn(t.unaryFilter.field);return ce.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=sn(t.unaryFilter.field);return ce.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=sn(t.unaryFilter.field);return ce.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=sn(t.unaryFilter.field);return ce.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return B(61313);default:return B(60726)}})(n):n.fieldFilter!==void 0?(function(t){return ce.create(sn(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return B(58110);default:return B(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Ge.create(t.compositeFilter.filters.map((r=>Lu(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return B(1026)}})(t.compositeFilter.op))})(n):B(30097,{filter:n})}function Km(n){return Lm[n]}function Qm(n){return Om[n]}function Jm(n){return Mm[n]}function rn(n){return{fieldPath:n.canonicalString()}}function sn(n){return fe.fromServerFormat(n.fieldPath)}function Ou(n){return n instanceof ce?(function(t){if(t.op==="=="){if(vc(t.value))return{unaryFilter:{field:rn(t.field),op:"IS_NAN"}};if(yc(t.value))return{unaryFilter:{field:rn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(vc(t.value))return{unaryFilter:{field:rn(t.field),op:"IS_NOT_NAN"}};if(yc(t.value))return{unaryFilter:{field:rn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:rn(t.field),op:Qm(t.op),value:t.value}}})(n):n instanceof Ge?(function(t){const r=t.getFilters().map((s=>Ou(s)));return r.length===1?r[0]:{compositeFilter:{op:Jm(t.op),filters:r}}})(n):B(54877,{filter:n})}function Ym(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Mu(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function Fu(n){return!!n&&typeof n._toProto=="function"&&n._protoValueType==="ProtoValue"}class mt{constructor(e,t,r,s,i=$.min(),a=$.min(),c=me.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=c,this.expectedCount=u}withSequenceNumber(e){return new mt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new mt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new mt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new mt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Xm{constructor(e){this.yt=e}}function Zm(n){const e=Gm({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?$i(e,e.limit,"L"):e}class eg{constructor(){this.Sn=new tg}addToCollectionParentIndex(e,t){return this.Sn.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(It.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(It.min())}updateCollectionGroup(e,t,r){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}}class tg{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new le(Z.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new le(Z.comparator)).toArray()}}const Vc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Uu=41943040;class be{static withCacheSize(e){return new be(e,be.DEFAULT_COLLECTION_PERCENTILE,be.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}be.DEFAULT_COLLECTION_PERCENTILE=10,be.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,be.DEFAULT=new be(Uu,be.DEFAULT_COLLECTION_PERCENTILE,be.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),be.DISABLED=new be(-1,0,0);class yn{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new yn(0)}static ar(){return new yn(-1)}}const xc="LruGarbageCollector",ng=1048576;function Lc([n,e],[t,r]){const s=G(n,t);return s===0?G(e,r):s}class rg{constructor(e){this.Pr=e,this.buffer=new le(Lc),this.Tr=0}Ir(){return++this.Tr}Er(e){const t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Lc(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class sg{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){x(xc,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){In(t)?x(xc,"Ignoring IndexedDB error during garbage collection: ",t):await Tn(t)}await this.Ar(3e5)}))}}class ig{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return P.resolve(Ps.ce);const r=new rg(t);return this.Vr.forEachTarget(e,(s=>r.Er(s.sequenceNumber))).next((()=>this.Vr.mr(e,(s=>r.Er(s))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(x("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(Vc)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(x("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Vc):this.gr(e,t)))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let r,s,i,a,c,u,d;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((m=>(m>this.params.maximumSequenceNumbersToCollect?(x("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),s=this.params.maximumSequenceNumbersToCollect):s=m,a=Date.now(),this.nthSequenceNumber(e,s)))).next((m=>(r=m,c=Date.now(),this.removeTargets(e,r,t)))).next((m=>(i=m,u=Date.now(),this.removeOrphanedDocuments(e,r)))).next((m=>(d=Date.now(),tn()<=H.DEBUG&&x("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${s} in `+(c-a)+`ms
	Removed ${i} targets in `+(u-c)+`ms
	Removed ${m} documents in `+(d-u)+`ms
Total Duration: ${d-f}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:m}))))}}function og(n,e){return new ig(n,e)}class ag{constructor(){this.changes=new Kt((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ve.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?P.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class cg{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class lg{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(r!==null&&Zn(r.mutation,s,ke.empty(),ee.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,W()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=W()){const s=Ft();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,r).next((i=>{let a=Hn();return i.forEach(((c,u)=>{a=a.insert(c,u.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const r=Ft();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,W())))}populateOverlays(e,t,r){const s=[];return r.forEach((i=>{t.has(i)||s.push(i)})),this.documentOverlayCache.getOverlays(e,s).next((i=>{i.forEach(((a,c)=>{t.set(a,c)}))}))}computeViews(e,t,r,s){let i=nt();const a=Xn(),c=(function(){return Xn()})();return t.forEach(((u,d)=>{const f=r.get(d.key);s.has(d.key)&&(f===void 0||f.mutation instanceof Qt)?i=i.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),Zn(f.mutation,d,f.mutation.getFieldMask(),ee.now())):a.set(d.key,ke.empty())})),this.recalculateAndSaveOverlays(e,i).next((u=>(u.forEach(((d,f)=>a.set(d,f))),t.forEach(((d,f)=>c.set(d,new cg(f,a.get(d)??null)))),c)))}recalculateAndSaveOverlays(e,t){const r=Xn();let s=new te(((a,c)=>a-c)),i=W();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const c of a)c.keys().forEach((u=>{const d=t.get(u);if(d===null)return;let f=r.get(u)||ke.empty();f=c.applyToLocalView(d,f),r.set(u,f);const m=(s.get(c.batchId)||W()).add(u);s=s.insert(c.batchId,m)}))})).next((()=>{const a=[],c=s.getReverseIterator();for(;c.hasNext();){const u=c.getNext(),d=u.key,f=u.value,m=vu();f.forEach((_=>{if(!i.has(_)){const b=bu(t.get(_),r.get(_));b!==null&&m.set(_,b),i=i.add(_)}})),a.push(this.documentOverlayCache.saveOverlays(e,d,m))}return P.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,s){return lm(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):um(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next((i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):P.resolve(Ft());let c=nr,u=i;return a.next((d=>P.forEach(d,((f,m)=>(c<m.largestBatchId&&(c=m.largestBatchId),i.get(f)?P.resolve():this.remoteDocumentCache.getEntry(e,f).next((_=>{u=u.insert(f,_)}))))).next((()=>this.populateOverlays(e,d,i))).next((()=>this.computeViews(e,u,d,W()))).next((f=>({batchId:c,changes:yu(f)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new M(t)).next((r=>{let s=Hn();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let a=Hn();return this.indexManager.getCollectionParents(e,i).next((c=>P.forEach(c,(u=>{const d=(function(m,_){return new Ds(_,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)})(t,u.child(i));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next((f=>{f.forEach(((m,_)=>{a=a.insert(m,_)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s)))).next((a=>{i.forEach(((u,d)=>{const f=d.getKey();a.get(f)===null&&(a=a.insert(f,ve.newInvalidDocument(f)))}));let c=Hn();return a.forEach(((u,d)=>{const f=i.get(u);f!==void 0&&Zn(f.mutation,d,ke.empty(),ee.now()),xs(t,d)&&(c=c.insert(u,d))})),c}))}}class ug{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return P.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:$e(s.createTime)}})(t)),P.resolve()}getNamedQuery(e,t){return P.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,(function(s){return{name:s.name,query:Zm(s.bundledQuery),readTime:$e(s.readTime)}})(t)),P.resolve()}}class hg{constructor(){this.overlays=new te(M.comparator),this.Lr=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Ft();return P.forEach(t,(s=>this.getOverlay(e,s).next((i=>{i!==null&&r.set(s,i)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((s,i)=>{this.bt(e,t,i)})),P.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Lr.get(r);return s!==void 0&&(s.forEach((i=>this.overlays=this.overlays.remove(i))),this.Lr.delete(r)),P.resolve()}getOverlaysForCollection(e,t,r){const s=Ft(),i=t.length+1,a=new M(t.child("")),c=this.overlays.getIteratorFrom(a);for(;c.hasNext();){const u=c.getNext().value,d=u.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===i&&u.largestBatchId>r&&s.set(u.getKey(),u)}return P.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new te(((d,f)=>d-f));const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let f=i.get(d.largestBatchId);f===null&&(f=Ft(),i=i.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}const c=Ft(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach(((d,f)=>c.set(d,f))),!(c.size()>=s)););return P.resolve(c)}bt(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.Lr.get(s.largestBatchId).delete(r.key);this.Lr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Pm(t,r));let i=this.Lr.get(t);i===void 0&&(i=W(),this.Lr.set(t,i)),this.Lr.set(t,i.add(r.key))}}class dg{constructor(){this.sessionToken=me.EMPTY_BYTE_STRING}getSessionToken(e){return P.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,P.resolve()}}class vo{constructor(){this.kr=new le(he.Kr),this.qr=new le(he.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){const r=new he(e,t);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Wr(new he(e,t))}Qr(e,t){e.forEach((r=>this.removeReference(r,t)))}Gr(e){const t=new M(new Z([])),r=new he(t,e),s=new he(t,e+1),i=[];return this.qr.forEachInRange([r,s],(a=>{this.Wr(a),i.push(a.key)})),i}zr(){this.kr.forEach((e=>this.Wr(e)))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const t=new M(new Z([])),r=new he(t,e),s=new he(t,e+1);let i=W();return this.qr.forEachInRange([r,s],(a=>{i=i.add(a.key)})),i}containsKey(e){const t=new he(e,0),r=this.kr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class he{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return M.comparator(e.key,t.key)||G(e.Hr,t.Hr)}static Ur(e,t){return G(e.Hr,t.Hr)||M.comparator(e.key,t.key)}}class fg{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new le(he.Kr)}checkEmpty(e){return P.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Cm(i,t,r,s);this.mutationQueue.push(a);for(const c of s)this.Jr=this.Jr.add(new he(c.key,i)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return P.resolve(a)}lookupMutationBatch(e,t){return P.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.Xr(r),i=s<0?0:s;return P.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(this.mutationQueue.length===0?lo:this.Yn-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new he(t,0),s=new he(t,Number.POSITIVE_INFINITY),i=[];return this.Jr.forEachInRange([r,s],(a=>{const c=this.Zr(a.Hr);i.push(c)})),P.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new le(G);return t.forEach((s=>{const i=new he(s,0),a=new he(s,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([i,a],(c=>{r=r.add(c.Hr)}))})),P.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;M.isDocumentKey(i)||(i=i.child(""));const a=new he(new M(i),0);let c=new le(G);return this.Jr.forEachWhile((u=>{const d=u.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(c=c.add(u.Hr)),!0)}),a),P.resolve(this.Yr(c))}Yr(e){const t=[];return e.forEach((r=>{const s=this.Zr(r);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){Q(this.ei(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Jr;return P.forEach(t.mutations,(s=>{const i=new he(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Jr=r}))}nr(e){}containsKey(e,t){const r=new he(t,0),s=this.Jr.firstAfterOrEqual(r);return P.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,P.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class pg{constructor(e){this.ti=e,this.docs=(function(){return new te(M.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,a=this.ti(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return P.resolve(r?r.document.mutableCopy():ve.newInvalidDocument(t))}getEntries(e,t){let r=nt();return t.forEach((s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():ve.newInvalidDocument(s))})),P.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=nt();const a=t.path,c=new M(a.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(c);for(;u.hasNext();){const{key:d,value:{document:f}}=u.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||Up(Fp(f),r)<=0||(s.has(f.key)||xs(t,f))&&(i=i.insert(f.key,f.mutableCopy()))}return P.resolve(i)}getAllFromCollectionGroup(e,t,r,s){B(9500)}ni(e,t){return P.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new mg(this)}getSize(e){return P.resolve(this.size)}}class mg extends ag{constructor(e){super(),this.Mr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?t.push(this.Mr.addEntry(e,s)):this.Mr.removeEntry(r)})),P.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class gg{constructor(e){this.persistence=e,this.ri=new Kt((t=>fo(t)),po),this.lastRemoteSnapshotVersion=$.min(),this.highestTargetId=0,this.ii=0,this.si=new vo,this.targetCount=0,this.oi=yn._r()}forEachTarget(e,t){return this.ri.forEach(((r,s)=>t(s))),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ii&&(this.ii=t),P.resolve()}lr(e){this.ri.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.oi=new yn(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.lr(t),P.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.ri.forEach(((a,c)=>{c.sequenceNumber<=t&&r.get(c.targetId)===null&&(this.ri.delete(a),i.push(this.removeMatchingKeysForTargetId(e,c.targetId)),s++)})),P.waitFor(i).next((()=>s))}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){const r=this.ri.get(t)||null;return P.resolve(r)}addMatchingKeys(e,t,r){return this.si.$r(t,r),P.resolve()}removeMatchingKeys(e,t,r){this.si.Qr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach((a=>{i.push(s.markPotentiallyOrphaned(e,a))})),P.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),P.resolve()}getMatchingKeysForTargetId(e,t){const r=this.si.jr(t);return P.resolve(r)}containsKey(e,t){return P.resolve(this.si.containsKey(t))}}class Bu{constructor(e,t){this._i={},this.overlays={},this.ai=new Ps(0),this.ui=!1,this.ui=!0,this.ci=new dg,this.referenceDelegate=e(this),this.li=new gg(this),this.indexManager=new eg,this.remoteDocumentCache=(function(s){return new pg(s)})((r=>this.referenceDelegate.hi(r))),this.serializer=new Xm(t),this.Pi=new ug(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new hg,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this._i[e.toKey()];return r||(r=new fg(t,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,r){x("MemoryPersistence","Starting transaction:",e);const s=new _g(this.ai.next());return this.referenceDelegate.Ti(),r(s).next((i=>this.referenceDelegate.Ii(s).next((()=>i)))).toPromise().then((i=>(s.raiseOnCommittedEvent(),i)))}Ei(e,t){return P.or(Object.values(this._i).map((r=>()=>r.containsKey(e,t))))}}class _g extends $p{constructor(e){super(),this.currentSequenceNumber=e}}class Eo{constructor(e){this.persistence=e,this.Ri=new vo,this.Ai=null}static Vi(e){return new Eo(e)}get di(){if(this.Ai)return this.Ai;throw B(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.di.delete(r.toString()),P.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.di.add(r.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),P.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach((s=>this.di.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((i=>this.di.add(i.toString())))})).next((()=>r.removeTargetData(e,t)))}Ti(){this.Ai=new Set}Ii(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.di,(r=>{const s=M.fromPath(r);return this.mi(e,s).next((i=>{i||t.removeEntry(s,$.min())}))})).next((()=>(this.Ai=null,t.apply(e))))}updateLimboDocument(e,t){return this.mi(e,t).next((r=>{r?this.di.delete(t.toString()):this.di.add(t.toString())}))}hi(e){return 0}mi(e,t){return P.or([()=>P.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class ms{constructor(e,t){this.persistence=e,this.fi=new Kt((r=>qp(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=og(this,t)}static Vi(e,t){return new ms(e,t)}Ti(){}Ii(e){return P.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((s=>r+s))))}pr(e){let t=0;return this.mr(e,(r=>{t++})).next((()=>t))}mr(e,t){return P.forEach(this.fi,((r,s)=>this.wr(e,r,s).next((i=>i?P.resolve():t(s)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ni(e,(a=>this.wr(e,a,t).next((c=>{c||(r++,i.removeEntry(a,$.min()))})))).next((()=>i.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),P.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),P.resolve()}removeReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),P.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),P.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Jr(e.data.value)),t}wr(e,t,r){return P.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.fi.get(t);return P.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class To{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Ts=r,this.Is=s}static Es(e,t){let r=W(),s=W();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new To(e,t.fromCache,r,s)}}class yg{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class vg{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(function(){return sf()?8:jp(Ee())>0?6:4})()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.gs(e,t).next((a=>{i.result=a})).next((()=>{if(!i.result)return this.ps(e,t,s,r).next((a=>{i.result=a}))})).next((()=>{if(i.result)return;const a=new yg;return this.ys(e,t,a).next((c=>{if(i.result=c,this.As)return this.ws(e,t,a,c.size)}))})).next((()=>i.result))}ws(e,t,r,s){return r.documentReadCount<this.Vs?(tn()<=H.DEBUG&&x("QueryEngine","SDK will not create cache indexes for query:",nn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),P.resolve()):(tn()<=H.DEBUG&&x("QueryEngine","Query:",nn(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.ds*s?(tn()<=H.DEBUG&&x("QueryEngine","The SDK decides to create cache indexes for query:",nn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Be(t))):P.resolve())}gs(e,t){if(wc(t))return P.resolve(null);let r=Be(t);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=$i(t,null,"F"),r=Be(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((i=>{const a=W(...i);return this.fs.getDocuments(e,a).next((c=>this.indexManager.getMinOffset(e,r).next((u=>{const d=this.bs(t,c);return this.Ss(t,d,a,u.readTime)?this.gs(e,$i(t,null,"F")):this.Ds(e,d,t,u)}))))})))))}ps(e,t,r,s){return wc(t)||s.isEqual($.min())?P.resolve(null):this.fs.getDocuments(e,r).next((i=>{const a=this.bs(t,i);return this.Ss(t,a,r,s)?P.resolve(null):(tn()<=H.DEBUG&&x("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),nn(t)),this.Ds(e,a,t,Mp(s,nr)).next((c=>c)))}))}bs(e,t){let r=new le(gu(e));return t.forEach(((s,i)=>{xs(e,i)&&(r=r.add(i))})),r}Ss(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}ys(e,t,r){return tn()<=H.DEBUG&&x("QueryEngine","Using full collection scan to execute query:",nn(t)),this.fs.getDocumentsMatchingQuery(e,t,It.min(),r)}Ds(e,t,r,s){return this.fs.getDocumentsMatchingQuery(e,r,s).next((i=>(t.forEach((a=>{i=i.insert(a.key,a)})),i)))}}const Io="LocalStore",Eg=3e8;class Tg{constructor(e,t,r,s){this.persistence=e,this.Cs=t,this.serializer=s,this.vs=new te(G),this.Fs=new Kt((i=>fo(i)),po),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new lg(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.vs)))}}function Ig(n,e,t,r){return new Tg(n,e,t,r)}async function $u(n,e){const t=j(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next((i=>(s=i,t.Os(e),t.mutationQueue.getAllMutationBatches(r)))).next((i=>{const a=[],c=[];let u=W();for(const d of s){a.push(d.batchId);for(const f of d.mutations)u=u.add(f.key)}for(const d of i){c.push(d.batchId);for(const f of d.mutations)u=u.add(f.key)}return t.localDocuments.getDocuments(r,u).next((d=>({Ns:d,removedBatchIds:a,addedBatchIds:c})))}))}))}function wg(n,e){const t=j(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=e.batch.keys(),i=t.xs.newChangeBuffer({trackRemovals:!0});return(function(c,u,d,f){const m=d.batch,_=m.keys();let b=P.resolve();return _.forEach((S=>{b=b.next((()=>f.getEntry(u,S))).next((k=>{const C=d.docVersions.get(S);Q(C!==null,48541),k.version.compareTo(C)<0&&(m.applyToRemoteDocument(k,d),k.isValidDocument()&&(k.setReadTime(d.commitVersion),f.addEntry(k)))}))})),b.next((()=>c.mutationQueue.removeMutationBatch(u,m)))})(t,r,e,i).next((()=>i.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(c){let u=W();for(let d=0;d<c.mutationResults.length;++d)c.mutationResults[d].transformResults.length>0&&(u=u.add(c.batch.mutations[d].key));return u})(e)))).next((()=>t.localDocuments.getDocuments(r,s)))}))}function ju(n){const e=j(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.li.getLastRemoteSnapshotVersion(t)))}function Ag(n,e){const t=j(n),r=e.snapshotVersion;let s=t.vs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(i=>{const a=t.xs.newChangeBuffer({trackRemovals:!0});s=t.vs;const c=[];e.targetChanges.forEach(((f,m)=>{const _=s.get(m);if(!_)return;c.push(t.li.removeMatchingKeys(i,f.removedDocuments,m).next((()=>t.li.addMatchingKeys(i,f.addedDocuments,m))));let b=_.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(m)!==null?b=b.withResumeToken(me.EMPTY_BYTE_STRING,$.min()).withLastLimboFreeSnapshotVersion($.min()):f.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(f.resumeToken,r)),s=s.insert(m,b),(function(k,C,D){return k.resumeToken.approximateByteSize()===0||C.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=Eg?!0:D.addedDocuments.size+D.modifiedDocuments.size+D.removedDocuments.size>0})(_,b,f)&&c.push(t.li.updateTargetData(i,b))}));let u=nt(),d=W();if(e.documentUpdates.forEach((f=>{e.resolvedLimboDocuments.has(f)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(i,f))})),c.push(bg(i,a,e.documentUpdates).next((f=>{u=f.Bs,d=f.Ls}))),!r.isEqual($.min())){const f=t.li.getLastRemoteSnapshotVersion(i).next((m=>t.li.setTargetsMetadata(i,i.currentSequenceNumber,r)));c.push(f)}return P.waitFor(c).next((()=>a.apply(i))).next((()=>t.localDocuments.getLocalViewOfDocuments(i,u,d))).next((()=>u))})).then((i=>(t.vs=s,i)))}function bg(n,e,t){let r=W(),s=W();return t.forEach((i=>r=r.add(i))),e.getEntries(n,r).next((i=>{let a=nt();return t.forEach(((c,u)=>{const d=i.get(c);u.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(c)),u.isNoDocument()&&u.version.isEqual($.min())?(e.removeEntry(c,u.readTime),a=a.insert(c,u)):!d.isValidDocument()||u.version.compareTo(d.version)>0||u.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(u),a=a.insert(c,u)):x(Io,"Ignoring outdated watch update for ",c,". Current version:",d.version," Watch version:",u.version)})),{Bs:a,Ls:s}}))}function Rg(n,e){const t=j(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=lo),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function Sg(n,e){const t=j(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return t.li.getTargetData(r,e).next((i=>i?(s=i,P.resolve(s)):t.li.allocateTargetId(r).next((a=>(s=new mt(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.li.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=t.vs.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.vs=t.vs.insert(r.targetId,r),t.Fs.set(e,r.targetId)),r}))}async function Gi(n,e,t){const r=j(n),s=r.vs.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!In(a))throw a;x(Io,`Failed to update sequence numbers for target ${e}: ${a}`)}r.vs=r.vs.remove(e),r.Fs.delete(s.target)}function Oc(n,e,t){const r=j(n);let s=$.min(),i=W();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(u,d,f){const m=j(u),_=m.Fs.get(f);return _!==void 0?P.resolve(m.vs.get(_)):m.li.getTargetData(d,f)})(r,a,Be(e)).next((c=>{if(c)return s=c.lastLimboFreeSnapshotVersion,r.li.getMatchingKeysForTargetId(a,c.targetId).next((u=>{i=u}))})).next((()=>r.Cs.getDocumentsMatchingQuery(a,e,t?s:$.min(),t?i:W()))).next((c=>(Cg(r,dm(e),c),{documents:c,ks:i})))))}function Cg(n,e,t){let r=n.Ms.get(e)||$.min();t.forEach(((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)})),n.Ms.set(e,r)}class Mc{constructor(){this.activeTargetIds=ym()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Pg{constructor(){this.vo=new Mc,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,r){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new Mc,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class kg{Mo(e){}shutdown(){}}const Fc="ConnectivityMonitor";class Uc{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){x(Fc,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){x(Fc,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let jr=null;function Wi(){return jr===null?jr=(function(){return 268435456+Math.round(2147483648*Math.random())})():jr++,"0x"+jr.toString(16)}const wi="RestConnection",Ng={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class Dg{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${r}/databases/${s}`,this.$o=this.databaseId.database===ls?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Wo(e,t,r,s,i){const a=Wi(),c=this.Qo(e,t.toUriEncodedString());x(wi,`Sending RPC '${e}' ${a}:`,c,r);const u={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(u,s,i);const{host:d}=new URL(c),f=Ht(d);return this.zo(e,c,u,r,f).then((m=>(x(wi,`Received RPC '${e}' ${a}: `,m),m)),(m=>{throw pn(wi,`RPC '${e}' ${a} failed with error: `,m,"url: ",c,"request:",r),m}))}jo(e,t,r,s,i,a){return this.Wo(e,t,r,s,i)}Go(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+En})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,i)=>e[i]=s)),r&&r.headers.forEach(((s,i)=>e[i]=s))}Qo(e,t){const r=Ng[e];let s=`${this.qo}/v1/${t}:${r}`;return this.databaseInfo.apiKey&&(s=`${s}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),s}terminate(){}}class Vg{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}const _e="WebChannelConnection",$n=(n,e,t)=>{n.listen(e,(r=>{try{t(r)}catch(s){setTimeout((()=>{throw s}),0)}}))};class an extends Dg{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!an.c_){const e=Gl();$n(e,Hl.STAT_EVENT,(t=>{t.stat===Li.PROXY?x(_e,"STAT_EVENT: detected buffering proxy"):t.stat===Li.NOPROXY&&x(_e,"STAT_EVENT: detected no buffering proxy")})),an.c_=!0}}zo(e,t,r,s,i){const a=Wi();return new Promise(((c,u)=>{const d=new zl;d.setWithCredentials(!0),d.listenOnce(ql.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case Qr.NO_ERROR:const m=d.getResponseJson();x(_e,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(m)),c(m);break;case Qr.TIMEOUT:x(_e,`RPC '${e}' ${a} timed out`),u(new O(N.DEADLINE_EXCEEDED,"Request time out"));break;case Qr.HTTP_ERROR:const _=d.getStatus();if(x(_e,`RPC '${e}' ${a} failed with status:`,_,"response text:",d.getResponseText()),_>0){let b=d.getResponseJson();Array.isArray(b)&&(b=b[0]);const S=b?.error;if(S&&S.status&&S.message){const k=(function(D){const F=D.toLowerCase().replace(/_/g,"-");return Object.values(N).indexOf(F)>=0?F:N.UNKNOWN})(S.status);u(new O(k,S.message))}else u(new O(N.UNKNOWN,"Server responded with status "+d.getStatus()))}else u(new O(N.UNAVAILABLE,"Connection failed."));break;default:B(9055,{l_:e,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{x(_e,`RPC '${e}' ${a} completed.`)}}));const f=JSON.stringify(s);x(_e,`RPC '${e}' ${a} sending request:`,s),d.send(t,"POST",f,r,15)}))}T_(e,t,r){const s=Wi(),i=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=this.createWebChannelTransport(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Go(c.initMessageHeaders,t,r),c.encodeInitMessageHeaders=!0;const d=i.join("");x(_e,`Creating RPC '${e}' stream ${s}: ${d}`,c);const f=a.createWebChannel(d,c);this.I_(f);let m=!1,_=!1;const b=new Vg({Ho:S=>{_?x(_e,`Not sending because RPC '${e}' stream ${s} is closed:`,S):(m||(x(_e,`Opening RPC '${e}' stream ${s} transport.`),f.open(),m=!0),x(_e,`RPC '${e}' stream ${s} sending:`,S),f.send(S))},Jo:()=>f.close()});return $n(f,qn.EventType.OPEN,(()=>{_||(x(_e,`RPC '${e}' stream ${s} transport opened.`),b.i_())})),$n(f,qn.EventType.CLOSE,(()=>{_||(_=!0,x(_e,`RPC '${e}' stream ${s} transport closed`),b.o_(),this.E_(f))})),$n(f,qn.EventType.ERROR,(S=>{_||(_=!0,pn(_e,`RPC '${e}' stream ${s} transport errored. Name:`,S.name,"Message:",S.message),b.o_(new O(N.UNAVAILABLE,"The operation could not be completed")))})),$n(f,qn.EventType.MESSAGE,(S=>{if(!_){const k=S.data[0];Q(!!k,16349);const C=k,D=C?.error||C[0]?.error;if(D){x(_e,`RPC '${e}' stream ${s} received error:`,D);const F=D.status;let L=(function(J){const E=ie[J];if(E!==void 0)return Cu(E)})(F),q=D.message;L===void 0&&(L=N.INTERNAL,q="Unknown error status: "+F+" with message "+D.message),_=!0,b.o_(new O(L,q)),f.close()}else x(_e,`RPC '${e}' stream ${s} received:`,k),b.__(k)}})),an.u_(),setTimeout((()=>{b.s_()}),0),b}terminate(){this.a_.forEach((e=>e.close())),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter((t=>t===e))}Go(e,t,r){super.Go(e,t,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return Wl()}}function xg(n){return new an(n)}function Ai(){return typeof document<"u"?document:null}function Fs(n){return new Fm(n,!0)}an.c_=!1;class zu{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Ci=e,this.timerId=t,this.R_=r,this.A_=s,this.V_=i,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const t=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&x("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}const Bc="PersistentStream";class qu{constructor(e,t,r,s,i,a,c,u){this.Ci=e,this.b_=r,this.S_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=c,this.listener=u,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new zu(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,(()=>this.k_())))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===N.RESOURCE_EXHAUSTED?(tt(t.toString()),tt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===N.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===t&&this.G_(r,s)}),(r=>{e((()=>{const s=new O(N.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(e,t){const r=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo((()=>{r((()=>this.listener.Zo()))})),this.stream.Yo((()=>{r((()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.Yo())))})),this.stream.t_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.H_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return x(Bc,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget((()=>this.D_===e?t():(x(Bc,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Lg extends qu{constructor(e,t,r,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=$m(this.serializer,e),r=(function(i){if(!("targetChange"in i))return $.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?$.min():a.readTime?$e(a.readTime):$.min()})(e);return this.listener.J_(t,r)}Z_(e){const t={};t.database=Hi(this.serializer),t.addTarget=(function(i,a){let c;const u=a.target;if(c=Bi(u)?{documents:qm(i,u)}:{query:Hm(i,u).ft},c.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){c.resumeToken=Nu(i,a.resumeToken);const d=ji(i,a.expectedCount);d!==null&&(c.expectedCount=d)}else if(a.snapshotVersion.compareTo($.min())>0){c.readTime=ps(i,a.snapshotVersion.toTimestamp());const d=ji(i,a.expectedCount);d!==null&&(c.expectedCount=d)}return c})(this.serializer,e);const r=Wm(this.serializer,e);r&&(t.labels=r),this.K_(t)}X_(e){const t={};t.database=Hi(this.serializer),t.removeTarget=e,this.K_(t)}}class Og extends qu{constructor(e,t,r,s,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return Q(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Q(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Q(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=zm(e.writeResults,e.commitTime),r=$e(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=Hi(this.serializer),this.K_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>jm(this.serializer,r)))};this.K_(t)}}class Mg{}class Fg extends Mg{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new O(N.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,a])=>this.connection.Wo(e,zi(t,r),s,i,a))).catch((i=>{throw i.name==="FirebaseError"?(i.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new O(N.UNKNOWN,i.toString())}))}jo(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,c])=>this.connection.jo(e,zi(t,r),s,a,c,i))).catch((a=>{throw a.name==="FirebaseError"?(a.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new O(N.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}function Ug(n,e,t,r){return new Fg(n,e,t,r)}class Bg{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(tt(t),this.aa=!1):x("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const jt="RemoteStore";class $g{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=i,this.Aa.Mo((a=>{r.enqueueAndForget((async()=>{Jt(this)&&(x(jt,"Restarting streams for network reachability change."),await(async function(u){const d=j(u);d.Ea.add(4),await gr(d),d.Va.set("Unknown"),d.Ea.delete(4),await Us(d)})(this))}))})),this.Va=new Bg(r,s)}}async function Us(n){if(Jt(n))for(const e of n.Ra)await e(!0)}async function gr(n){for(const e of n.Ra)await e(!1)}function Hu(n,e){const t=j(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Ro(t)?bo(t):wn(t).O_()&&Ao(t,e))}function wo(n,e){const t=j(n),r=wn(t);t.Ia.delete(e),r.O_()&&Gu(t,e),t.Ia.size===0&&(r.O_()?r.L_():Jt(t)&&t.Va.set("Unknown"))}function Ao(n,e){if(n.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo($.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}wn(n).Z_(e)}function Gu(n,e){n.da.$e(e),wn(n).X_(e)}function bo(n){n.da=new xm({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),wn(n).start(),n.Va.ua()}function Ro(n){return Jt(n)&&!wn(n).x_()&&n.Ia.size>0}function Jt(n){return j(n).Ea.size===0}function Wu(n){n.da=void 0}async function jg(n){n.Va.set("Online")}async function zg(n){n.Ia.forEach(((e,t)=>{Ao(n,e)}))}async function qg(n,e){Wu(n),Ro(n)?(n.Va.ha(e),bo(n)):n.Va.set("Unknown")}async function Hg(n,e,t){if(n.Va.set("Online"),e instanceof ku&&e.state===2&&e.cause)try{await(async function(s,i){const a=i.cause;for(const c of i.targetIds)s.Ia.has(c)&&(await s.remoteSyncer.rejectListen(c,a),s.Ia.delete(c),s.da.removeTarget(c))})(n,e)}catch(r){x(jt,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await gs(n,r)}else if(e instanceof Zr?n.da.Xe(e):e instanceof Pu?n.da.st(e):n.da.tt(e),!t.isEqual($.min()))try{const r=await ju(n.localStore);t.compareTo(r)>=0&&await(function(i,a){const c=i.da.Tt(a);return c.targetChanges.forEach(((u,d)=>{if(u.resumeToken.approximateByteSize()>0){const f=i.Ia.get(d);f&&i.Ia.set(d,f.withResumeToken(u.resumeToken,a))}})),c.targetMismatches.forEach(((u,d)=>{const f=i.Ia.get(u);if(!f)return;i.Ia.set(u,f.withResumeToken(me.EMPTY_BYTE_STRING,f.snapshotVersion)),Gu(i,u);const m=new mt(f.target,u,d,f.sequenceNumber);Ao(i,m)})),i.remoteSyncer.applyRemoteEvent(c)})(n,t)}catch(r){x(jt,"Failed to raise snapshot:",r),await gs(n,r)}}async function gs(n,e,t){if(!In(e))throw e;n.Ea.add(1),await gr(n),n.Va.set("Offline"),t||(t=()=>ju(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{x(jt,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Us(n)}))}function Ku(n,e){return e().catch((t=>gs(n,t,e)))}async function Bs(n){const e=j(n),t=Rt(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:lo;for(;Gg(e);)try{const s=await Rg(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,Wg(e,s)}catch(s){await gs(e,s)}Qu(e)&&Ju(e)}function Gg(n){return Jt(n)&&n.Ta.length<10}function Wg(n,e){n.Ta.push(e);const t=Rt(n);t.O_()&&t.Y_&&t.ea(e.mutations)}function Qu(n){return Jt(n)&&!Rt(n).x_()&&n.Ta.length>0}function Ju(n){Rt(n).start()}async function Kg(n){Rt(n).ra()}async function Qg(n){const e=Rt(n);for(const t of n.Ta)e.ea(t.mutations)}async function Jg(n,e,t){const r=n.Ta.shift(),s=go.from(r,e,t);await Ku(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await Bs(n)}async function Yg(n,e){e&&Rt(n).Y_&&await(async function(r,s){if((function(a){return Nm(a)&&a!==N.ABORTED})(s.code)){const i=r.Ta.shift();Rt(r).B_(),await Ku(r,(()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s))),await Bs(r)}})(n,e),Qu(n)&&Ju(n)}async function $c(n,e){const t=j(n);t.asyncQueue.verifyOperationInProgress(),x(jt,"RemoteStore received new credentials");const r=Jt(t);t.Ea.add(3),await gr(t),r&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Us(t)}async function Xg(n,e){const t=j(n);e?(t.Ea.delete(2),await Us(t)):e||(t.Ea.add(2),await gr(t),t.Va.set("Unknown"))}function wn(n){return n.ma||(n.ma=(function(t,r,s){const i=j(t);return i.sa(),new Lg(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(n.datastore,n.asyncQueue,{Zo:jg.bind(null,n),Yo:zg.bind(null,n),t_:qg.bind(null,n),J_:Hg.bind(null,n)}),n.Ra.push((async e=>{e?(n.ma.B_(),Ro(n)?bo(n):n.Va.set("Unknown")):(await n.ma.stop(),Wu(n))}))),n.ma}function Rt(n){return n.fa||(n.fa=(function(t,r,s){const i=j(t);return i.sa(),new Og(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),Yo:Kg.bind(null,n),t_:Yg.bind(null,n),ta:Qg.bind(null,n),na:Jg.bind(null,n)}),n.Ra.push((async e=>{e?(n.fa.B_(),await Bs(n)):(await n.fa.stop(),n.Ta.length>0&&(x(jt,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class So{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new vt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const a=Date.now()+r,c=new So(e,t,a,s,i);return c.start(r),c}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new O(N.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Co(n,e){if(tt("AsyncQueue",`${e}: ${n}`),In(n))return new O(N.UNAVAILABLE,`${e}: ${n}`);throw n}class cn{static emptySet(e){return new cn(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||M.comparator(t.key,r.key):(t,r)=>M.comparator(t.key,r.key),this.keyedMap=Hn(),this.sortedSet=new te(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof cn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new cn;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class jc{constructor(){this.ga=new te(M.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):B(63341,{Vt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class vn{constructor(e,t,r,s,i,a,c,u,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=c,this.excludesMetadataChanges=u,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,s,i){const a=[];return t.forEach((c=>{a.push({type:0,doc:c})})),new vn(e,t,cn.emptySet(t),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Vs(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class Zg{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some((e=>e.Da()))}}class e_{constructor(){this.queries=zc(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=j(t),i=s.queries;s.queries=zc(),i.forEach(((a,c)=>{for(const u of c.ba)u.onError(r)}))})(this,new O(N.ABORTED,"Firestore shutting down"))}}function zc(){return new Kt((n=>mu(n)),Vs)}async function t_(n,e){const t=j(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.Sa()&&e.Da()&&(r=2):(i=new Zg,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const c=Co(a,`Initialization of query '${nn(e.query)}' failed`);return void e.onError(c)}t.queries.set(s,i),i.ba.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&Po(t)}async function n_(n,e){const t=j(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const a=i.ba.indexOf(e);a>=0&&(i.ba.splice(a,1),i.ba.length===0?s=e.Da()?0:1:!i.Sa()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function r_(n,e){const t=j(n);let r=!1;for(const s of e){const i=s.query,a=t.queries.get(i);if(a){for(const c of a.ba)c.Fa(s)&&(r=!0);a.wa=s}}r&&Po(t)}function s_(n,e,t){const r=j(n),s=r.queries.get(e);if(s)for(const i of s.ba)i.onError(t);r.queries.delete(e)}function Po(n){n.Ca.forEach((e=>{e.next()}))}var Ki,qc;(qc=Ki||(Ki={})).Ma="default",qc.Cache="cache";class i_{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new vn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.Ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=vn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Ki.Cache}}class Yu{constructor(e){this.key=e}}class Xu{constructor(e){this.key=e}}class o_{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=W(),this.mutatedKeys=W(),this.eu=gu(e),this.tu=new cn(this.eu)}get nu(){return this.Za}ru(e,t){const r=t?t.iu:new jc,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,a=s,c=!1;const u=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((f,m)=>{const _=s.get(f),b=xs(this.query,m)?m:null,S=!!_&&this.mutatedKeys.has(_.key),k=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations);let C=!1;_&&b?_.data.isEqual(b.data)?S!==k&&(r.track({type:3,doc:b}),C=!0):this.su(_,b)||(r.track({type:2,doc:b}),C=!0,(u&&this.eu(b,u)>0||d&&this.eu(b,d)<0)&&(c=!0)):!_&&b?(r.track({type:0,doc:b}),C=!0):_&&!b&&(r.track({type:1,doc:_}),C=!0,(u||d)&&(c=!0)),C&&(b?(a=a.add(b),i=k?i.add(f):i.delete(f)):(a=a.delete(f),i=i.delete(f)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),i=i.delete(f.key),r.track({type:1,doc:f})}return{tu:a,iu:r,Ss:c,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((f,m)=>(function(b,S){const k=C=>{switch(C){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return B(20277,{Vt:C})}};return k(b)-k(S)})(f.type,m.type)||this.eu(f.doc,m.doc))),this.ou(r),s=s??!1;const c=t&&!s?this._u():[],u=this.Ya.size===0&&this.current&&!s?1:0,d=u!==this.Xa;return this.Xa=u,a.length!==0||d?{snapshot:new vn(this.query,e.tu,i,a,e.mutatedKeys,u===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:c}:{au:c}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new jc,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Za=this.Za.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Za=this.Za.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=W(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Ya=this.Ya.add(r.key))}));const t=[];return e.forEach((r=>{this.Ya.has(r)||t.push(new Xu(r))})),this.Ya.forEach((r=>{e.has(r)||t.push(new Yu(r))})),t}cu(e){this.Za=e.ks,this.Ya=W();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return vn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const ko="SyncEngine";class a_{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class c_{constructor(e){this.key=e,this.hu=!1}}class l_{constructor(e,t,r,s,i,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Kt((c=>mu(c)),Vs),this.Iu=new Map,this.Eu=new Set,this.Ru=new te(M.comparator),this.Au=new Map,this.Vu=new vo,this.du={},this.mu=new Map,this.fu=yn.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function u_(n,e,t=!0){const r=sh(n);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await Zu(r,e,t,!0),s}async function h_(n,e){const t=sh(n);await Zu(t,e,!0,!1)}async function Zu(n,e,t,r){const s=await Sg(n.localStore,Be(e)),i=s.targetId,a=n.sharedClientState.addLocalQueryTarget(i,t);let c;return r&&(c=await d_(n,e,i,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&Hu(n.remoteStore,s),c}async function d_(n,e,t,r,s){n.pu=(m,_,b)=>(async function(k,C,D,F){let L=C.view.ru(D);L.Ss&&(L=await Oc(k.localStore,C.query,!1).then((({documents:E})=>C.view.ru(E,L))));const q=F&&F.targetChanges.get(C.targetId),ne=F&&F.targetMismatches.get(C.targetId)!=null,J=C.view.applyChanges(L,k.isPrimaryClient,q,ne);return Gc(k,C.targetId,J.au),J.snapshot})(n,m,_,b);const i=await Oc(n.localStore,e,!0),a=new o_(e,i.ks),c=a.ru(i.documents),u=mr.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),d=a.applyChanges(c,n.isPrimaryClient,u);Gc(n,t,d.au);const f=new a_(e,t,a);return n.Tu.set(e,f),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),d.snapshot}async function f_(n,e,t){const r=j(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter((a=>!Vs(a,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Gi(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),t&&wo(r.remoteStore,s.targetId),Qi(r,s.targetId)})).catch(Tn)):(Qi(r,s.targetId),await Gi(r.localStore,s.targetId,!0))}async function p_(n,e){const t=j(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),wo(t.remoteStore,r.targetId))}async function m_(n,e,t){const r=I_(n);try{const s=await(function(a,c){const u=j(a),d=ee.now(),f=c.reduce(((b,S)=>b.add(S.key)),W());let m,_;return u.persistence.runTransaction("Locally write mutations","readwrite",(b=>{let S=nt(),k=W();return u.xs.getEntries(b,f).next((C=>{S=C,S.forEach(((D,F)=>{F.isValidDocument()||(k=k.add(D))}))})).next((()=>u.localDocuments.getOverlayedDocuments(b,S))).next((C=>{m=C;const D=[];for(const F of c){const L=Rm(F,m.get(F.key).overlayedDocument);L!=null&&D.push(new Qt(F.key,L,au(L.value.mapValue),Xe.exists(!0)))}return u.mutationQueue.addMutationBatch(b,d,D,c)})).next((C=>{_=C;const D=C.applyToLocalDocumentSet(m,k);return u.documentOverlayCache.saveOverlays(b,C.batchId,D)}))})).then((()=>({batchId:_.batchId,changes:yu(m)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),(function(a,c,u){let d=a.du[a.currentUser.toKey()];d||(d=new te(G)),d=d.insert(c,u),a.du[a.currentUser.toKey()]=d})(r,s.batchId,t),await _r(r,s.changes),await Bs(r.remoteStore)}catch(s){const i=Co(s,"Failed to persist write");t.reject(i)}}async function eh(n,e){const t=j(n);try{const r=await Ag(t.localStore,e);e.targetChanges.forEach(((s,i)=>{const a=t.Au.get(i);a&&(Q(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?Q(a.hu,14607):s.removedDocuments.size>0&&(Q(a.hu,42227),a.hu=!1))})),await _r(t,r,e)}catch(r){await Tn(r)}}function Hc(n,e,t){const r=j(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach(((i,a)=>{const c=a.view.va(e);c.snapshot&&s.push(c.snapshot)})),(function(a,c){const u=j(a);u.onlineState=c;let d=!1;u.queries.forEach(((f,m)=>{for(const _ of m.ba)_.va(c)&&(d=!0)})),d&&Po(u)})(r.eventManager,e),s.length&&r.Pu.J_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function g_(n,e,t){const r=j(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),i=s&&s.key;if(i){let a=new te(M.comparator);a=a.insert(i,ve.newNoDocument(i,$.min()));const c=W().add(i),u=new Ms($.min(),new Map,new te(G),a,c);await eh(r,u),r.Ru=r.Ru.remove(i),r.Au.delete(e),No(r)}else await Gi(r.localStore,e,!1).then((()=>Qi(r,e,t))).catch(Tn)}async function __(n,e){const t=j(n),r=e.batch.batchId;try{const s=await wg(t.localStore,e);nh(t,r,null),th(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await _r(t,s)}catch(s){await Tn(s)}}async function y_(n,e,t){const r=j(n);try{const s=await(function(a,c){const u=j(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let f;return u.mutationQueue.lookupMutationBatch(d,c).next((m=>(Q(m!==null,37113),f=m.keys(),u.mutationQueue.removeMutationBatch(d,m)))).next((()=>u.mutationQueue.performConsistencyCheck(d))).next((()=>u.documentOverlayCache.removeOverlaysForBatchId(d,f,c))).next((()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f))).next((()=>u.localDocuments.getDocuments(d,f)))}))})(r.localStore,e);nh(r,e,t),th(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await _r(r,s)}catch(s){await Tn(s)}}function th(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function nh(n,e,t){const r=j(n);let s=r.du[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.du[r.currentUser.toKey()]=s}}function Qi(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Vu.Gr(e).forEach((r=>{n.Vu.containsKey(r)||rh(n,r)}))}function rh(n,e){n.Eu.delete(e.path.canonicalString());const t=n.Ru.get(e);t!==null&&(wo(n.remoteStore,t),n.Ru=n.Ru.remove(e),n.Au.delete(t),No(n))}function Gc(n,e,t){for(const r of t)r instanceof Yu?(n.Vu.addReference(r.key,e),v_(n,r)):r instanceof Xu?(x(ko,"Document no longer in limbo: "+r.key),n.Vu.removeReference(r.key,e),n.Vu.containsKey(r.key)||rh(n,r.key)):B(19791,{wu:r})}function v_(n,e){const t=e.key,r=t.path.canonicalString();n.Ru.get(t)||n.Eu.has(r)||(x(ko,"New document in limbo: "+t),n.Eu.add(r),No(n))}function No(n){for(;n.Eu.size>0&&n.Ru.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new M(Z.fromString(e)),r=n.fu.next();n.Au.set(r,new c_(t)),n.Ru=n.Ru.insert(t,r),Hu(n.remoteStore,new mt(Be(pu(t.path)),r,"TargetPurposeLimboResolution",Ps.ce))}}async function _r(n,e,t){const r=j(n),s=[],i=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((c,u)=>{a.push(r.pu(u,e,t).then((d=>{if((d||t)&&r.isPrimaryClient){const f=d?!d.fromCache:t?.targetChanges.get(u.targetId)?.current;r.sharedClientState.updateQueryState(u.targetId,f?"current":"not-current")}if(d){s.push(d);const f=To.Es(u.targetId,d);i.push(f)}})))})),await Promise.all(a),r.Pu.J_(s),await(async function(u,d){const f=j(u);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",(m=>P.forEach(d,(_=>P.forEach(_.Ts,(b=>f.persistence.referenceDelegate.addReference(m,_.targetId,b))).next((()=>P.forEach(_.Is,(b=>f.persistence.referenceDelegate.removeReference(m,_.targetId,b)))))))))}catch(m){if(!In(m))throw m;x(Io,"Failed to update sequence numbers: "+m)}for(const m of d){const _=m.targetId;if(!m.fromCache){const b=f.vs.get(_),S=b.snapshotVersion,k=b.withLastLimboFreeSnapshotVersion(S);f.vs=f.vs.insert(_,k)}}})(r.localStore,i))}async function E_(n,e){const t=j(n);if(!t.currentUser.isEqual(e)){x(ko,"User change. New user:",e.toKey());const r=await $u(t.localStore,e);t.currentUser=e,(function(i,a){i.mu.forEach((c=>{c.forEach((u=>{u.reject(new O(N.CANCELLED,a))}))})),i.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await _r(t,r.Ns)}}function T_(n,e){const t=j(n),r=t.Au.get(e);if(r&&r.hu)return W().add(r.key);{let s=W();const i=t.Iu.get(e);if(!i)return s;for(const a of i){const c=t.Tu.get(a);s=s.unionWith(c.view.nu)}return s}}function sh(n){const e=j(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=eh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=T_.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=g_.bind(null,e),e.Pu.J_=r_.bind(null,e.eventManager),e.Pu.yu=s_.bind(null,e.eventManager),e}function I_(n){const e=j(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=__.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=y_.bind(null,e),e}class _s{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Fs(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return Ig(this.persistence,new vg,e.initialUser,this.serializer)}Cu(e){return new Bu(Eo.Vi,this.serializer)}Du(e){return new Pg}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}_s.provider={build:()=>new _s};class w_ extends _s{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Q(this.persistence.referenceDelegate instanceof ms,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new sg(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?be.withCacheSize(this.cacheSizeBytes):be.DEFAULT;return new Bu((r=>ms.Vi(r,t)),this.serializer)}}class Ji{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Hc(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=E_.bind(null,this.syncEngine),await Xg(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new e_})()}createDatastore(e){const t=Fs(e.databaseInfo.databaseId),r=xg(e.databaseInfo);return Ug(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,s,i,a,c){return new $g(r,s,i,a,c)})(this.localStore,this.datastore,e.asyncQueue,(t=>Hc(this.syncEngine,t,0)),(function(){return Uc.v()?new Uc:new kg})())}createSyncEngine(e,t){return(function(s,i,a,c,u,d,f){const m=new l_(s,i,a,c,u,d);return f&&(m.gu=!0),m})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=j(t);x(jt,"RemoteStore shutting down."),r.Ea.add(5),await gr(r),r.Aa.shutdown(),r.Va.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Ji.provider={build:()=>new Ji};class A_{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):tt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const St="FirestoreClient";class b_{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=s,this.user=ye.UNAUTHENTICATED,this.clientId=ao.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,(async a=>{x(St,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(x(St,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new vt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Co(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function bi(n,e){n.asyncQueue.verifyOperationInProgress(),x(St,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await $u(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function Wc(n,e){n.asyncQueue.verifyOperationInProgress();const t=await R_(n);x(St,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>$c(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>$c(e.remoteStore,s))),n._onlineComponents=e}async function R_(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){x(St,"Using user provided OfflineComponentProvider");try{await bi(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===N.FAILED_PRECONDITION||s.code===N.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;pn("Error using user provided cache. Falling back to memory cache: "+t),await bi(n,new _s)}}else x(St,"Using default OfflineComponentProvider"),await bi(n,new w_(void 0));return n._offlineComponents}async function ih(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(x(St,"Using user provided OnlineComponentProvider"),await Wc(n,n._uninitializedComponentsProvider._online)):(x(St,"Using default OnlineComponentProvider"),await Wc(n,new Ji))),n._onlineComponents}function S_(n){return ih(n).then((e=>e.syncEngine))}async function C_(n){const e=await ih(n),t=e.eventManager;return t.onListen=u_.bind(null,e.syncEngine),t.onUnlisten=f_.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=h_.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=p_.bind(null,e.syncEngine),t}function P_(n,e,t={}){const r=new vt;return n.asyncQueue.enqueueAndForget((async()=>(function(i,a,c,u,d){const f=new A_({next:_=>{f.Nu(),a.enqueueAndForget((()=>n_(i,m))),_.fromCache&&u.source==="server"?d.reject(new O(N.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(_)},error:_=>d.reject(_)}),m=new i_(c,f,{includeMetadataChanges:!0,Ka:!0});return t_(i,m)})(await C_(n),n.asyncQueue,e,t,r))),r.promise}function k_(n,e){const t=new vt;return n.asyncQueue.enqueueAndForget((async()=>m_(await S_(n),e,t))),t.promise}function oh(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const N_="ComponentProvider",Kc=new Map;function D_(n,e,t,r,s){return new Wp(n,e,t,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,oh(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator,r)}const ah="firestore.googleapis.com",Qc=!0;class Jc{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new O(N.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=ah,this.ssl=Qc}else this.host=e.host,this.ssl=e.ssl??Qc;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Uu;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<ng)throw new O(N.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Op("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=oh(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new O(N.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new O(N.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new O(N.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class $s{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Jc({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new O(N.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new O(N.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Jc(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new Rp;switch(r.type){case"firstParty":return new kp(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new O(N.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=Kc.get(t);r&&(x(N_,"Removing Datastore"),Kc.delete(t),r.terminate())})(this),Promise.resolve()}}function V_(n,e,t,r={}){n=as(n,$s);const s=Ht(e),i=n._getSettings(),a={...i,emulatorOptions:n._getEmulatorOptions()},c=`${e}:${t}`;s&&(to(`https://${c}`),no("Firestore",!0)),i.host!==ah&&i.host!==c&&pn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u={...i,host:c,ssl:s,emulatorOptions:r};if(!Ut(u,a)&&(n._setSettings(u),r.mockUserToken)){let d,f;if(typeof r.mockUserToken=="string")d=r.mockUserToken,f=ye.MOCK_USER;else{d=Ol(r.mockUserToken,n._app?.options.projectId);const m=r.mockUserToken.sub||r.mockUserToken.user_id;if(!m)throw new O(N.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new ye(m)}n._authCredentials=new Sp(new Ql(d,f))}}class js{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new js(this.firestore,e,this._query)}}class pe{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Et(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new pe(this.firestore,e,this._key)}toJSON(){return{type:pe._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(fr(t,pe._jsonSchema))return new pe(e,r||null,new M(Z.fromString(t.referencePath)))}}pe._jsonSchemaVersion="firestore/documentReference/1.0",pe._jsonSchema={type:oe("string",pe._jsonSchemaVersion),referencePath:oe("string")};class Et extends js{constructor(e,t,r){super(e,t,pu(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new pe(this.firestore,null,new M(e))}withConverter(e){return new Et(this.firestore,e,this._path)}}function Wn(n,e,...t){if(n=we(n),Jl("collection","path",e),n instanceof $s){const r=Z.fromString(e,...t);return uc(r),new Et(n,null,r)}{if(!(n instanceof pe||n instanceof Et))throw new O(N.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Z.fromString(e,...t));return uc(r),new Et(n.firestore,null,r)}}function x_(n,e,...t){if(n=we(n),arguments.length===1&&(e=ao.newId()),Jl("doc","path",e),n instanceof $s){const r=Z.fromString(e,...t);return lc(r),new pe(n,null,new M(r))}{if(!(n instanceof pe||n instanceof Et))throw new O(N.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Z.fromString(e,...t));return lc(r),new pe(n.firestore,n instanceof Et?n.converter:null,new M(r))}}const Yc="AsyncQueue";class Xc{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new zu(this,"async_queue_retry"),this._c=()=>{const r=Ai();r&&x(Yc,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=Ai();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Ai();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new vt;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Yu.push(e),this.lc())))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!In(e))throw e;x(Yc,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,tt("INTERNAL UNHANDLED ERROR: ",Zc(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=So.createAndSchedule(this,e,t,r,(i=>this.hc(i)));return this.tc.push(s),s}uc(){this.nc&&B(47125,{Pc:Zc(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}Rc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Zc(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class Do extends $s{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new Xc,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Xc(e),this._firestoreClient=void 0,await e}}}function L_(n,e){const t=typeof n=="object"?n:io(),r=typeof n=="string"?n:ls,s=Cs(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=Vl("firestore");i&&V_(s,...i)}return s}function ch(n){if(n._terminated)throw new O(N.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||O_(n),n._firestoreClient}function O_(n){const e=n._freezeSettings(),t=D_(n._databaseId,n._app?.options.appId||"",n._persistenceKey,n._app?.options.apiKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new b_(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(s){const i=s?._online.build();return{_offline:s?._offline.build(i),_online:i}})(n._componentsProvider))}class Pe{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Pe(me.fromBase64String(e))}catch(t){throw new O(N.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Pe(me.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Pe._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(fr(e,Pe._jsonSchema))return Pe.fromBase64String(e.bytes)}}Pe._jsonSchemaVersion="firestore/bytes/1.0",Pe._jsonSchema={type:oe("string",Pe._jsonSchemaVersion),bytes:oe("string")};class lh{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new O(N.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new fe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Vo{constructor(e){this._methodName=e}}class je{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new O(N.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new O(N.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return G(this._lat,e._lat)||G(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:je._jsonSchemaVersion}}static fromJSON(e){if(fr(e,je._jsonSchema))return new je(e.latitude,e.longitude)}}je._jsonSchemaVersion="firestore/geoPoint/1.0",je._jsonSchema={type:oe("string",je._jsonSchemaVersion),latitude:oe("number"),longitude:oe("number")};class Ve{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Ve._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(fr(e,Ve._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Ve(e.vectorValues);throw new O(N.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ve._jsonSchemaVersion="firestore/vectorValue/1.0",Ve._jsonSchema={type:oe("string",Ve._jsonSchemaVersion),vectorValues:oe("object")};const M_=/^__.*__$/;class F_{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Qt(e,this.data,this.fieldMask,t,this.fieldTransforms):new pr(e,this.data,t,this.fieldTransforms)}}function uh(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw B(40011,{dataSource:n})}}class xo{constructor(e,t,r,s,i,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new xo({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){const t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){const t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return ys(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(uh(this.dataSource)&&M_.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class U_{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Fs(e)}createContext(e,t,r,s=!1){return new xo({dataSource:e,methodName:t,targetDoc:r,path:fe.emptyPath(),arrayElement:!1,hasConverter:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function B_(n){const e=n._freezeSettings(),t=Fs(n._databaseId);return new U_(n._databaseId,!!e.ignoreUndefinedProperties,t)}function $_(n,e,t,r,s,i={}){const a=n.createContext(i.merge||i.mergeFields?2:0,e,t,s);ph("Data must be an object, but it was:",a,r);const c=dh(r,a);let u,d;if(i.merge)u=new ke(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){const f=[];for(const m of i.mergeFields){const _=Oo(e,m,t);if(!a.contains(_))throw new O(N.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);q_(f,_)||f.push(_)}u=new ke(f),d=a.fieldTransforms.filter((m=>u.covers(m.field)))}else u=null,d=a.fieldTransforms;return new F_(new Ce(c),u,d)}class Lo extends Vo{_toFieldTransform(e){return new Im(e.path,new or)}isEqual(e){return e instanceof Lo}}function hh(n,e){if(fh(n=we(n)))return ph("Unsupported field value:",e,n),dh(n,e);if(n instanceof Vo)return(function(r,s){if(!uh(s.dataSource))throw s.createError(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.createError(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return(function(r,s){const i=[];let a=0;for(const c of r){let u=hh(c,s.childContextForArray(a));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),a++}return{arrayValue:{values:i}}})(n,e)}return(function(r,s){if((r=we(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return vm(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=ee.fromDate(r);return{timestampValue:ps(s.serializer,i)}}if(r instanceof ee){const i=new ee(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:ps(s.serializer,i)}}if(r instanceof je)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Pe)return{bytesValue:Nu(s.serializer,r._byteString)};if(r instanceof pe){const i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.createError(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:yo(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Ve)return(function(a,c){const u=a instanceof Ve?a.toArray():a;return{mapValue:{fields:{[iu]:{stringValue:ou},[us]:{arrayValue:{values:u.map((f=>{if(typeof f!="number")throw c.createError("VectorValues must only contain numeric values.");return mo(c.serializer,f)}))}}}}}})(r,s);if(Fu(r))return r._toProto(s.serializer);throw s.createError(`Unsupported field value: ${co(r)}`)})(n,e)}function dh(n,e){const t={};return Zl(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Wt(n,((r,s)=>{const i=hh(s,e.childContextForField(r));i!=null&&(t[r]=i)})),{mapValue:{fields:t}}}function fh(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ee||n instanceof je||n instanceof Pe||n instanceof pe||n instanceof Vo||n instanceof Ve||Fu(n))}function ph(n,e,t){if(!fh(t)||!Yl(t)){const r=co(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function Oo(n,e,t){if((e=we(e))instanceof lh)return e._internalPath;if(typeof e=="string")return z_(n,e);throw ys("Field path arguments must be of type string or ",n,!1,void 0,t)}const j_=new RegExp("[~\\*/\\[\\]]");function z_(n,e,t){if(e.search(j_)>=0)throw ys(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new lh(...e.split("."))._internalPath}catch{throw ys(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function ys(n,e,t,r,s){const i=r&&!r.isEmpty(),a=s!==void 0;let c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let u="";return(i||a)&&(u+=" (found",i&&(u+=` in field ${r}`),a&&(u+=` in document ${s}`),u+=")"),new O(N.INVALID_ARGUMENT,c+n+u)}function q_(n,e){return n.some((t=>t.isEqual(e)))}class H_{convertValue(e,t="none"){switch(bt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return se(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(At(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw B(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Wt(e,((s,i)=>{r[s]=this.convertValue(i,t)})),r}convertVectorValue(e){const t=e.fields?.[us].arrayValue?.values?.map((r=>se(r.doubleValue)));return new Ve(t)}convertGeoPoint(e){return new je(se(e.latitude),se(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Ns(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(rr(e));default:return null}}convertTimestamp(e){const t=wt(e);return new ee(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Z.fromString(e);Q(Mu(r),9688,{name:e});const s=new sr(r.get(1),r.get(3)),i=new M(r.popFirst(5));return s.isEqual(t)||tt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class G_ extends H_{constructor(e){super(),this.firestore=e}convertBytes(e){return new Pe(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new pe(this.firestore,null,t)}}function W_(){return new Lo("serverTimestamp")}const el="@firebase/firestore",tl="4.10.0";class mh{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new pe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new K_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){const t=this._document.data.field(Oo("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class K_ extends mh{data(){return super.data()}}function Q_(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new O(N.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function J_(n,e,t){let r;return r=n?n.toFirestore(e):e,r}class zr{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ln extends mh{constructor(e,t,r,s,i,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new es(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Oo("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new O(N.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=ln._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}ln._jsonSchemaVersion="firestore/documentSnapshot/1.0",ln._jsonSchema={type:oe("string",ln._jsonSchemaVersion),bundleSource:oe("string","DocumentSnapshot"),bundleName:oe("string"),bundle:oe("string")};class es extends ln{data(e={}){return super.data(e)}}class un{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new zr(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new es(this._firestore,this._userDataWriter,r.key,r,new zr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new O(N.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((c=>{const u=new es(s._firestore,s._userDataWriter,c.doc.key,c.doc,new zr(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);return c.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((c=>i||c.type!==3)).map((c=>{const u=new es(s._firestore,s._userDataWriter,c.doc.key,c.doc,new zr(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,f=-1;return c.type!==0&&(d=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),c.type!==1&&(a=a.add(c.doc),f=a.indexOf(c.doc.key)),{type:Y_(c.type),doc:u,oldIndex:d,newIndex:f}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new O(N.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=un._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=ao.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach((i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Y_(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return B(61501,{type:n})}}un._jsonSchemaVersion="firestore/querySnapshot/1.0",un._jsonSchema={type:oe("string",un._jsonSchemaVersion),bundleSource:oe("string","QuerySnapshot"),bundleName:oe("string"),bundle:oe("string")};function qr(n){n=as(n,js);const e=as(n.firestore,Do),t=ch(e),r=new G_(e);return Q_(n._query),P_(t,n._query).then((s=>new un(e,r,n,s)))}function X_(n,e){const t=as(n.firestore,Do),r=x_(n),s=J_(n.converter,e),i=B_(n.firestore);return Z_(t,[$_(i,"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Xe.exists(!1))]).then((()=>r))}function Z_(n,e){const t=ch(n);return k_(t,e)}(function(e,t=!0){bp(Gt),Bt(new Tt("firestore",((r,{instanceIdentifier:s,options:i})=>{const a=r.getProvider("app").getImmediate(),c=new Do(new Cp(r.getProvider("auth-internal")),new Np(a,r.getProvider("app-check-internal")),Kp(a,s),a);return i={useFetchStreams:t,...i},c._setSettings(i),c}),"PUBLIC").setMultipleInstances(!0)),Ue(el,tl,e),Ue(el,tl,"esm2020")})();const gh="firebasestorage.googleapis.com",ey="storageBucket",ty=120*1e3,ny=600*1e3;class Qe extends Ke{constructor(e,t,r=0){super(Ri(e),`Firebase Storage: ${t} (${Ri(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Qe.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Ri(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var We;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(We||(We={}));function Ri(n){return"storage/"+n}function ry(){const n="An unknown error occurred, please check the error payload for server response.";return new Qe(We.UNKNOWN,n)}function sy(){return new Qe(We.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function iy(){return new Qe(We.CANCELED,"User canceled the upload/download.")}function oy(n){return new Qe(We.INVALID_URL,"Invalid URL '"+n+"'.")}function ay(n){return new Qe(We.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function nl(n){return new Qe(We.INVALID_ARGUMENT,n)}function _h(){return new Qe(We.APP_DELETED,"The Firebase app was deleted.")}function cy(n){return new Qe(We.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}class Ne{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=Ne.makeFromUrl(e,t)}catch{return new Ne(e,"")}if(r.path==="")return r;throw ay(e)}static makeFromUrl(e,t){let r=null;const s="([A-Za-z0-9.\\-_]+)";function i(q){q.path.charAt(q.path.length-1)==="/"&&(q.path_=q.path_.slice(0,-1))}const a="(/(.*))?$",c=new RegExp("^gs://"+s+a,"i"),u={bucket:1,path:3};function d(q){q.path_=decodeURIComponent(q.path)}const f="v[A-Za-z0-9_]+",m=t.replace(/[.]/g,"\\."),_="(/([^?#]*).*)?$",b=new RegExp(`^https?://${m}/${f}/b/${s}/o${_}`,"i"),S={bucket:1,path:3},k=t===gh?"(?:storage.googleapis.com|storage.cloud.google.com)":t,C="([^?#]*)",D=new RegExp(`^https?://${k}/${s}/${C}`,"i"),L=[{regex:c,indices:u,postModify:i},{regex:b,indices:S,postModify:d},{regex:D,indices:{bucket:1,path:2},postModify:d}];for(let q=0;q<L.length;q++){const ne=L[q],J=ne.regex.exec(e);if(J){const E=J[ne.indices.bucket];let g=J[ne.indices.path];g||(g=""),r=new Ne(E,g),ne.postModify(r);break}}if(r==null)throw oy(e);return r}}class ly{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function uy(n,e,t){let r=1,s=null,i=null,a=!1,c=0;function u(){return c===2}let d=!1;function f(...C){d||(d=!0,e.apply(null,C))}function m(C){s=setTimeout(()=>{s=null,n(b,u())},C)}function _(){i&&clearTimeout(i)}function b(C,...D){if(d){_();return}if(C){_(),f.call(null,C,...D);return}if(u()||a){_(),f.call(null,C,...D);return}r<64&&(r*=2);let L;c===1?(c=2,L=0):L=(r+Math.random())*1e3,m(L)}let S=!1;function k(C){S||(S=!0,_(),!d&&(s!==null?(C||(c=2),clearTimeout(s),m(0)):C||(c=1)))}return m(0),i=setTimeout(()=>{a=!0,k(!0)},t),k}function hy(n){n(!1)}function dy(n){return n!==void 0}function rl(n,e,t,r){if(r<e)throw nl(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw nl(`Invalid value for '${n}'. Expected ${t} or less.`)}function fy(n){const e=encodeURIComponent;let t="?";for(const r in n)if(n.hasOwnProperty(r)){const s=e(r)+"="+e(n[r]);t=t+s+"&"}return t=t.slice(0,-1),t}var vs;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(vs||(vs={}));function py(n,e){const t=n>=500&&n<600,s=[408,429].indexOf(n)!==-1,i=e.indexOf(n)!==-1;return t||s||i}class my{constructor(e,t,r,s,i,a,c,u,d,f,m,_=!0,b=!1){this.url_=e,this.method_=t,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=a,this.callback_=c,this.errorCallback_=u,this.timeout_=d,this.progressCallback_=f,this.connectionFactory_=m,this.retry=_,this.isUsingEmulator=b,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((S,k)=>{this.resolve_=S,this.reject_=k,this.start_()})}start_(){const e=(r,s)=>{if(s){r(!1,new Hr(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const a=c=>{const u=c.loaded,d=c.lengthComputable?c.total:-1;this.progressCallback_!==null&&this.progressCallback_(u,d)};this.progressCallback_!==null&&i.addUploadProgressListener(a),i.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(a),this.pendingConnection_=null;const c=i.getErrorCode()===vs.NO_ERROR,u=i.getStatus();if(!c||py(u,this.additionalRetryCodes_)&&this.retry){const f=i.getErrorCode()===vs.ABORT;r(!1,new Hr(!1,null,f));return}const d=this.successCodes_.indexOf(u)!==-1;r(!0,new Hr(d,i))})},t=(r,s)=>{const i=this.resolve_,a=this.reject_,c=s.connection;if(s.wasSuccessCode)try{const u=this.callback_(c,c.getResponse());dy(u)?i(u):i()}catch(u){a(u)}else if(c!==null){const u=ry();u.serverResponse=c.getErrorText(),this.errorCallback_?a(this.errorCallback_(c,u)):a(u)}else if(s.canceled){const u=this.appDelete_?_h():iy();a(u)}else{const u=sy();a(u)}};this.canceled_?t(!1,new Hr(!1,null,!0)):this.backoffId_=uy(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&hy(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Hr{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function gy(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function _y(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function yy(n,e){e&&(n["X-Firebase-GMPID"]=e)}function vy(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function Ey(n,e,t,r,s,i,a=!0,c=!1){const u=fy(n.urlParams),d=n.url+u,f=Object.assign({},n.headers);return yy(f,e),gy(f,t),_y(f,i),vy(f,r),new my(d,n.method,f,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,s,a,c)}function Ty(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function Iy(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}class Es{constructor(e,t){this._service=e,t instanceof Ne?this._location=t:this._location=Ne.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Es(e,t)}get root(){const e=new Ne(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Iy(this._location.path)}get storage(){return this._service}get parent(){const e=Ty(this._location.path);if(e===null)return null;const t=new Ne(this._location.bucket,e);return new Es(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw cy(e)}}function sl(n,e){const t=e?.[ey];return t==null?null:Ne.makeFromBucketSpec(t,n)}function wy(n,e,t,r={}){n.host=`${e}:${t}`;const s=Ht(e);s&&(to(`https://${n.host}/b`),no("Storage",!0)),n._isUsingEmulator=!0,n._protocol=s?"https":"http";const{mockUserToken:i}=r;i&&(n._overrideAuthToken=typeof i=="string"?i:Ol(i,n.app.options.projectId))}class Ay{constructor(e,t,r,s,i,a=!1){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._isUsingEmulator=a,this._bucket=null,this._host=gh,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=ty,this._maxUploadRetryTime=ny,this._requests=new Set,s!=null?this._bucket=Ne.makeFromBucketSpec(s,this._host):this._bucket=sl(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Ne.makeFromBucketSpec(this._url,e):this._bucket=sl(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){rl("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){rl("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(Se(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Es(this,e)}_makeRequest(e,t,r,s,i=!0){if(this._deleted)return new ly(_h());{const a=Ey(e,this._appId,r,s,t,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(a),a.getPromise().then(()=>this._requests.delete(a),()=>this._requests.delete(a)),a}}async makeRequestWithTokens(e,t){const[r,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,s).getPromise()}}const il="@firebase/storage",ol="0.14.0";const yh="storage";function by(n=io(),e){n=we(n);const r=Cs(n,yh).getImmediate({identifier:e}),s=Vl("storage");return s&&Ry(r,...s),r}function Ry(n,e,t,r={}){wy(n,e,t,r)}function Sy(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),s=n.getProvider("app-check-internal");return new Ay(t,r,s,e,Gt)}function Cy(){Bt(new Tt(yh,Sy,"PUBLIC").setMultipleInstances(!0)),Ue(il,ol,""),Ue(il,ol,"esm2020")}Cy();function vh(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Py=vh,Eh=new hr("auth","Firebase",vh());const Ts=new ro("@firebase/auth");function ky(n,...e){Ts.logLevel<=H.WARN&&Ts.warn(`Auth (${Gt}): ${n}`,...e)}function ts(n,...e){Ts.logLevel<=H.ERROR&&Ts.error(`Auth (${Gt}): ${n}`,...e)}function xe(n,...e){throw Mo(n,...e)}function ze(n,...e){return Mo(n,...e)}function Th(n,e,t){const r={...Py(),[e]:t};return new hr("auth","Firebase",r).create(e,{appName:n.name})}function Ze(n){return Th(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Mo(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Eh.create(n,...e)}function U(n,e,...t){if(!n)throw Mo(e,...t)}function Je(n){const e="INTERNAL ASSERTION FAILED: "+n;throw ts(e),new Error(e)}function rt(n,e){n||Je(e)}function Yi(){return typeof self<"u"&&self.location?.href||""}function Ny(){return al()==="http:"||al()==="https:"}function al(){return typeof self<"u"&&self.location?.protocol||null}function Dy(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Ny()||tf()||"connection"in navigator)?navigator.onLine:!0}function Vy(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class yr{constructor(e,t){this.shortDelay=e,this.longDelay=t,rt(t>e,"Short delay should be less than long delay!"),this.isMobile=Xd()||nf()}get(){return Dy()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Fo(n,e){rt(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class Ih{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Je("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Je("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Je("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const xy={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const Ly=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Oy=new yr(3e4,6e4);function Ct(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Pt(n,e,t,r,s={}){return wh(n,s,async()=>{let i={},a={};r&&(e==="GET"?a=r:i={body:JSON.stringify(r)});const c=dr({key:n.config.apiKey,...a}).slice(1),u=await n._getAdditionalHeaders();u["Content-Type"]="application/json",n.languageCode&&(u["X-Firebase-Locale"]=n.languageCode);const d={method:e,headers:u,...i};return ef()||(d.referrerPolicy="no-referrer"),n.emulatorConfig&&Ht(n.emulatorConfig.host)&&(d.credentials="include"),Ih.fetch()(await Ah(n,n.config.apiHost,t,c),d)})}async function wh(n,e,t){n._canInitEmulator=!1;const r={...xy,...e};try{const s=new Fy(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw Gr(n,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const c=i.ok?a.errorMessage:a.error.message,[u,d]=c.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw Gr(n,"credential-already-in-use",a);if(u==="EMAIL_EXISTS")throw Gr(n,"email-already-in-use",a);if(u==="USER_DISABLED")throw Gr(n,"user-disabled",a);const f=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Th(n,f,d);xe(n,f)}}catch(s){if(s instanceof Ke)throw s;xe(n,"network-request-failed",{message:String(s)})}}async function vr(n,e,t,r,s={}){const i=await Pt(n,e,t,r,s);return"mfaPendingCredential"in i&&xe(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function Ah(n,e,t,r){const s=`${e}${t}?${r}`,i=n,a=i.config.emulator?Fo(n.config,s):`${n.config.apiScheme}://${s}`;return Ly.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(a).toString():a}function My(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Fy{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(ze(this.auth,"network-request-failed")),Oy.get())})}}function Gr(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=ze(n,e,r);return s.customData._tokenResponse=t,s}function cl(n){return n!==void 0&&n.enterprise!==void 0}class Uy{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return My(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function By(n,e){return Pt(n,"GET","/v2/recaptchaConfig",Ct(n,e))}async function $y(n,e){return Pt(n,"POST","/v1/accounts:delete",e)}async function Is(n,e){return Pt(n,"POST","/v1/accounts:lookup",e)}function er(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function jy(n,e=!1){const t=we(n),r=await t.getIdToken(e),s=Uo(r);U(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i?.sign_in_provider;return{claims:s,token:r,authTime:er(Si(s.auth_time)),issuedAtTime:er(Si(s.iat)),expirationTime:er(Si(s.exp)),signInProvider:a||null,signInSecondFactor:i?.sign_in_second_factor||null}}function Si(n){return Number(n)*1e3}function Uo(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return ts("JWT malformed, contained fewer than 3 sections"),null;try{const s=Nl(t);return s?JSON.parse(s):(ts("Failed to decode base64 JWT payload"),null)}catch(s){return ts("Caught error parsing JWT payload as JSON",s?.toString()),null}}function ll(n){const e=Uo(n);return U(e,"internal-error"),U(typeof e.exp<"u","internal-error"),U(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function lr(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Ke&&zy(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function zy({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class qy{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class Xi{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=er(this.lastLoginAt),this.creationTime=er(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ws(n){const e=n.auth,t=await n.getIdToken(),r=await lr(n,Is(e,{idToken:t}));U(r?.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=s.providerUserInfo?.length?bh(s.providerUserInfo):[],a=Gy(n.providerData,i),c=n.isAnonymous,u=!(n.email&&s.passwordHash)&&!a?.length,d=c?u:!1,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Xi(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(n,f)}async function Hy(n){const e=we(n);await ws(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Gy(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function bh(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function Wy(n,e){const t=await wh(n,{},async()=>{const r=dr({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,a=await Ah(n,s,"/v1/token",`key=${i}`),c=await n._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";const u={method:"POST",headers:c,body:r};return n.emulatorConfig&&Ht(n.emulatorConfig.host)&&(u.credentials="include"),Ih.fetch()(a,u)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Ky(n,e){return Pt(n,"POST","/v2/accounts:revokeToken",Ct(n,e))}class hn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){U(e.idToken,"internal-error"),U(typeof e.idToken<"u","internal-error"),U(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):ll(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){U(e.length!==0,"internal-error");const t=ll(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(U(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await Wy(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,a=new hn;return r&&(U(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(U(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&(U(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new hn,this.toJSON())}_performRefresh(){return Je("not implemented")}}function ut(n,e){U(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class De{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new qy(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Xi(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await lr(this,this.stsTokenManager.getToken(this.auth,e));return U(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return jy(this,e)}reload(){return Hy(this)}_assign(e){this!==e&&(U(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new De({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){U(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await ws(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Se(this.auth.app))return Promise.reject(Ze(this.auth));const e=await this.getIdToken();return await lr(this,$y(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,a=t.photoURL??void 0,c=t.tenantId??void 0,u=t._redirectEventId??void 0,d=t.createdAt??void 0,f=t.lastLoginAt??void 0,{uid:m,emailVerified:_,isAnonymous:b,providerData:S,stsTokenManager:k}=t;U(m&&k,e,"internal-error");const C=hn.fromJSON(this.name,k);U(typeof m=="string",e,"internal-error"),ut(r,e.name),ut(s,e.name),U(typeof _=="boolean",e,"internal-error"),U(typeof b=="boolean",e,"internal-error"),ut(i,e.name),ut(a,e.name),ut(c,e.name),ut(u,e.name),ut(d,e.name),ut(f,e.name);const D=new De({uid:m,auth:e,email:s,emailVerified:_,displayName:r,isAnonymous:b,photoURL:a,phoneNumber:i,tenantId:c,stsTokenManager:C,createdAt:d,lastLoginAt:f});return S&&Array.isArray(S)&&(D.providerData=S.map(F=>({...F}))),u&&(D._redirectEventId=u),D}static async _fromIdTokenResponse(e,t,r=!1){const s=new hn;s.updateFromServerResponse(t);const i=new De({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await ws(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];U(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?bh(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!i?.length,c=new hn;c.updateFromIdToken(r);const u=new De({uid:s.localId,auth:e,stsTokenManager:c,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Xi(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!i?.length};return Object.assign(u,d),u}}const ul=new Map;function Ye(n){rt(n instanceof Function,"Expected a class definition");let e=ul.get(n);return e?(rt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,ul.set(n,e),e)}class Rh{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Rh.type="NONE";const hl=Rh;function ns(n,e,t){return`firebase:${n}:${e}:${t}`}class dn{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=ns(this.userKey,s.apiKey,i),this.fullPersistenceKey=ns("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Is(this.auth,{idToken:e}).catch(()=>{});return t?De._fromGetAccountInfoResponse(this.auth,t,e):null}return De._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new dn(Ye(hl),e,r);const s=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||Ye(hl);const a=ns(r,e.config.apiKey,e.name);let c=null;for(const d of t)try{const f=await d._get(a);if(f){let m;if(typeof f=="string"){const _=await Is(e,{idToken:f}).catch(()=>{});if(!_)break;m=await De._fromGetAccountInfoResponse(e,_,f)}else m=De._fromJSON(e,f);d!==i&&(c=m),i=d;break}}catch{}const u=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!u.length?new dn(i,e,r):(i=u[0],c&&await i._set(a,c.toJSON()),await Promise.all(t.map(async d=>{if(d!==i)try{await d._remove(a)}catch{}})),new dn(i,e,r))}}function dl(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(kh(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Sh(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Dh(e))return"Blackberry";if(Vh(e))return"Webos";if(Ch(e))return"Safari";if((e.includes("chrome/")||Ph(e))&&!e.includes("edge/"))return"Chrome";if(Nh(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function Sh(n=Ee()){return/firefox\//i.test(n)}function Ch(n=Ee()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Ph(n=Ee()){return/crios\//i.test(n)}function kh(n=Ee()){return/iemobile/i.test(n)}function Nh(n=Ee()){return/android/i.test(n)}function Dh(n=Ee()){return/blackberry/i.test(n)}function Vh(n=Ee()){return/webos/i.test(n)}function Bo(n=Ee()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Qy(n=Ee()){return Bo(n)&&!!window.navigator?.standalone}function Jy(){return rf()&&document.documentMode===10}function xh(n=Ee()){return Bo(n)||Nh(n)||Vh(n)||Dh(n)||/windows phone/i.test(n)||kh(n)}function Lh(n,e=[]){let t;switch(n){case"Browser":t=dl(Ee());break;case"Worker":t=`${dl(Ee())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Gt}/${r}`}class Yy{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((a,c)=>{try{const u=e(i);a(u)}catch(u){c(u)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function Xy(n,e={}){return Pt(n,"GET","/v2/passwordPolicy",Ct(n,e))}const Zy=6;class ev{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??Zy,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class tv{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new fl(this),this.idTokenSubscription=new fl(this),this.beforeStateQueue=new Yy(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Eh,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ye(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await dn.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Is(this,{idToken:e}),r=await De._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Se(this.app)){const i=this.app.settings.authIdToken;return i?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(i).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const i=this.redirectUser?._redirectEventId,a=r?._redirectEventId,c=await this.tryRedirectSignIn(e);(!i||i===a)&&c?.user&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(i){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(i))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return U(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ws(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Vy()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Se(this.app))return Promise.reject(Ze(this));const t=e?we(e):null;return t&&U(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&U(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Se(this.app)?Promise.reject(Ze(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Se(this.app)?Promise.reject(Ze(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ye(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Xy(this),t=new ev(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new hr("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await Ky(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ye(e)||this._popupRedirectResolver;U(t,this,"argument-error"),this.redirectPersistenceManager=await dn.create(this,[Ye(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let a=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(U(c,this,"internal-error"),c.then(()=>{a||i(this.currentUser)}),typeof t=="function"){const u=e.addObserver(t,r,s);return()=>{a=!0,u()}}else{const u=e.addObserver(t);return()=>{a=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return U(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Lh(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(Se(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&ky(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Yt(n){return we(n)}class fl{constructor(e){this.auth=e,this.observer=null,this.addObserver=df(t=>this.observer=t)}get next(){return U(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let zs={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function nv(n){zs=n}function Oh(n){return zs.loadJS(n)}function rv(){return zs.recaptchaEnterpriseScript}function sv(){return zs.gapiScript}function iv(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class ov{constructor(){this.enterprise=new av}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class av{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const cv="recaptcha-enterprise",Mh="NO_RECAPTCHA";class lv{constructor(e){this.type=cv,this.auth=Yt(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(a,c)=>{By(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{const d=new Uy(u);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,a(d.siteKey)}}).catch(u=>{c(u)})})}function s(i,a,c){const u=window.grecaptcha;cl(u)?u.enterprise.ready(()=>{u.enterprise.execute(i,{action:e}).then(d=>{a(d)}).catch(()=>{a(Mh)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new ov().execute("siteKey",{action:"verify"}):new Promise((i,a)=>{r(this.auth).then(c=>{if(!t&&cl(window.grecaptcha))s(c,i,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let u=rv();u.length!==0&&(u+=c),Oh(u).then(()=>{s(c,i,a)}).catch(d=>{a(d)})}}).catch(c=>{a(c)})})}}async function pl(n,e,t,r=!1,s=!1){const i=new lv(n);let a;if(s)a=Mh;else try{a=await i.verify(t)}catch{a=await i.verify(t,!0)}const c={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in c){const u=c.phoneEnrollmentInfo.phoneNumber,d=c.phoneEnrollmentInfo.recaptchaToken;Object.assign(c,{phoneEnrollmentInfo:{phoneNumber:u,recaptchaToken:d,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in c){const u=c.phoneSignInInfo.recaptchaToken;Object.assign(c,{phoneSignInInfo:{recaptchaToken:u,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return c}return r?Object.assign(c,{captchaResp:a}):Object.assign(c,{captchaResponse:a}),Object.assign(c,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(c,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),c}async function Zi(n,e,t,r,s){if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await pl(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await pl(n,e,t,t==="getOobCode");return r(n,a)}else return Promise.reject(i)})}function uv(n,e){const t=Cs(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Ut(i,e??{}))return s;xe(s,"already-initialized")}return t.initialize({options:e})}function hv(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(Ye);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function dv(n,e,t){const r=Yt(n);U(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=Fh(e),{host:a,port:c}=fv(e),u=c===null?"":`:${c}`,d={url:`${i}//${a}${u}/`},f=Object.freeze({host:a,port:c,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){U(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),U(Ut(d,r.config.emulator)&&Ut(f,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=f,r.settings.appVerificationDisabledForTesting=!0,Ht(a)?(to(`${i}//${a}${u}`),no("Auth",!0)):pv()}function Fh(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function fv(n){const e=Fh(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:ml(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:ml(a)}}}function ml(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function pv(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class $o{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Je("not implemented")}_getIdTokenResponse(e){return Je("not implemented")}_linkToIdToken(e,t){return Je("not implemented")}_getReauthenticationResolver(e){return Je("not implemented")}}async function mv(n,e){return Pt(n,"POST","/v1/accounts:signUp",e)}async function gv(n,e){return vr(n,"POST","/v1/accounts:signInWithPassword",Ct(n,e))}async function _v(n,e){return vr(n,"POST","/v1/accounts:signInWithEmailLink",Ct(n,e))}async function yv(n,e){return vr(n,"POST","/v1/accounts:signInWithEmailLink",Ct(n,e))}class ur extends $o{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new ur(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new ur(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Zi(e,t,"signInWithPassword",gv);case"emailLink":return _v(e,{email:this._email,oobCode:this._password});default:xe(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Zi(e,r,"signUpPassword",mv);case"emailLink":return yv(e,{idToken:t,email:this._email,oobCode:this._password});default:xe(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function fn(n,e){return vr(n,"POST","/v1/accounts:signInWithIdp",Ct(n,e))}const vv="http://localhost";class zt extends $o{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new zt(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):xe("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const a=new zt(r,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return fn(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,fn(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,fn(e,t)}buildRequest(){const e={requestUri:vv,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=dr(t)}return e}}function Ev(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Tv(n){const e=jn(zn(n)).link,t=e?jn(zn(e)).deep_link_id:null,r=jn(zn(n)).deep_link_id;return(r?jn(zn(r)).link:null)||r||t||e||n}class jo{constructor(e){const t=jn(zn(e)),r=t.apiKey??null,s=t.oobCode??null,i=Ev(t.mode??null);U(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=Tv(e);try{return new jo(t)}catch{return null}}}class An{constructor(){this.providerId=An.PROVIDER_ID}static credential(e,t){return ur._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=jo.parseLink(t);return U(r,"argument-error"),ur._fromEmailAndCode(e,r.code,r.tenantId)}}An.PROVIDER_ID="password";An.EMAIL_PASSWORD_SIGN_IN_METHOD="password";An.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Uh{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Er extends Uh{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class ht extends Er{constructor(){super("facebook.com")}static credential(e){return zt._fromParams({providerId:ht.PROVIDER_ID,signInMethod:ht.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ht.credentialFromTaggedObject(e)}static credentialFromError(e){return ht.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ht.credential(e.oauthAccessToken)}catch{return null}}}ht.FACEBOOK_SIGN_IN_METHOD="facebook.com";ht.PROVIDER_ID="facebook.com";class dt extends Er{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return zt._fromParams({providerId:dt.PROVIDER_ID,signInMethod:dt.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return dt.credentialFromTaggedObject(e)}static credentialFromError(e){return dt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return dt.credential(t,r)}catch{return null}}}dt.GOOGLE_SIGN_IN_METHOD="google.com";dt.PROVIDER_ID="google.com";class ft extends Er{constructor(){super("github.com")}static credential(e){return zt._fromParams({providerId:ft.PROVIDER_ID,signInMethod:ft.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ft.credentialFromTaggedObject(e)}static credentialFromError(e){return ft.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ft.credential(e.oauthAccessToken)}catch{return null}}}ft.GITHUB_SIGN_IN_METHOD="github.com";ft.PROVIDER_ID="github.com";class pt extends Er{constructor(){super("twitter.com")}static credential(e,t){return zt._fromParams({providerId:pt.PROVIDER_ID,signInMethod:pt.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return pt.credentialFromTaggedObject(e)}static credentialFromError(e){return pt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return pt.credential(t,r)}catch{return null}}}pt.TWITTER_SIGN_IN_METHOD="twitter.com";pt.PROVIDER_ID="twitter.com";async function Iv(n,e){return vr(n,"POST","/v1/accounts:signUp",Ct(n,e))}class qt{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await De._fromIdTokenResponse(e,r,s),a=gl(r);return new qt({user:i,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=gl(r);return new qt({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function gl(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class As extends Ke{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,As.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new As(e,t,r,s)}}function Bh(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?As._fromErrorAndOperation(n,i,e,r):i})}async function wv(n,e,t=!1){const r=await lr(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return qt._forOperation(n,"link",r)}async function Av(n,e,t=!1){const{auth:r}=n;if(Se(r.app))return Promise.reject(Ze(r));const s="reauthenticate";try{const i=await lr(n,Bh(r,s,e,n),t);U(i.idToken,r,"internal-error");const a=Uo(i.idToken);U(a,r,"internal-error");const{sub:c}=a;return U(n.uid===c,r,"user-mismatch"),qt._forOperation(n,s,i)}catch(i){throw i?.code==="auth/user-not-found"&&xe(r,"user-mismatch"),i}}async function $h(n,e,t=!1){if(Se(n.app))return Promise.reject(Ze(n));const r="signIn",s=await Bh(n,r,e),i=await qt._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function bv(n,e){return $h(Yt(n),e)}async function jh(n){const e=Yt(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Rv(n,e,t){if(Se(n.app))return Promise.reject(Ze(n));const r=Yt(n),a=await Zi(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Iv).catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&jh(n),u}),c=await qt._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(c.user),c}function Sv(n,e,t){return Se(n.app)?Promise.reject(Ze(n)):bv(we(n),An.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&jh(n),r})}function Cv(n,e,t,r){return we(n).onIdTokenChanged(e,t,r)}function Pv(n,e,t){return we(n).beforeAuthStateChanged(e,t)}function kv(n,e,t,r){return we(n).onAuthStateChanged(e,t,r)}function Nv(n){return we(n).signOut()}const bs="__sak";class zh{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(bs,"1"),this.storage.removeItem(bs),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const Dv=1e3,Vv=10;class qh extends zh{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=xh(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,c,u)=>{this.notifyListeners(a,u)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);Jy()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Vv):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},Dv)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}qh.type="LOCAL";const xv=qh;class Hh extends zh{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Hh.type="SESSION";const Gh=Hh;function Lv(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class qs{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new qs(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,a=this.handlersMap[s];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const c=Array.from(a).map(async d=>d(t.origin,i)),u=await Lv(c);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:u})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}qs.receivers=[];function zo(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}class Ov{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((c,u)=>{const d=zo("",20);s.port1.start();const f=setTimeout(()=>{u(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(m){const _=m;if(_.data.eventId===d)switch(_.data.status){case"ack":clearTimeout(f),i=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),c(_.data.response);break;default:clearTimeout(f),clearTimeout(i),u(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function qe(){return window}function Mv(n){qe().location.href=n}function Wh(){return typeof qe().WorkerGlobalScope<"u"&&typeof qe().importScripts=="function"}async function Fv(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Uv(){return navigator?.serviceWorker?.controller||null}function Bv(){return Wh()?self:null}const Kh="firebaseLocalStorageDb",$v=1,Rs="firebaseLocalStorage",Qh="fbase_key";class Tr{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Hs(n,e){return n.transaction([Rs],e?"readwrite":"readonly").objectStore(Rs)}function jv(){const n=indexedDB.deleteDatabase(Kh);return new Tr(n).toPromise()}function eo(){const n=indexedDB.open(Kh,$v);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Rs,{keyPath:Qh})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Rs)?e(r):(r.close(),await jv(),e(await eo()))})})}async function _l(n,e,t){const r=Hs(n,!0).put({[Qh]:e,value:t});return new Tr(r).toPromise()}async function zv(n,e){const t=Hs(n,!1).get(e),r=await new Tr(t).toPromise();return r===void 0?null:r.value}function yl(n,e){const t=Hs(n,!0).delete(e);return new Tr(t).toPromise()}const qv=800,Hv=3;class Jh{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await eo(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>Hv)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Wh()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=qs._getInstance(Bv()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await Fv(),!this.activeServiceWorker)return;this.sender=new Ov(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Uv()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await eo();return await _l(e,bs,"1"),await yl(e,bs),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>_l(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>zv(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>yl(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Hs(s,!1).getAll();return new Tr(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),qv)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Jh.type="LOCAL";const Gv=Jh;new yr(3e4,6e4);function Wv(n,e){return e?Ye(e):(U(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class qo extends $o{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return fn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return fn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return fn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Kv(n){return $h(n.auth,new qo(n),n.bypassAuthState)}function Qv(n){const{auth:e,user:t}=n;return U(t,e,"internal-error"),Av(t,new qo(n),n.bypassAuthState)}async function Jv(n){const{auth:e,user:t}=n;return U(t,e,"internal-error"),wv(t,new qo(n),n.bypassAuthState)}class Yh{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:a,type:c}=e;if(a){this.reject(a);return}const u={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(u))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Kv;case"linkViaPopup":case"linkViaRedirect":return Jv;case"reauthViaPopup":case"reauthViaRedirect":return Qv;default:xe(this.auth,"internal-error")}}resolve(e){rt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){rt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Yv=new yr(2e3,1e4);class on extends Yh{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,on.currentPopupAction&&on.currentPopupAction.cancel(),on.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return U(e,this.auth,"internal-error"),e}async onExecution(){rt(this.filter.length===1,"Popup operations only handle one event");const e=zo();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(ze(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(ze(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,on.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ze(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Yv.get())};e()}}on.currentPopupAction=null;const Xv="pendingRedirect",rs=new Map;class Zv extends Yh{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=rs.get(this.auth._key());if(!e){try{const r=await eE(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}rs.set(this.auth._key(),e)}return this.bypassAuthState||rs.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function eE(n,e){const t=rE(e),r=nE(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function tE(n,e){rs.set(n._key(),e)}function nE(n){return Ye(n._redirectPersistence)}function rE(n){return ns(Xv,n.config.apiKey,n.name)}async function sE(n,e,t=!1){if(Se(n.app))return Promise.reject(Ze(n));const r=Yt(n),s=Wv(r,e),a=await new Zv(r,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}const iE=600*1e3;class oE{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!aE(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!Xh(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(ze(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=iE&&this.cachedEventUids.clear(),this.cachedEventUids.has(vl(e))}saveEventToCache(e){this.cachedEventUids.add(vl(e)),this.lastProcessedEventTime=Date.now()}}function vl(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Xh({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function aE(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Xh(n);default:return!1}}async function cE(n,e={}){return Pt(n,"GET","/v1/projects",e)}const lE=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,uE=/^https?/;async function hE(n){if(n.config.emulator)return;const{authorizedDomains:e}=await cE(n);for(const t of e)try{if(dE(t))return}catch{}xe(n,"unauthorized-domain")}function dE(n){const e=Yi(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!uE.test(t))return!1;if(lE.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const fE=new yr(3e4,6e4);function El(){const n=qe().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function pE(n){return new Promise((e,t)=>{function r(){El(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{El(),t(ze(n,"network-request-failed"))},timeout:fE.get()})}if(qe().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(qe().gapi?.load)r();else{const s=iv("iframefcb");return qe()[s]=()=>{gapi.load?r():t(ze(n,"network-request-failed"))},Oh(`${sv()}?onload=${s}`).catch(i=>t(i))}}).catch(e=>{throw ss=null,e})}let ss=null;function mE(n){return ss=ss||pE(n),ss}const gE=new yr(5e3,15e3),_E="__/auth/iframe",yE="emulator/auth/iframe",vE={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},EE=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function TE(n){const e=n.config;U(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Fo(e,yE):`https://${n.config.authDomain}/${_E}`,r={apiKey:e.apiKey,appName:n.name,v:Gt},s=EE.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${dr(r).slice(1)}`}async function IE(n){const e=await mE(n),t=qe().gapi;return U(t,n,"internal-error"),e.open({where:document.body,url:TE(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:vE,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const a=ze(n,"network-request-failed"),c=qe().setTimeout(()=>{i(a)},gE.get());function u(){qe().clearTimeout(c),s(r)}r.ping(u).then(u,()=>{i(a)})}))}const wE={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},AE=500,bE=600,RE="_blank",SE="http://localhost";class Tl{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function CE(n,e,t,r=AE,s=bE){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let c="";const u={...wE,width:r.toString(),height:s.toString(),top:i,left:a},d=Ee().toLowerCase();t&&(c=Ph(d)?RE:t),Sh(d)&&(e=e||SE,u.scrollbars="yes");const f=Object.entries(u).reduce((_,[b,S])=>`${_}${b}=${S},`,"");if(Qy(d)&&c!=="_self")return PE(e||"",c),new Tl(null);const m=window.open(e||"",c,f);U(m,n,"popup-blocked");try{m.focus()}catch{}return new Tl(m)}function PE(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}const kE="__/auth/handler",NE="emulator/auth/handler",DE=encodeURIComponent("fac");async function Il(n,e,t,r,s,i){U(n.config.authDomain,n,"auth-domain-config-required"),U(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Gt,eventId:s};if(e instanceof Uh){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",hf(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[f,m]of Object.entries({}))a[f]=m}if(e instanceof Er){const f=e.getScopes().filter(m=>m!=="");f.length>0&&(a.scopes=f.join(","))}n.tenantId&&(a.tid=n.tenantId);const c=a;for(const f of Object.keys(c))c[f]===void 0&&delete c[f];const u=await n._getAppCheckToken(),d=u?`#${DE}=${encodeURIComponent(u)}`:"";return`${VE(n)}?${dr(c).slice(1)}${d}`}function VE({config:n}){return n.emulator?Fo(n,NE):`https://${n.authDomain}/${kE}`}const Ci="webStorageSupport";class xE{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Gh,this._completeRedirectFn=sE,this._overrideRedirectResult=tE}async _openPopup(e,t,r,s){rt(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const i=await Il(e,t,r,Yi(),s);return CE(e,i,zo())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await Il(e,t,r,Yi(),s);return Mv(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(rt(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await IE(e),r=new oE(e);return t.register("authEvent",s=>(U(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Ci,{type:Ci},s=>{const i=s?.[0]?.[Ci];i!==void 0&&t(!!i),xe(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=hE(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return xh()||Ch()||Bo()}}const LE=xE;var wl="@firebase/auth",Al="1.12.0";class OE{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){U(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function ME(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function FE(n){Bt(new Tt("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:c}=r.options;U(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const u={apiKey:a,authDomain:c,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Lh(n)},d=new tv(r,s,i,u);return hv(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Bt(new Tt("auth-internal",e=>{const t=Yt(e.getProvider("auth").getImmediate());return(r=>new OE(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ue(wl,Al,ME(n)),Ue(wl,Al,"esm2020")}const UE=300,BE=Ll("authIdTokenMaxAge")||UE;let bl=null;const $E=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>BE)return;const s=t?.token;bl!==s&&(bl=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function jE(n=io()){const e=Cs(n,"auth");if(e.isInitialized())return e.getImmediate();const t=uv(n,{popupRedirectResolver:LE,persistence:[Gv,xv,Gh]}),r=Ll("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=$E(i.toString());Pv(t,a,()=>a(t.currentUser)),Cv(t,c=>a(c))}}const s=Dl("auth");return s&&dv(t,`http://${s}`),t}function zE(){return document.getElementsByTagName("head")?.[0]??document}nv({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=ze("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",zE().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});FE("Browser");const qE={apiKey:"AIzaSyA7BFx5LSV3Ef-QVO00JlRhd_KCn7_AgbE",authDomain:"faces-10726.firebaseapp.com",projectId:"faces-10726",storageBucket:"faces-10726.firebasestorage.app",messagingSenderId:"3446816182",appId:"1:3446816182:web:1e9eb44f691bb6f7599517"},Ho=Ul(qE),Kn=L_(Ho);by(Ho);const Wr=jE(Ho);async function HE(){console.log("DATA_LOADER:  Starting Cloud Data Load (Firebase ONLY)...");let n={textures:[],facebases:[],avatar:[],music:[]};try{console.log("DATA_LOADER: Fetching from Firestore...");const[c,u,d,f]=await Promise.all([qr(Wn(Kn,"textures")),qr(Wn(Kn,"facebases")),qr(Wn(Kn,"avatar")),qr(Wn(Kn,"music"))]);c.empty&&u.empty&&d.empty&&console.warn("DATA_LOADER: Firestore is empty!"),c.forEach(m=>n.textures.push({...m.data(),id:m.id})),u.forEach(m=>n.facebases.push(m.data())),d.forEach(m=>n.avatar.push(m.data())),f.forEach(m=>n.music.push(m.data()))}catch(c){throw console.error("DATA_LOADER: CRITICAL ERROR - Could not load from Firebase.",c),c}console.log(`DATA_LOADER: Cloud load complete. Items: T:${n.textures.length} F:${n.facebases.length} A:${n.avatar.length}`);const e=(n.textures||[]).map(c=>({id:c.id||c.robloxId,group:c.type||c.category,displayName:c.fullName||c.name,codeId:c.robloxId,src:c.remoteUrl||Kr(c.robloxId),type:"texture",baseName:c.baseName||c.name})),t=(n.facebases||[]).map(c=>({id:c.id||c.robloxId,group:(c.category||c.group||"General").toUpperCase(),displayName:c.variant||c.name,codeId:c.robloxId,src:c.remoteUrl||Kr(c.robloxId),type:"facebase"})),r=(n.avatar||[]).map(c=>({id:c.id||c.robloxId,group:(c.category||"General").toUpperCase(),displayName:c.name,codeId:c.robloxId,src:c.remoteUrl||Kr(c.robloxId),type:"avatar"})),s=n.music||[],i=GE(t),a=e.map(c=>c.baseName);return console.log(`DATA_LOADER: Procesamiento completo. ${e.length} texturas, ${t.length} facebases.`),{allFacebaseItems:t,facebaseCategories:i,allAvatarItems:r,allTextureBasenames:a,allTextureItems:e,allMusicCodes:s,rawDb:n}}function GE(n){const e=new Set,t=new Set,r=["BRAZIL","UK","USA","ZAMBIA","IRELAND","ITALY","INDIA","BELGIUM","EGYPT","SPAIN","FRANCE","COSTA RICA","THAILAND","KOREA","JAPAN"];return n.forEach(s=>{const i=s.group;r.includes(i)?e.add(i):t.add(i)}),{countries:Array.from(e).map(s=>({name:s.charAt(0)+s.slice(1).toLowerCase(),iso:WE(s)})),others:Array.from(t).map(s=>({name:s.charAt(0)+s.slice(1).toLowerCase(),flag:`photos/app/${s.charAt(0)+s.slice(1).toLowerCase()}.webp`}))}}function WE(n){return{BRAZIL:"BR",UK:"GB",USA:"US",ZAMBIA:"ZM",IRELAND:"IE",ITALY:"IT",INDIA:"IN",BELGIUM:"BE",EGYPT:"EG",SPAIN:"ES",FRANCE:"FR","COSTA RICA":"CR",THAILAND:"TH",JAPAN:"JP",KOREA:"KR"}[n.toUpperCase()]||"XX"}const KE=n=>{const e=document.getElementById("facebase-category-filter");e&&(e.innerHTML='<option value="all">All Categories</option>',n.countries.forEach(t=>{const r=document.createElement("option");r.value=t.name,r.textContent=t.name,e.appendChild(r)}),n.others.forEach(t=>{const r=document.createElement("option");r.value=t.name,r.textContent=t.name,e.appendChild(r)}))};function Zh(n,e){const t=document.getElementById("gallery-container");if(!t)return;t.innerHTML="";const r=[...e.countries,...e.others].reduce((i,a)=>{const c=a.name.toUpperCase();return a.iso?i[c]={src:Cl(a.iso),name:a.name,isEmoji:!0}:a.flag&&(i[c]={src:a.flag,name:a.name,isEmoji:!1}),i},{});if(n.length===0){t.innerHTML='<p class="text-zinc-500 text-center col-span-full pt-4">No results found.</p>';return}const s=n.map(i=>{const a=i.defaultItem;if(!a)return"";const c=r[a.group];let u=`<span class="text-xs text-zinc-500">${a.group}</span>`,d=a.group;if(c){d=c.name;const k=`onmouseover="window.showFlagToast('${d}', event)" onmouseout="window.hideFlagToast()"`;c.isEmoji?u=`<span ${k} class="text-xl cursor-pointer flag-emoji">${c.src}</span>`:u=`<img src="${c.src}" alt="${d} flag" title="${d}" ${k} class="flag-aesthetic !h-5 !w-auto rounded shadow cursor-pointer">`}let f="";const m=i.variants.X,_=i.variants.S;(m||_)&&(f='<div class="variant-buttons">',m&&(f+=`<img src="photos/app/x.webp" class="variant-button" title="Ojos Cerrados" 
                    data-src="${m.src}" data-id="${m.id}" data-code-id="${m.codeId||""}">`),_&&(f+=`<img src="photos/app/s.webp" class="variant-button" title="Ojos de Lado" 
                    data-src="${_.src}" data-id="${_.id}" data-code-id="${_.codeId||""}">`),f+="</div>");const b=Object.values(i.variants).map(k=>k.id).filter(Boolean),S=JSON.stringify(b);return`
            <div class="music-card facebase-card bg-[#151722] rounded-xl shadow-xl ring-1 ring-[var(--border)] overflow-hidden flex flex-col p-1.5 space-y-1.5 !w-full relative"
                 data-default-src="${a.src}" 
                 data-default-id="${a.id}" 
                 data-default-code-id="${a.codeId||""}">
                
                <div class="favorite-container">
                    <button class="favorite-btn" 
                            data-id="${a.id}" 
                            data-variant-ids='${S}'
                            onclick="window.toggleFavorite('${a.id}', this)">
                        ${window.isFavorite(a.id)?"":""}
                    </button>
                    </div>
                
                <div class="text-xs text-zinc-200 font-medium px-1 h-8 flex items-center justify-start gap-1">
                    ${u}
                    <span class="truncate">${i.baseDisplayName}</span> </div>
                
                <div class="relative">
                    <img src="${a.src}" alt="${i.baseDisplayName}" loading="lazy" class="w-full h-auto object-cover aspect-square rounded-md facebase-main-img"> ${f} </div>

                <div class="flex items-center gap-1.5 p-1">
                    <input readonly type="text" value="${a.codeId||""}" placeholder="" class="flex-grow w-0 h-8 px-2 text-xs dark-input rounded-md">
                    <button class="copy-btn flex-shrink-0 w-8 h-8 flex items-center justify-center bg-[#1b1d24] text-zinc-200 rounded-md border border-[var(--border)] hover:bg-[#222533] transition">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/></svg>
                    </button>
                </div>
            </div>
        `}).join("");t.innerHTML=s}function QE(n){const e=document.getElementById("avatar-category-filter");if(!e)return;const t=[...new Set(n.map(r=>r.group))].filter(Boolean);e.innerHTML='<option value="all">All Categories</option>',t.sort().forEach(r=>{const s=document.createElement("option");s.value=r,s.textContent=r.charAt(0).toUpperCase()+r.slice(1).toLowerCase(),e.appendChild(s)})}function ed(n){const e=document.getElementById("avatar-gallery-container");if(!e)return;if(e.innerHTML="",n.length===0){e.innerHTML='<p class="text-zinc-500 text-center col-span-full">No results found.</p>';return}const t=n.map(r=>`
            <div class="music-card facebase-card bg-[#151722] rounded-xl shadow-xl ring-1 ring-[var(--border)] overflow-hidden flex flex-col p-1.5 space-y-1.5 !w-full relative">
                <div class="favorite-container">
                    <button class="favorite-btn" data-id="${r.id}" onclick="window.toggleFavorite('${r.id}', this)">
                        ${window.isFavorite(r.id)?"":""}
                    </button>
                </div>
                <div class="text-xs text-zinc-200 font-medium px-1 text-center h-8 flex items-center justify-start gap-1">${r.displayName} (${r.group})</div>
                <img src="${r.src}" alt="${r.displayName}" loading="lazy" class="w-full h-auto object-cover aspect-square rounded-md">
                <div class="flex items-center gap-1.5 p-1">
                    <input readonly type="text" value="${r.codeId||""}" placeholder="" class="flex-grow w-0 h-8 px-2 text-xs dark-input rounded-md">
                    <button class="copy-btn flex-shrink-0 w-8 h-8 flex items-center justify-center bg-[#1b1d24] text-zinc-200 rounded-md border border-[var(--border)] hover:bg-[#222533] transition">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/></svg>
                    </button>
                </div>
            </div>
    `).join("");e.innerHTML=t}function JE(n){const e={};return n.forEach(t=>{if(typeof t=="string")return;let r=t.baseName;if(!r){const a=t.displayName.split(" ");a.length>1&&a.pop(),r=a.join(" ")}const i=(t.group==="S"||t.group==="T"?"ST-":t.group+"-")+r;e[i]?e[i].variants.push(t):e[i]={group:t.group,baseName:r,mainVariant:t,variants:[t]}}),Object.values(e)}function YE(n){const e=document.getElementById("texture-category-filter");if(!e)return;const t=new Set;n.forEach(i=>{i&&i.variants&&i.variants.forEach(a=>{a&&a.group&&t.add(a.group)})});const r=[...t].filter(Boolean);e.innerHTML='<option value="all">All Categories</option>';const s={M:"Mesh (M)",T:"Translucid (T)",S:"Solid (S)"};r.sort().forEach(i=>{const a=document.createElement("option");a.value=i,a.textContent=s[i]||i,e.appendChild(a)})}const td=n=>{const t={M:{src:"photos/app/Mesh.webp",name:"Mesh"},T:{src:"photos/app/trlcd.webp",name:"Translucid"},S:{src:"photos/app/solid.webp",name:"Solid"}}[n.toUpperCase()]||null;if(t){const r=`${t.name} (${n})`,s=`Icono de textura ${t.name}`,i=document.createElement("img");return i.src=t.src,i.alt=s,i.title=r,i.className="texture-type-icon",i.onerror=function(){const a=document.createElement("span");a.className="text-xs font-semibold px-2 py-0.5 rounded-full bg-zinc-700 text-zinc-300",a.textContent=n,i.parentNode?i.parentNode.replaceChild(a,i):i.replaceWith(a)},i.outerHTML}return'<span class="text-xs font-semibold px-2 py-0.5 rounded-full bg-red-700 text-white">?</span>'},XE=(n,e)=>{const t=n.displayName.split(" ").pop();return`
        <div class="${e?"variant-thumbnail active":"variant-thumbnail"}" 
             data-id="${n.id}" 
             data-src="${n.src}" 
             data-display-name="${n.displayName}" 
             data-code-id="${n.codeId}" 
             onclick="window.selectTextureVariant(this)">
            <img src="${n.src}" alt="${n.displayName}" loading="lazy" class="w-full h-auto object-cover aspect-square rounded-md">
            <span class="variant-name">${t}</span>
        </div>
    `};function nd(n){const e=document.getElementById("textures-gallery-container");if(!e)return;e.innerHTML="";const t=n.filter(s=>s&&s.mainVariant);if(t.length===0){e.innerHTML='<p class="text-zinc-500 text-center col-span-full">No results found.</p>';return}const r=t.map(s=>{const i=s.mainVariant,a=td(i.group),c=s.variants.length>1,u=i.displayName.split(" ").pop(),d=s.variants.length-1,f=c?s.variants.map(m=>{const _=m.id===i.id;return XE(m,_)}).join(""):"";return`
            <div class="music-card facebase-card bg-[#151722] rounded-xl shadow-xl ring-1 ring-[var(--border)] overflow-hidden flex flex-col p-1.5 space-y-1.5 !w-full relative texture-group-card" 
                 data-group-key="${s.baseName}" data-main-id="${i.id}">
                
                <div class="texture-icon-group">
                    ${a}
                    <div class="favorite-container !relative !top-0 !right-0 !bg-transparent !backdrop-filter-none !w-auto !h-auto">
                        <button class="favorite-btn" data-id="${i.id}" onclick="window.toggleFavorite('${i.id}', this)">
                            ${window.isFavorite(i.id)?"":""}
                        </button>
                    </div>
                </div>

                <div class="variant-display-container">
                    <div class="text-xs text-zinc-200 font-medium px-1 h-8 flex items-center justify-start gap-1">
                        <span class="truncate main-display-name">${s.baseName}</span>
                        ${c?`<span class="text-xs font-medium text-zinc-400 main-variant-name">(${u})</span>`:""}
                    </div>
                    <img src="${i.src}" alt="${i.displayName}" loading="lazy" class="w-full h-auto object-cover aspect-square rounded-md main-image">
                    
                    ${c?`
                        <button class="variant-indicator-btn" title="Ver ${s.variants.length} variantes" onclick="this.closest('.texture-group-card').classList.toggle('show-variants')">
                            ${d}+ </button>
                    `:""}
                </div>

                ${c?`
                    <div class="variants-gallery-overlay" onclick="this.closest('.texture-group-card').classList.remove('show-variants')">
                        <div class="variants-gallery-container" onclick="event.stopPropagation()">
                            <h4 class="text-sm font-semibold text-zinc-100 mb-2">${s.baseName} Variants</h4>
                            <div class="variants-grid">
                                ${f}
                            </div>
                        </div>
                    </div>
                `:""}

                <div class="flex items-center gap-1.5 p-1 card-footer">
                    <input readonly type="text" value="${i.codeId||""}" placeholder="" class="flex-grow w-0 h-8 px-2 text-xs dark-input rounded-md main-code-id-input">
                    <button class="copy-btn flex-shrink-0 w-8 h-8 flex items-center justify-center bg-[#1b1d24] text-zinc-200 rounded-md border border-[var(--border)] hover:bg-[#222533] transition" data-id="${i.id}">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/></svg>
                    </button>
                </div>
            </div>
        `}).join("");e.innerHTML=r,typeof window.setupCopyButtons=="function"&&window.setupCopyButtons()}window.selectTextureVariant=n=>{const e=n.closest(".texture-group-card"),t=n.dataset.id,r=n.dataset.src,s=n.dataset.displayName,i=n.dataset.codeId,a=e.querySelector(".main-image"),c=e.querySelector(".main-variant-name"),u=e.querySelector(".main-code-id-input"),d=e.querySelector(".favorite-btn");e.querySelectorAll(".variant-thumbnail").forEach(_=>_.classList.remove("active")),n.classList.add("active");const f=s.split(" ").pop();a&&(a.src=r,a.alt=s),c&&(c.textContent=`(${f})`),u&&(u.value=i),d&&(d.dataset.id=t,d.setAttribute("onclick",`window.toggleFavorite('${t}', this)`),d.innerHTML=window.isFavorite(t)?"":"");const m=e.querySelector(".copy-btn");m&&(m.dataset.id=t),e.classList.remove("show-variants")};const rd=n=>({"Chill & LoFi":"photos/app/music/chill.webp","Electronic & Remixes":"photos/app/music/electro.webp","Thematic & Mood":"photos/app/music/mood.webp","Pop Hits":"photos/app/music/pop.webp","Runway & Pageant":"photos/app/music/runway.webp","Upbeat & Energetic":"photos/app/music/upbeat.webp","World & Cultural":"photos/app/music/world.webp"})[n]||"photos/app/music.jpg",ZE=n=>{const e=document.getElementById("music-category-filter");if(!e)return;[...new Set(n.map(r=>r.category))].filter(Boolean).sort().forEach(r=>{const s=document.createElement("option");s.value=r,s.textContent=r,e.appendChild(s)})},sd=n=>{const e=document.getElementById("music-results-container");if(e){if(e.innerHTML="",n.length===0){e.innerHTML='<p class="text-zinc-500 text-center col-span-full">No results found.</p>';return}n.forEach(t=>{const r=rd(t.category),s=t.pitch&&t.pitch!==0?`<span class="ml-2 text-xs font-semibold text-cyan-400" title="Pitch: ${t.pitch}">[PITCH]</span>`:"",i=` 
        <div class="music-card facebase-card bg-[#151722] rounded-xl shadow-xl ring-1 ring-[var(--border)] overflow-hidden flex flex-col p-1.5 space-y-1.5 !w-full relative">
            
            <div class="favorite-container">
                <button class="favorite-btn" data-id="${t.id}" onclick="window.toggleFavorite('${t.id}', this)">
                    ${window.isFavorite(t.id)?"":""}
                </button>
            </div>
            
            <div class="text-xs text-zinc-200 font-medium px-1 h-8 flex items-center justify-start gap-1">
                <span class="truncate" title="${t.title}">${t.title}</span>
                ${s}
            </div>
            
            <img src="${r}" alt="${t.category}" loading="lazy" class="w-full h-auto object-cover aspect-square rounded-md">
            
            <div class="flex items-center gap-1.5 p-1">
                <input readonly type="text" value="${t.id}" placeholder="${t.artist||"Unknown Artist"}" class="flex-grow w-0 h-8 px-2 text-xs dark-input rounded-md" title="Artist: ${t.artist||"Unknown Artist"}">
                <button class="copy-btn flex-shrink-0 w-8 h-8 flex items-center justify-center bg-[#1b1d24] text-zinc-200 rounded-md border border-[var(--border)] hover:bg-[#222533] transition" title="Copy ID"> 
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/></svg> 
                </button> 
            </div> 
        </div>`;e.innerHTML+=i})}};class eT{constructor(){this.state={allFacebaseItems:[],allFacebaseGroups:[],facebaseCategories:null,allAvatarItems:[],allTextureBasenames:[],allTextureItems:[],allTextureGroups:[],allMusicCodes:[],globalDataLoaded:!1,initializedTabs:{facebases:!1,music:!1,timeConverter:!1,avatar:!1,textures:!1,favorites:!1}},this.subscribers=[]}getState(){return this.state}setState(e){this.state={...this.state,...e},this.notify()}subscribe(e){return this.subscribers.push(e),()=>{this.subscribers=this.subscribers.filter(t=>t!==e)}}notify(){this.subscribers.forEach(e=>e(this.state))}}const Le=new eT;function id(n,e){const t=document.getElementById("favorites-gallery-container");if(!t)return;if(t.innerHTML="",n.length===0){t.innerHTML='<p class="text-zinc-500 text-center col-span-full pt-4">No has marcado ningn tem como favorito todava. Busca en las otras pestaas y usa el corazn ().</p>';return}const r=e?[...e.countries,...e.others].reduce((a,c)=>{const u=c.name.toUpperCase();return c.iso?a[u]={src:Cl(c.iso),name:c.name,isEmoji:!0}:c.flag&&(a[u]={src:c.flag,name:c.name,isEmoji:!1}),a},{}):{},s=Le.getState().allFacebaseGroups||[],i=new Set;n.forEach(a=>{let c="";if(a.type==="music"){const u=rd(a.category),d=a.pitch&&a.pitch!==0?`<span class="ml-2 text-xs font-semibold text-cyan-400" title="Pitch: ${a.pitch}">[PITCH]</span>`:"";c=` 
                <div class="music-card facebase-card bg-[#151722] rounded-xl shadow-xl ring-1 ring-[var(--border)] overflow-hidden flex flex-col p-1.5 space-y-1.5 !w-full relative">
                    <div class="favorite-container">
                        <button class="favorite-btn" data-id="${a.id}" onclick="window.toggleFavorite('${a.id}', this)">
                            
                        </button>
                    </div>
                    <div class="text-xs text-zinc-200 font-medium px-1 h-8 flex items-center justify-start gap-1">
                        <span class="truncate" title="${a.title}">${a.title}</span>
                        ${d}
                    </div>
                    <img src="${u}" alt="${a.category}" loading="lazy" class="w-full h-auto object-cover aspect-square rounded-md">
                    <div class="flex items-center gap-1.5 p-1">
                        <input readonly type="text" value="${a.id}" placeholder="${a.artist||"Unknown Artist"}" class="flex-grow w-0 h-8 px-2 text-xs dark-input rounded-md" title="Artist: ${a.artist||"Unknown Artist"}">
                        <button class="copy-btn flex-shrink-0 w-8 h-8 flex items-center justify-center bg-[#1b1d24] text-zinc-200 rounded-md border border-[var(--border)] hover:bg-[#222533] transition" title="Copy ID"> 
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/></svg> 
                        </button> 
                    </div> 
                </div>`}else if(a.type==="facebase"){const u=s.find(L=>L.variants.default?.id===a.id||L.variants.X?.id===a.id||L.variants.S?.id===a.id);if(!u){console.warn("Orphaned facebase favorite found:",a);return}const d=`${u.group}-${u.baseDisplayName}`;if(i.has(d))return;i.add(d);const f=u.defaultItem,m=r[f.group];let _=`<span class="text-xs text-zinc-500">${f.group}</span>`,b=f.group;if(m){b=m.name;const L=`onmouseover="window.showFlagToast('${b}', event)" onmouseout="window.hideFlagToast()"`;m.isEmoji?_=`<span ${L} class="text-xl cursor-pointer flag-emoji">${m.src}</span>`:_=`<img src="${m.src}" alt="${b} flag" title="${b}" ${L} class="flag-aesthetic !h-5 !w-auto rounded shadow cursor-pointer">`}let S="";const k=u.variants.X,C=u.variants.S;(k||C)&&(S='<div class="variant-buttons">',k&&(S+=`<img src="photos/app/x.webp" class="variant-button" title="Ojos Cerrados" 
                        data-src="${k.src}" data-id="${k.id}" data-code-id="${k.codeId||""}"`),C&&(S+=`<img src="photos/app/s.webp" class="variant-button" title="Ojos de Lado" 
                        data-src="${C.src}" data-id="${C.id}" data-code-id="${C.codeId||""}">`),S+="</div>");const D=Object.values(u.variants).map(L=>L.id).filter(Boolean),F=JSON.stringify(D);c=`
                <div class="music-card facebase-card bg-[#151722] rounded-xl shadow-xl ring-1 ring-[var(--border)] overflow-hidden flex flex-col p-1.5 space-y-1.5 !w-full relative"
                     data-default-src="${f.src}" 
                     data-default-id="${f.id}" 
                     data-default-code-id="${f.codeId||""}">
                    
                    <div class="favorite-container">
                        <button class="favorite-btn" 
                                data-id="${f.id}" 
                                data-variant-ids='${F}'
                                onclick="window.toggleFavorite('${f.id}', this)">
                            
                        </button>
                    </div>
                    
                    <div class="text-xs text-zinc-200 font-medium px-1 h-8 flex items-center justify-start gap-1">
                        ${_}
                        <span class="truncate">${u.baseDisplayName}</span>
                    </div>
                    
                    <div class="relative">
                        <img src="${f.src}" alt="${u.baseDisplayName}" loading="lazy" class="w-full h-auto object-cover aspect-square rounded-md facebase-main-img">
                        ${S}
                    </div>

                    <div class="flex items-center gap-1.5 p-1">
                        <input readonly type="text" value="${f.codeId||""}" placeholder="" class="flex-grow w-0 h-8 px-2 text-xs dark-input rounded-md">
                        <button class="copy-btn flex-shrink-0 w-8 h-8 flex items-center justify-center bg-[#1b1d24] text-zinc-200 rounded-md border border-[var(--border)] hover:bg-[#222533] transition">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/></svg>
                        </button>
                    </div>
                </div>
            `}else{const u=a.type==="texture";let d,f;const m=r[a.group];if(u)d=`
                    <div class="texture-icon-group">
                        ${window.getTextureIconPath(a.group)}
                        <div class="favorite-container !relative !top-0 !right-0 !bg-transparent !backdrop-filter-none !w-auto !h-auto">
                            <button class="favorite-btn" data-id="${a.id}" onclick="window.toggleFavorite('${a.id}', this)">
                                
                            </button>
                        </div>
                    </div>`,f=`<span class="truncate">${a.displayName}</span>`;else{let _=a.group;if(m){_=m.name;const b=`onmouseover="window.showFlagToast('${_}', event)" onmouseout="window.hideFlagToast()"`;m.isEmoji?`${b}${m.src}`:`${m.src}${_}${_}${b}`}else`${a.group}`;d=`
                    <div class="favorite-container">
                        <button class="favorite-btn" data-id="${a.id}" onclick="window.toggleFavorite('${a.id}', this)">
                            
                        </button>
                    </div>`,f=`<span class="truncate">${a.displayName} (${a.group})</span>`}c=`
                <div class="music-card facebase-card bg-[#151722] rounded-xl shadow-xl ring-1 ring-[var(--border)] overflow-hidden flex flex-col p-1.5 space-y-1.5 !w-full relative">
                    ${d}
                    <div class="text-xs text-zinc-200 font-medium px-1 h-8 flex items-center justify-start gap-1">
                        ${f}
                    </div>
                    <img src="${a.src}" alt="${a.displayName}" loading="lazy" class="w-full h-auto object-cover aspect-square rounded-md">
                    <div class="flex items-center gap-1.5 p-1">
                        <input readonly type="text" value="${a.codeId||""}" placeholder="" class="flex-grow w-0 h-8 px-2 text-xs dark-input rounded-md">
                        <button class="copy-btn flex-shrink-0 w-8 h-8 flex items-center justify-center bg-[#1b1d24] text-zinc-200 rounded-md border border-[var(--border)] hover:bg-[#222533] transition" title="Copy ID"> 
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/></svg> 
                        </button> 
                    </div> 
                </div>
            `}t.innerHTML+=c})}function tT(){const n=document.getElementById("openPhotosBtn"),e=document.getElementById("closePhotosBtn"),t=document.getElementById("photosModal"),r=document.getElementById("photo-container"),s=document.getElementById("prevPhotoBtn"),i=document.getElementById("nextPhotoBtn");let a=0;const c=[{src:"photos/modal/UK.png",filename:"UK.png",title:"UK Collection"},{src:"photos/modal/Brazil.png",filename:"Brazil.png",title:"Brazil Collection"}];if(!n||!t||!r)return;function u(){const f=c.map((m,_)=>`
            <div id="slide-${_}" class="photo-slide">
                <h3 class="text-xl font-semibold text-zinc-100 mb-4">${m.title}</h3>
                <img src="${m.src}" alt="${m.title}">
                <a href="${m.src}" download="${m.filename}" class="mt-6 px-4 py-2 bg-[var(--gold2)] text-black font-semibold rounded-md hover:brightness-110 transition-all">
                    Descargar ${m.filename}
                </a>
            </div>
        `).join("");Array.from(r.children).forEach(m=>{m.id&&m.id.startsWith("slide-")&&m.remove()}),r.insertAdjacentHTML("afterbegin",f),a=0,d(a,!1)}function d(f,m=!0){const _=r.querySelectorAll(".photo-slide");if(_.length===0)return;m&&(f>=_.length?f=0:f<0&&(f=_.length-1)),_.forEach((S,k)=>S.classList.toggle("active",k===f)),a=f;const b=_.length>1;s&&s.classList.toggle("hidden",!b),i&&i.classList.toggle("hidden",!b)}i&&i.addEventListener("click",()=>d(a+1)),s&&s.addEventListener("click",()=>d(a-1)),n.addEventListener("click",()=>{u(),t.classList.add("show")}),e&&e.addEventListener("click",()=>t.classList.remove("show")),t.addEventListener("click",f=>{f.target===t&&t.classList.remove("show")})}const Rl="America/Costa_Rica";function nT(){const n=document.getElementById("eventTimeZone"),e=document.getElementById("eventDate"),t=document.getElementById("hour-scroller-input"),r=document.getElementById("sjoDate"),s=document.getElementById("sjoTime");if(!n||!e||!t||!r||!s)return;const i={"Etc/GMT+12":"IDLW (-12)","Pacific/Honolulu":"HST (-10)","America/Anchorage":"AKST (-9)","America/Los_Angeles":"PST (-8)","America/Denver":"MST (-7)","America/Chicago":"CST (-6)","America/Mexico_City":"CST-MX (-6)","America/New_York":"EST (-5)","America/Bogota":"COT (-5)","America/Lima":"PET (-5)","America/Caracas":"VET (-4)","America/Santiago":"CLT (-3)","America/Sao_Paulo":"BRT (-3)","Atlantic/Azores":"AZOT (-1)","Europe/London":"GMT (+0)","Europe/Paris":"CET (+1)","Europe/Berlin":"CET-DE (+1)","Europe/Athens":"EET (+2)","Africa/Johannesburg":"SAST (+2)","Asia/Dubai":"GST (+4)","Asia/Karachi":"PKT (+5)","Asia/Kolkata":"IST (+5:30)","Asia/Bangkok":"ICT (+7)","Asia/Hong_Kong":"HKT (+8)","Asia/Singapore":"SGT (+8)","Asia/Manila":"PHT (+8)","Asia/Tokyo":"JST (+9)","Asia/Seoul":"KST (+9)","Australia/Sydney":"AEST (+10)","Pacific/Auckland":"NZST (+12)"};n.innerHTML=Object.entries(i).map(([_,b])=>`<option value="${_}">${b}</option>`).join(""),n.value="America/New_York";const a=new Date;for(let _=-7;_<=7;_++){const b=new Date(a);b.setDate(a.getDate()+_);const S=document.createElement("option");S.value=b.toISOString().split("T")[0],S.textContent=b.toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"}),_===0&&(S.selected=!0),e.appendChild(S)}let c='<div class="h-[80px]"></div>';for(let _=0;_<48;_++){const b=Math.floor(_/2),S=_%2*30;c+=`<div class="hour-scroller-item" data-index="${_}">${String(b).padStart(2,"0")}:${String(S).padStart(2,"0")}</div>`}t.innerHTML=c+'<div class="h-[80px]"></div>';const u=t.querySelectorAll(".hour-scroller-item"),d=new Date;t.scrollTop=(d.getHours()*2+Math.floor(d.getMinutes()/30))*40;function f(){const _=n.value,[b,S,k]=e.value.split("-").map(Number),C=Math.round(t.scrollTop/40),D=Math.floor(C/2),F=C%2*30;u.forEach((E,g)=>E.classList.toggle("active",g===C));let L=Date.UTC(b,S-1,k,D,F);const q=new Intl.DateTimeFormat("en-CA",{timeZone:_,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).formatToParts(new Date(L)).reduce((E,g)=>(E[g.type]=g.value,E),{});L-=Date.UTC(+q.year,+q.month-1,+q.day,+q.hour,+q.minute)-L;const ne=new Date(L).toLocaleDateString("en-US",{timeZone:Rl,weekday:"long",month:"short",day:"numeric"}),J=new Date(L).toLocaleTimeString("en-US",{timeZone:Rl,hour:"2-digit",minute:"2-digit",hour12:!1});r.textContent=ne,s.textContent=J}let m;t.addEventListener("scroll",()=>{clearTimeout(m),m=setTimeout(f,150)}),t.addEventListener("wheel",_=>{_.preventDefault();const b=40,S=Math.round(t.scrollTop/b);t.scrollTo({top:Math.max(0,Math.min(S+Math.sign(_.deltaY),47))*b,behavior:"smooth"})}),n.addEventListener("change",f),e.addEventListener("change",f),f()}function rT(n){const e=n.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),t=e[0],r=e[e.length-1],s=i=>{i.key==="Tab"&&(i.shiftKey?document.activeElement===t&&(i.preventDefault(),r.focus()):document.activeElement===r&&(i.preventDefault(),t.focus()))};return n.addEventListener("keydown",s),t&&t.focus(),()=>n.removeEventListener("keydown",s)}function Pi(n,e,t){const r=document.getElementById(n),s=document.getElementById(e),i=document.getElementById(t);let a=null,c=null;const u=()=>{if(!i)return;a=document.activeElement,i.classList.add("show"),i.removeAttribute("aria-hidden"),c=rT(i);const f=m=>{m.key==="Escape"&&d()};i.addEventListener("keydown",f),i.__handleEscape=f},d=()=>{i&&(i.classList.remove("show"),i.setAttribute("aria-hidden","true"),c&&c(),i.__handleEscape&&i.removeEventListener("keydown",i.__handleEscape),a&&a.focus())};r&&(r.addEventListener("click",u),r.addEventListener("keydown",f=>{(f.key==="Enter"||f.key===" ")&&(f.preventDefault(),u())})),s&&s.addEventListener("click",d),i?.addEventListener("click",f=>{f.target===i&&d()})}function sT(){document.addEventListener("keydown",n=>{const e=n.target;e.classList.contains("variant-button")&&(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),e.click()),(e.classList.contains("copy-btn")||e.classList.contains("copy-ticket-btn"))&&(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),e.click()),e.classList.contains("favorite-btn")&&(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),e.click())})}function iT(n){document.querySelectorAll(".tab-nav-button").forEach(t=>{const r=t.dataset.tab===n;t.setAttribute("aria-pressed",r.toString())})}function oT(){const n=new IntersectionObserver(i=>{i.forEach(a=>{if(a.isIntersecting){const c=a.target;aT(c),n.unobserve(c)}})},{rootMargin:"100px",threshold:.01}),e=()=>{document.querySelectorAll('img[loading="lazy"]:not([data-skeleton-initialized])').forEach(a=>{a.dataset.skeletonInitialized="true",a.complete&&a.naturalHeight!==0?(a.classList.add("image-loaded"),a.classList.remove("image-loading")):(a.classList.add("image-loading"),n.observe(a))})};e();let t;const r=new MutationObserver(()=>{clearTimeout(t),t=setTimeout(e,100)}),s=document.getElementById("tab-content-wrapper");s&&r.observe(s,{childList:!0,subtree:!0}),window.updateSkeletonLoaders=e}function aT(n){if(n.classList.contains("variant-button")||n.classList.contains("texture-type-icon")||n.width<50)return;let e=n.previousElementSibling;if(!e||!e.classList.contains("image-skeleton")){e=document.createElement("div"),e.className="image-skeleton",Object.assign(e.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",zIndex:"1"});const s=n.parentElement;getComputedStyle(s).position==="static"&&(s.style.position="relative"),s.insertBefore(e,n),Object.assign(n.style,{position:"relative",zIndex:"2"})}const t=()=>{requestAnimationFrame(()=>{n.classList.remove("image-loading"),n.classList.add("image-loaded"),setTimeout(()=>{e?.parentElement&&e.remove()},300)})},r=()=>{n.classList.remove("image-loading"),e?.remove()};n.addEventListener("load",t,{once:!0,passive:!0}),n.addEventListener("error",r,{once:!0,passive:!0}),n.complete&&n.naturalHeight!==0&&t()}const od="fashion_muse_favorites";function Go(){try{const n=localStorage.getItem(od);return n?new Set(JSON.parse(n)):new Set}catch(n){return console.error("Error loading favorites:",n),new Set}}function cT(n){return Go().has(n)}function lT(n,e){const t=e.dataset.id,r=Go();let s=!1,i=[];const a=e.dataset.variantIds;if(a)try{i=JSON.parse(a)}catch(c){console.error("Error parsing variant IDs:",c),i=[t]}else i=[t];r.has(t)?(s=!1,i.forEach(c=>r.delete(c))):(s=!0,i.forEach(c=>r.add(c)));try{localStorage.setItem(od,JSON.stringify(Array.from(r)))}catch(c){console.error("Error saving favorites:",c)}return e&&(e.innerHTML=s?"":"",e.classList.toggle("is-favorite",s)),s}window.getFavorites=Go;window.isFavorite=cT;window.toggleFavorite=lT;function uT(n,e){let t;return function(...r){clearTimeout(t),t=setTimeout(()=>n.apply(this,r),e)}}function hT(n){const e={},t=/^(.*?)( S| X)$/i;for(const r of n){let s=r.displayName,i="default";const a=r.displayName.match(t);a&&(s=a[1].trim(),i=a[2].trim().toUpperCase());const c=`${r.group}-${s}`;e[c]||(e[c]={group:r.group,baseDisplayName:s,defaultItem:null,variants:{}}),e[c].variants[i]=r,i==="default"&&(e[c].defaultItem=r)}return Object.values(e).filter(r=>r.defaultItem)}function dT(n,e){let t="";return function(){const s=n.getState();if(!s.globalDataLoaded)return;const i=document.querySelector(".tab-nav-button.active")?.dataset.tab,c=document.getElementById("search-bar")?.value.toLowerCase().trim()||"",u=document.getElementById("facebase-category-filter"),d=document.getElementById("avatar-category-filter"),f=document.getElementById("texture-category-filter"),m=document.getElementById("music-category-filter"),_=i==="facebases"?u?.value||"all":i==="avatar"?d?.value||"all":i==="textures"?f?.value||"all":i==="music"?m?.value||"all":"none",b=`${i}-${c}-${_}`;if(b!==t){if(t=b,i==="facebases"){const S=u?.value||"all",k=s.allFacebaseGroups.filter(C=>{const D=S==="all"||C.group===S.toUpperCase(),F=c===""||C.baseDisplayName.toLowerCase().includes(c)||C.group.toLowerCase().includes(c);return D&&F});e.renderFacebasesGallery(k,s.facebaseCategories)}else if(i==="avatar"){const S=d?.value||"all",k=s.allAvatarItems.filter(C=>{const D=S==="all"||C.group===S,F=c===""||C.group.toLowerCase().includes(c)||C.displayName.toLowerCase().includes(c);return D&&F});e.renderAvatarGallery(k)}else if(i==="textures"){const S=f?.value||"all",k=s.allTextureGroups.filter(C=>{if(!C||!C.variants||C.variants.length===0)return!1;const D=S==="all"||C.variants.some(L=>L.group===S),F=c===""||C.baseName.toLowerCase().includes(c)||C.variants.some(L=>L.group.toLowerCase().includes(c)||L.displayName.toLowerCase().includes(c));return D&&F});e.renderTextureGallery(k)}else if(i==="music"){const S=m?.value||"all",k=s.allMusicCodes.filter(C=>{const D=S==="all"||C.category===S,F=`${C.title.toLowerCase()} ${C.artist?C.artist.toLowerCase():""} ${(C.markers||[]).join(" ")}`;return D&&F.includes(c)});e.renderMusicCodes(k)}else if(i==="favorites"){const S=window.getFavorites(),C=[...s.allFacebaseItems.map(D=>({...D,id:D.id||D.codeId,type:"facebase"})),...s.allAvatarItems.map(D=>({...D,id:D.id||D.codeId,type:"avatar"})),...s.allTextureItems.map(D=>({...D,type:"texture"})),...s.allMusicCodes.map(D=>({...D,type:"music"}))].filter(D=>{const F=D.id?S.has(D.id):!1,L=c===""||D.displayName?.toLowerCase().includes(c)||D.group?.toLowerCase().includes(c)||D.title?.toLowerCase().includes(c)||D.artist?.toLowerCase().includes(c);return F&&L});e.renderFavoritesGallery(C,s.facebaseCategories)}}}}let fT;function pT(n,e){const t=document.getElementById("custom-toast");if(!t)return;clearTimeout(fT);const r=e.clientX,s=e.clientY;t.style.left=`${r+15}px`,t.style.top=`${s+15}px`,t.textContent=n,t.classList.add("show")}function mT(){const n=document.getElementById("custom-toast");n&&n.classList.remove("show")}window.showFlagToast=pT;window.hideFlagToast=mT;const ad=new Map;function Wo(n,e){ad.set(n,e)}function gT(n){const e=document.querySelector(n);e&&e.addEventListener("click",t=>{for(const[r,s]of ad){const i=t.target.closest(r);if(i){s(t,i);break}}})}function _T(n,e){const t=e.previousElementSibling;if(t&&t.tagName==="INPUT"){const r=t.value;r?navigator.clipboard.writeText(r).then(()=>{e.classList.add("copied"),setTimeout(()=>{e.classList.remove("copied")},1500)}).catch(s=>{console.error("Error copying text:",s),alert("No se pudo copiar el ID.")}):console.warn("Attempt to copy empty value.")}}function yT(n,e){n.stopPropagation();const t=e.closest(".facebase-card");if(t)if(e.classList.contains("active-variant"))cd(t);else{const r=t.querySelector(".facebase-main-img"),s=t.querySelector("input[readonly]"),i=t.querySelector(".favorite-btn"),a=e.dataset.src,c=e.dataset.id,u=e.dataset.codeId||"";r&&(r.src=a),s&&(s.value=u),i&&(i.dataset.id=c,i.innerHTML=window.isFavorite(c)?"":""),t.querySelectorAll(".variant-button").forEach(d=>d.classList.remove("active-variant")),e.classList.add("active-variant")}}function vT(n,e){!n.target.closest(".favorite-btn")&&!n.target.closest(".copy-btn")&&!n.target.closest(".variant-button")&&cd(e)}function cd(n){if(!n)return;const e=n.dataset.defaultSrc,t=n.dataset.defaultId,r=n.dataset.defaultCodeId||"";if(!e)return;const s=n.querySelector(".facebase-main-img"),i=n.querySelector("input[readonly]"),a=n.querySelector(".favorite-btn");s&&(s.src=e),i&&(i.value=r),a&&(a.dataset.id=t,a.innerHTML=window.isFavorite(t)?"":""),n.querySelectorAll(".variant-button").forEach(c=>c.classList.remove("active-variant"))}function ET(){document.getElementById("nav-admin-btn");const n=document.getElementById("admin-modal");document.getElementById("admin-close-btn");const e=document.getElementById("admin-auth-view"),t=document.getElementById("admin-dashboard-view"),r=document.getElementById("admin-login-form"),s=document.getElementById("admin-signup-btn"),i=document.getElementById("admin-logout-btn"),a=document.getElementById("auth-status"),c=document.getElementById("admin-user-email"),u=document.getElementById("quick-upload-form"),d=document.getElementById("new-roblox-id"),f=document.getElementById("new-item-preview"),m=document.querySelectorAll('input[name="itemType"]');document.querySelectorAll(".category-options-group");let _=null;document.addEventListener("click",S=>{S.target.closest("#nav-admin-btn")&&(console.log("Admin button clicked"),n.classList.remove("hidden"),setTimeout(()=>n.classList.add("show"),10)),(S.target.closest("#admin-close-btn")||S.target===n)&&(n.classList.remove("show"),setTimeout(()=>n.classList.add("hidden"),300))}),kv(Wr,S=>{_=S,S?(e.classList.add("hidden"),t.classList.remove("hidden"),c.textContent=S.email):(e.classList.remove("hidden"),t.classList.add("hidden"))}),r.addEventListener("submit",async S=>{S.preventDefault();const k=document.getElementById("admin-email").value,C=document.getElementById("admin-password").value;if(!(!k||!C))try{a.textContent="Logging in...",a.className="text-center text-xs mt-2 text-zinc-400",await Sv(Wr,k,C),a.textContent="",r.reset()}catch(D){a.textContent="Error: "+D.message,a.className="text-center text-xs mt-2 text-red-500"}}),s.addEventListener("click",async()=>{const S=document.getElementById("admin-email").value,k=document.getElementById("admin-password").value;if(!S||!k){a.textContent="Enter email & password to register",a.className="text-center text-xs mt-2 text-red-500";return}try{a.textContent="Creating account...",await Rv(Wr,S,k),a.textContent="Created! logging in..."}catch(C){a.textContent=C.message,a.className="text-center text-xs mt-2 text-red-500"}}),i.addEventListener("click",()=>Nv(Wr)),m.forEach(S=>{S.addEventListener("change",k=>{b(k.target.value)})});function b(S){document.getElementById("cat-options-texture").classList.add("hidden"),document.getElementById("cat-options-facebase").classList.add("hidden"),document.getElementById("cat-options-avatar").classList.add("hidden"),S==="texture"?document.getElementById("cat-options-texture").classList.remove("hidden"):S==="facebase"?document.getElementById("cat-options-facebase").classList.remove("hidden"):S==="avatar"&&(document.getElementById("cat-options-avatar").classList.remove("hidden"),document.getElementById("cat-options-avatar").classList.add("flex"))}d.addEventListener("input",S=>{const k=S.target.value;if(k&&k.length>5){const C=Kr(k);f.innerHTML=`<img src="${C}" class="w-full h-full object-cover">`}else f.innerHTML='<span class="text-xs text-zinc-600">?</span>'}),u.addEventListener("submit",async S=>{if(S.preventDefault(),!_)return;const k=document.getElementById("admin-submit-btn"),C=document.getElementById("admin-msg");k.disabled=!0,k.textContent="Saving...",C.textContent="";try{const D=document.querySelector('input[name="itemType"]:checked').value,F=d.value,L=document.getElementById("new-item-name").value;let q="General";if(D==="texture"){const E=document.querySelector('input[name="itemCategory"]:checked');E&&(q=E.value)}else if(D==="facebase")q=document.getElementById("cat-options-facebase").value;else if(D==="avatar"){const E=document.querySelector("#cat-options-avatar input:checked");E&&(q=E.value)}if(!L||!F)throw new Error("Missing fields");let ne=null;C.textContent=" Fetching Roblox URL...";try{const E=await fetch(`/api/roblox/v1/assets?assetIds=${F}&size=420x420&format=Png&isCircular=false`);if(E.ok){const g=await E.json();g.data&&g.data.length>0&&g.data[0].state==="Completed"&&(ne=g.data[0].imageUrl,console.log("Got remote URL via Proxy:",ne))}else console.warn("Proxy returned status:",E.status)}catch(E){console.warn("Could not fetch automatic URL (is proxy running?)",E)}let J="items";D==="texture"?J="textures":D==="facebase"?J="facebases":D==="avatar"&&(J="avatar"),await X_(Wn(Kn,J),{id:F,robloxId:F,name:L,category:q,type:D,fullName:q==="M"||q==="S"?`${q}-${L}`:L,variant:L,remoteUrl:ne,dateAdded:W_()}),C.textContent=" Item Added Successfully!",C.className="text-center text-xs mt-2 text-green-500",u.reset(),f.innerHTML='<span class="text-xs text-zinc-600">?</span>',m[0].checked=!0,b("texture")}catch(D){console.error(D),C.textContent=" Error: "+D.message,C.className="text-center text-xs mt-2 text-red-500"}finally{k.disabled=!1,k.textContent="ADD ITEM",setTimeout(()=>{C.textContent=""},3e3)}})}const TT="bWFuY2hpdGFz",IT="isAuthenticated",wT="lastAuthTime";window.getTextureIconPath=td;const AT={renderFacebasesGallery:Zh,renderAvatarGallery:ed,renderTextureGallery:nd,renderMusicCodes:sd,renderFavoritesGallery:id},Mt=dT(Le,AT);Wo(".copy-btn",_T);Wo(".variant-button",yT);Wo(".facebase-card",vT);function Ir(n,e,t,r){const s=Le.getState();s.initializedTabs[n]||(e(t,r),Le.setState({initializedTabs:{...s.initializedTabs,[n]:!0}}))}function bT(){const n=Le.getState();Ir("facebases",Zh,n.allFacebaseGroups,n.facebaseCategories)}function RT(){const n=Le.getState();Ir("avatar",ed,n.allAvatarItems)}function ST(){const n=Le.getState();Ir("textures",nd,n.allTextureGroups)}function CT(){const n=Le.getState();Ir("music",sd,n.allMusicCodes)}function PT(){const n=Le.getState();Ir("favorites",id,[],n.facebaseCategories)}const Sl=async()=>{try{const n=await HE(),e=JE(n.allTextureItems),t=hT(n.allFacebaseItems);Le.setState({allFacebaseItems:n.allFacebaseItems,facebaseCategories:n.facebaseCategories,allAvatarItems:n.allAvatarItems,allTextureBasenames:n.allTextureBasenames,allMusicCodes:n.allMusicCodes,allTextureItems:n.allTextureItems,allTextureGroups:e,allFacebaseGroups:t,globalDataLoaded:!0});const r=document.getElementById("app-container");r&&r.classList.add("loaded"),KE(n.facebaseCategories),QE(n.allAvatarItems),YE(e),ZE(n.allMusicCodes),nT(),tT(),bT(),RT(),ST(),CT(),PT(),Mt(),oT()}catch(n){console.error("APP_FLOW: Error crtico al iniciar la aplicacin:",n)}};document.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("loginOverlay"),e=document.getElementById("passwordInput"),t=document.getElementById("loginBtn"),r=document.getElementById("errorMessage"),s=document.getElementById("search-bar"),i=document.querySelectorAll(".tab-nav-button[data-tab]"),a=document.querySelectorAll(".tab-content");gT("#tab-content-wrapper");const c=()=>{{console.warn("Autenticacin desactivada. Saltando login."),n&&n.classList.remove("show"),setTimeout(Sl,500);return}},u=()=>{try{e&&e.value===atob(TT)?(localStorage.setItem(IT,"true"),localStorage.setItem(wT,Date.now()),r&&(r.textContent=""),n&&n.classList.remove("show"),Sl()):r&&(r.textContent="Incorrect password.")}catch(m){console.error("Error durante la autenticacin:",m),r&&(r.textContent="Authentication error.")}};t&&t.addEventListener("click",u),e&&e.addEventListener("keydown",m=>{m.key==="Enter"&&(m.preventDefault(),u())}),s&&s.addEventListener("input",uT(Mt,300)),document.getElementById("facebase-category-filter")?.addEventListener("change",Mt),document.getElementById("avatar-category-filter")?.addEventListener("change",Mt),document.getElementById("texture-category-filter")?.addEventListener("change",Mt),document.getElementById("music-category-filter")?.addEventListener("change",Mt),Pi("openTimeConverterBtn","closeTimeConverterBtn","timeConverterModal"),Pi("openDriveModalBtn","closeDriveModalBtn","googleDriveModal"),Pi("openTicketModalBtn","closeTicketModalBtn","ticketModal");const d=document.getElementById("ticket-buttons-container");d&&d.addEventListener("click",m=>{const _=m.target.closest(".copy-ticket-btn");if(!_)return;const b=_.dataset.copyText,S=_.innerHTML;b&&navigator.clipboard.writeText(b).then(()=>{_.innerHTML="Copiado!",_.classList.add("copied"),setTimeout(()=>{_.innerHTML=S,_.classList.remove("copied")},1500)}).catch(k=>{console.error("Error al copiar el texto:",k),alert("No se pudo copiar el texto.")})}),i.forEach(m=>{m.addEventListener("click",()=>{const _=m.dataset.tab;i.forEach(S=>S.classList.remove("active")),m.classList.add("active"),a.forEach(S=>S.classList.toggle("hidden",S.id!==`content-${_}`)),f(_),iT(_),Le.getState().globalDataLoaded&&Mt()})}),sT();const f=m=>{const _=document.getElementById("facebase-category-filter"),b=document.getElementById("avatar-category-filter"),S=document.getElementById("texture-category-filter"),k=document.getElementById("music-category-filter");s&&(s.value=""),_&&(_.style.display="none"),b&&(b.style.display="none"),S&&(S.style.display="none"),k&&(k.style.display="none"),m==="facebases"?(s&&(s.placeholder="Search by name..."),_&&(_.style.display="block")):m==="avatar"?(s&&(s.placeholder="Search by name or category..."),b&&(b.style.display="block")):m==="textures"?(s&&(s.placeholder="Search by name or category..."),S&&(S.style.display="block")):m==="music"?(s&&(s.placeholder="Search by artist, title, or marker..."),k&&(k.style.display="block")):m==="favorites"?s&&(s.placeholder="Search favorites..."):s&&(s.placeholder="Search...")};ET(),c()});
